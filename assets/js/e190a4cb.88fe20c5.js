"use strict";(self.webpackChunksubstrate_contracts_book=self.webpackChunksubstrate_contracts_book||[]).push([[3234],{3905:function(e,a,t){t.d(a,{Zo:function(){return l},kt:function(){return f}});var r=t(7294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function n(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?n(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,r,o=function(e,a){if(null==e)return{};var t,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var d=r.createContext({}),p=function(e){var a=r.useContext(d),t=a;return e&&(t="function"==typeof e?e(a):c(c({},a),e)),t},l=function(e){var a=p(e.components);return r.createElement(d.Provider,{value:a},e.children)},i={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},u=r.forwardRef((function(e,a){var t=e.components,o=e.mdxType,n=e.originalType,d=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(t),f=o,h=u["".concat(d,".").concat(f)]||u[f]||i[f]||n;return t?r.createElement(h,c(c({ref:a},l),{},{components:t})):r.createElement(h,c({ref:a},l))}));function f(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var n=t.length,c=new Array(n);c[0]=u;var s={};for(var d in a)hasOwnProperty.call(a,d)&&(s[d]=a[d]);s.originalType=e,s.mdxType="string"==typeof e?e:o,c[1]=s;for(var p=2;p<n;p++)c[p]=t[p];return r.createElement.apply(null,c)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},2244:function(e,a,t){t.r(a),t.d(a,{frontMatter:function(){return s},contentTitle:function(){return d},metadata:function(){return p},toc:function(){return l},default:function(){return u}});var r=t(7462),o=t(3366),n=(t(7294),t(3905)),c=["components"],s={},d="Custom RPCs and commands",p={unversionedId:"europa/guides/custom-rpcs",id:"europa/guides/custom-rpcs",isDocsHomePage:!1,title:"Custom RPCs and commands",description:"Europa implements a set of custom RPCs to facilate development.",source:"@site/docs/europa/guides/custom-rpcs.md",sourceDirName:"europa/guides",slug:"/europa/guides/custom-rpcs",permalink:"/substrate-contracts-book/europa/guides/custom-rpcs",editUrl:"https://github.com/patractlabs/substrate-contracts-book/docs/europa/guides/custom-rpcs.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Contract Pallet Implementation",permalink:"/substrate-contracts-book/europa/guides/implementation"},next:{title:"Europa contract execution log",permalink:"/substrate-contracts-book/europa/guides/contract-log"}},l=[{value:"RPC: <code>europa_forwardToHeight</code>",id:"rpc-europa_forwardtoheight",children:[{value:"Parameters",id:"parameters",children:[]},{value:"Example",id:"example",children:[]}]},{value:"RPC: <code>europa_backwardToHeight</code>",id:"rpc-europa_backwardtoheight",children:[{value:"Parameters",id:"parameters-1",children:[]},{value:"Example",id:"example-1",children:[]}]},{value:"RPC: <code>europa_modifiedStateKvs</code>",id:"rpc-europa_modifiedstatekvs",children:[{value:"Parameter",id:"parameter",children:[]},{value:"Example",id:"example-2",children:[]}]},{value:"CLI: <code>state-kv</code>",id:"cli-state-kv",children:[{value:"USAGE:",id:"usage",children:[]},{value:"Example",id:"example-3",children:[]}]},{value:"CLI: <code>workspace</code>",id:"cli-workspace",children:[{value:"Use another workspace",id:"use-another-workspace",children:[]}]}],i={toc:l};function u(e){var a=e.components,t=(0,o.Z)(e,c);return(0,n.kt)("wrapper",(0,r.Z)({},i,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"custom-rpcs-and-commands"},"Custom RPCs and commands"),(0,n.kt)("p",null,"Europa implements a set of custom RPCs to facilate development."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Making sure Europa is running and endpoint is configured correctly")),(0,n.kt)("h2",{id:"rpc-europa_forwardtoheight"},"RPC: ",(0,n.kt)("inlineCode",{parentName:"h2"},"europa_forwardToHeight")),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"europa_forwardToHeight")," allows Europa to produce empty blocks to reach to the assigned height"),(0,n.kt)("h3",{id:"parameters"},"Parameters"),(0,n.kt)("p",null,"BlockHeight - Blockheight to be forwarded to."),(0,n.kt)("h3",{id:"example"},"Example"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'$ curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d   \'{\n     "jsonrpc":"2.0",\n      "id":1,\n      "method":"europa_forwardToHeight",\n      "params": [10]\n    }\'\n\n')),(0,n.kt)("p",null,"The rpc result looks like"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{"jsonrpc":"2.0","result":null,"id":1}\n')),(0,n.kt)("p",null,"And you should see the follow log printed from Europa service."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"INFO tokio-runtime-worker ec_basic_authorship::basic_authorship: \ud83c\udf81 Prepared block for proposing at 10 [hash: 0x5302296c5d4c52caaaec15d6bd1409e5cb6482cd41d3cbe7e80356ec4c06f68b; parent_hash: 0xc668\u202646de; extrinsics (1): [0x64cd\u202622c2]]\n\nINFO tokio-runtime-worker sc_consensus_manual_seal::rpc: Instant Seal success: CreatedBlock { hash: 0x5302296c5d4c52caaaec15d6bd1409e5cb6482cd41d3cbe7e80356ec4c06f68b, aux: ImportedAux { header_only: false, clear_justification_requests: false, needs_justification: false, bad_justification: false, is_new_best: true } }    \n")),(0,n.kt)("h2",{id:"rpc-europa_backwardtoheight"},"RPC: ",(0,n.kt)("inlineCode",{parentName:"h2"},"europa_backwardToHeight")),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"europa_backwardToHeight")," revert the blockchain back to certain heights and remove states of reverted blocks"),(0,n.kt)("h3",{id:"parameters-1"},"Parameters"),(0,n.kt)("p",null,"BlockHeight - Blockheight to be reverted to."),(0,n.kt)("h3",{id:"example-1"},"Example"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'$ curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d   \'{\n     "jsonrpc":"2.0",\n      "id":1,\n      "method":"europa_backwardToHeight",\n      "params": [10]\n    }\'\n\n')),(0,n.kt)("p",null,"The rpc result looks like"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{"jsonrpc":"2.0","result":null,"id":1}\n')),(0,n.kt)("p",null,"You can check the lastest block number:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d   \'{ "jsonrpc":"2.0", "id":1, "method":"chain_getBlock", "params": [] }\'\n')),(0,n.kt)("p",null,"You will find that the blocks are now rolled back to number 5"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{"jsonrpc":"2.0","result":{"block":{"extrinsics":["0x280402000b7e3d54da7b01"],"header":{"digest":{"logs":[]},"extrinsicsRoot":"0xb01668e3274a819e207818d87ae7ed858d299a12e49a9dd1688af6ceb56f1ca5","number":"0x5","parentHash":"0x6cdf0f12b32e960e9f05f510873dcbd2c84271a55bd71f2850688712537be764","stateRoot":"0x86ae36014044a2cfd627da60eff71333ac9d6db4daafc70a21f8cae5c0988a27"}},"justifications":null},"id":1}\n')),(0,n.kt)("h2",{id:"rpc-europa_modifiedstatekvs"},"RPC: ",(0,n.kt)("inlineCode",{parentName:"h2"},"europa_modifiedStateKvs")),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"europa_modifiedStateKvs")," retrive the cached state changes at certain blockheight.\nwe store the mapping of blockhash and state kvs in the state-kv database, so that developers could export the state changes to look up the details."),(0,n.kt)("h3",{id:"parameter"},"Parameter"),(0,n.kt)("p",null,"BlockHeight - Blockheight to be reverted to."),(0,n.kt)("h3",{id:"example-2"},"Example"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'$ curl http://localhost:9933 -H "Content-Type:application/json;charset=utf-8" -d   \'{\n     "jsonrpc":"2.0",\n      "id":1,\n      "method":"europa_modifiedStateKvs",\n      "params": [4]\n    }\'\n')),(0,n.kt)("p",null,"The rpc result looks like"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{"jsonrpc":"2.0","result":{"0x26aa394eea5630e07c48ae0c9558cef702a5c1b19ab7a04f536c519aca4983ac":"0x04000000","0x26aa394eea5630e07c48ae0c9558cef70a98fdbe9ce6c55837576c60c7af3850":"0x01000000","0x26aa394eea5630e07c48ae0c9558cef734abf5cb34d6244378cddbf18e849d96":"0x00000000000000000000000000000000587575c42f000000","0x26aa394eea5630e07c48ae0c9558cef780d41e5e16056765bc8461851072c9d7":"0x0400000000000000481a0b0b00000000020000","0x26aa394eea5630e07c48ae0c9558cef78a42f33323cb5ced3b44dd825fda9fcc":"0x4705272160a278662f1256b562581d7c83390481bd619a7c37a33df3478daa8e","0x26aa394eea5630e07c48ae0c9558cef799e7f93fc6a98f0874fd057f111c4d2d":"0x00","0x26aa394eea5630e07c48ae0c9558cef7a44704b568d21667356a5a050c118746bfb27f1eaef06bb903000000":"0x4705272160a278662f1256b562581d7c83390481bd619a7c37a33df3478daa8e","0x26aa394eea5630e07c48ae0c9558cef7a86da5a932684f199539836fcb8c886f":null,"0x26aa394eea5630e07c48ae0c9558cef7bdc0bd303e9855813aa8a30d4efc5112":null,"0x26aa394eea5630e07c48ae0c9558cef7df1daeb8986837f21cc5d17596bb78d1b4def25cfda6ef3a00000000":null,"0x26aa394eea5630e07c48ae0c9558cef7ff553b5a9862a516939d82b3d3d8661a":null,"0x3a65787472696e7369635f696e646578":null,"0x3f1467a096bcd71a5b6a0c8155e208103f2edf3bdf381debe331ab7446addfdc":"0x00000000000000000000000000000000","0xbd2a529379475088d3e29a918cd478721a39ec767bd5269111e6492a1675702a":"0x10de7a51d406e1cca0fbf047c8d7505e82b1fa19e9e073726e73e8a690b2e67dfeb956536e91ab6d05c4942723d6a888f43e2d11635073ea75ba8c8956105f229dc09065aae628308b68b125b74ccfaa4455e2f5c34b7eb2cec074af4dc63cbf2f4705272160a278662f1256b562581d7c83390481bd619a7c37a33df3478daa8e","0xf0c365c3cf59d671eb72da0e7a4113c49f1f0515f462cdcf84e0f1d6045dfcbb":"0xc63154da7b010000","0xf0c365c3cf59d671eb72da0e7a4113c4bbd108c4899964f707fdaffb82636065":null},"id":1}\n\n')),(0,n.kt)("h2",{id:"cli-state-kv"},"CLI: ",(0,n.kt)("inlineCode",{parentName:"h2"},"state-kv")),(0,n.kt)("p",null,"Print modified stored state kvs for a block"),(0,n.kt)("h3",{id:"usage"},"USAGE:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"    europa state-kv [FLAGS] [OPTIONS] <HASH or NUMBER>\n")),(0,n.kt)("p",null,"For details, please check by ",(0,n.kt)("inlineCode",{parentName:"p"},"europa state-kv --help")),(0,n.kt)("h3",{id:"example-3"},"Example"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# in a shell window\n$ ./target/debug/europa\nNov 12 17:10:14.524  INFO Europa Dev Node    \nNov 12 17:10:14.524  INFO \u270c\ufe0f  version 0.1.0-7b4463c-x86_64-linux-gnu    \nNov 12 17:10:14.524  INFO \u2764\ufe0f  by patract labs <https://github.com/patractlabs>, 2020-2020    \nNov 12 17:10:14.524  INFO \ud83d\udccb Chain specification: Development    \n# ...\nNov 12 17:21:23.544  INFO Accepted a new tcp connection from 127.0.0.1:44210.    \nNov 12 17:21:32.238  INFO \ud83d\ude4c Starting consensus session on top of parent 0xc7e1ce585807b34b7fecabe1242cafb2628c958b984ec0aee7727cdd34117529    \nNov 12 17:21:32.252  INFO \ud83c\udf81 Prepared block for proposing at 1 [hash: 0x0109608217316a298c88135cf39a87cc31c37729fbe567b4a1a9f8dcdb81ebeb; parent_hash: 0xc7e1\u20267529; extrinsics (2): [0x2194\u2026baf8, 0x0931\u202658bb]]    \nNov 12 17:21:32.267  INFO Instant Seal success: CreatedBlock { hash: 0x0109608217316a298c88135cf39a87cc31c37729fbe567b4a1a9f8dcdb81ebeb, aux: ImportedAux { header_only: false, clear_justification_requests: false, needs_justification: false, bad_justification: false, needs_finality_proof: false, is_new_best: true } }    \n\n# open another shell window, the following command would print the changes for block height 1\n$ ./target/debug/europa state-kv 1 \nNov 12 15:53:27.699  INFO modified state for block:0x6c119a8f7de42e330aca8b9d3587937aacbbc203cc21650b60644c2f2d33e7fb    \nNov 12 15:53:27.699  INFO       key:26aa394eea5630e07c48ae0c9558cef702a5c1b19ab7a04f536c519aca4983ac|value:[DELETED]   \nNov 12 15:53:27.699  INFO       key:26aa394eea5630e07c48ae0c9558cef70a98fdbe9ce6c55837576c60c7af3850|value:05000000\n# ...\n")),(0,n.kt)("h2",{id:"cli-workspace"},"CLI: ",(0,n.kt)("inlineCode",{parentName:"h2"},"workspace")),(0,n.kt)("p",null,'Substrate could use the command -d/--base-path to assign a directory to store data, thus different environment could use different directory to distinguish. But -d directory is not recorded, so that developers should manage those different paths by themselves. Europa provide a concept of "workspace" to do this work based on the "base path". Developers could use command -w/--worksace to assign different workspace directory to run different Europa node instance. Europa also provides commands to operate "workspaces\u201d, like setting default workspace, listing all existed workspace, or deleting a workspace.'),(0,n.kt)("p",null,"In our workspace management, developers can switch different environments by setting different workspace. By using this feature, developers can switch between different environments to do test easily. On the other hand, this feature provides a friendly way for integration testing."),(0,n.kt)("h3",{id:"use-another-workspace"},"Use another workspace"),(0,n.kt)("h4",{id:"specify-another-workspace"},"Specify another workspace"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"$ ./target/debug/europa -w another-workspace\n# if you have specify a directory, add `-d` or `--base-path`\n$ ./target/debug/europa -d database -w another-workspace\n")),(0,n.kt)("h4",{id:"set-default-workspace"},"Set default workspace"),(0,n.kt)("p",null,"Stop the Europa, then execute:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"# another-workspace is the workspace name that we want to set as default.\n$ ./target/debug/europa workspace default another-workspace\nNov 12 17:28:41.980  INFO Current default workspace:    \nNov 12 17:28:41.981  INFO       default    \nNov 12 17:28:41.981  INFO     \nNov 12 17:28:41.981  INFO Set [another-workspace] as default workspace.  \n")),(0,n.kt)("p",null,'Then, start Europa. Europa will use "another-workspace" as default workspace.'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'$ ./target/debug/europa\n# ...\nNov 12 17:29:33.862  INFO \ud83d\udcbe Database: RocksDb at .sub/another-workspace/chains/dev/db    \nNov 12 17:29:33.862  INFO \ud83d\udcd6 Workspace: another-workspace | Current workspace list: ["default", "another-workspace"]    \nNov 12 17:29:33.862  INFO \u26d3  Native runtime: europa-1 (europa-1.tx1.au1)    \n')),(0,n.kt)("h4",{id:"delete-workspace"},"Delete workspace"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"$ ./target/debug/europa workspace delete another-workspace\nNov 12 17:30:49.549  INFO Current default workspace:    \nNov 12 17:30:49.549  INFO       another-workspace    \nNov 12 17:30:49.549  INFO     \nNov 12 17:30:49.550  INFO Delete workspace [another-workspace].    \nNov 12 17:30:49.550  INFO       delete default record: [another-workspace]    \nNov 12 17:30:49.550  INFO       delete workspace:[another-workspace] from workspace list\n")))}u.isMDXComponent=!0}}]);