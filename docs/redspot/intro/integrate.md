# Integrate into an existing contract project

Redspot can be easily integrated into existing contract projects. Let's take the contract in the examples directory in the official [ ink](https://github.com/paritytech/ink) repository as an example.

## Setup your project
Clone the ink warehouse and open the ink directory.
 ```bash
    git clone https://github.com/paritytech/ink.git
    cd ink
```

## Write configs
Create the following three files in the root directory of ink.
* **redspot.config.ts**
    ```typescript
    import { RedspotUserConfig } from 'redspot/types';
    import '@redspot/patract'; // import @redspot/patract plugin
    import '@redspot/chai'; // import @redspot/chai plugin
    export default {
      defaultNetwork: 'development', // default network
      contract: {
        ink: {
          toolchain: 'nightly',      // specify the toolchain version for contract compliation
          sources: ['examples/**/*'] // the directory where contracts locate
        }
      },
      networks: {
        // development network configuration
        development: {
          endpoint: 'ws://127.0.0.1:9944',
          types: {},
          gasLimit: '400000000000', // default gasLimit
          explorerUrl:
            'https://polkadot.js.org/apps/#/explorer/query/?rpc=ws://127.0.0.1:9944/'
        },
      },
      mocha: {
        timeout: 60000
      }
    } as RedspotUserConfig;
    ```

* **package.json**
    ```json
    {
      "name": "examples",
      "version": "0.1.0",
      "private": true,
      "resolutions": {
        "@polkadot/api": "^3.10.2",
        "@polkadot/api-contract": "^3.10.2"
      },
      "dependencies": {
        "@redspot/chai": "^0.10.1",
        "@redspot/patract": "^0.10.1",
        "@types/chai": "^4.2.14",
        "@types/mocha": "^8.0.3",
        "chai": "^4.2.0",
        "redspot": "^0.10.1",
        "typescript": "^4.0.2"
      },
      "scripts": {
        "build": "npx redspot compile",
        "test": "npx redspot test"
      }
    }
    ```

* **tsconfig.json**
    ```json
    {
      "compilerOptions": {
        "target": "es5",
        "module": "commonjs",
        "strict": true,
        "esModuleInterop": true,
        "outDir": "dist",
        "noImplicitAny": false
      },
      "include": [
        "**/*.ts"
      ],
      "exclude": [
        "node_modules"
      ],
      "files": [
        "./redspot.config.ts",
      ]
    }
    ```

## Install npm dependencies. 
It is recommended that you use [yarn](https://classic.yarnpkg.com/en/docs/install) as the package manager.
    ```bash
    yarn or npm install
    ```

## Compile your project
Run the `npx redspot compile` command in the root directory of the project to compile all contracts in the examples directory.
    ```bash
    npx redspot compile examples/erc20
    ```

This command will specify to compile the erc20 contract. After the compilation is complete, you can find the information generated by the compilation in the artifacts directory.

## Deploy contract

Now you can run a deployment script through Redspot.

1. Create a deploy.ts file in the root directory of ink.
    ```typescript
    import { network, patract } from "redspot";
    const { getContractFactory } = patract;
    const { getSigners, api } = network;
    async function run() {
        console.log("deploy erc20");
        await api.isReady;
        console.log("deploy erc201");
        const signers = await getSigners();
        const signer = signers[0];
        const contractFactory = await getContractFactory("erc20", signer);
        const contract = await contractFactory.deploy("new", "1000000", {
            gasLimit: "200000000000",
            value: "10000000000000000",
        });
        console.log(
            "Deploy successfully. The contract address: ",
            contract.address.toString()
        );
        api.disconnect();
    }
    run().catch((err) => {
        console.log(err);
    });
    ```

2. Make sure that the network has been configured correctly in redspot.config.ts.
    ```typescript
    {
            ...
            networks: {
        development: {
          endpoint: 'ws://127.0.0.1:9944', // 
          types: {},
          ...
        },
      },
    }
    ```

3. Add`--no-compile`to prevent repeated compilation and run the deploy.ts file.
    ```plain
    npx redspot run ./deploy.ts --no-compile
    ```

## Result verification

After the contract is successfully deployed, you can get information similar to this.

    Deploy successfully. The contract address:  5CqB5Mh9UdVbTE1Gt5PJfWSiCHydJaJsA31HjKGti1Z2fn78

## Test contract

Add the erc20.test.ts file in the tests directory to test the erc20 contract.

```typescript
import BN from 'bn.js';
import { expect } from 'chai';
import { patract, network, artifacts } from 'redspot';
const { getContractFactory, getRandomSigner } = patract;
const { api, getSigners } = network;
describe('ERC20', () => {
  after(() => {
    return api.disconnect();
  });
  async function setup() {
    const one = new BN(10).pow(new BN(api.registry.chainDecimals[0]));
    const signers = await getSigners();
    const Alice = signers[0];
    const sender = Alice;
    const contractFactory = await getContractFactory('erc20', sender);
    const contract = await contractFactory.deploy('new', '1000');
    const abi = artifacts.readArtifact('erc20');
    const receiver = await getRandomSigner();
    return { sender, contractFactory, contract, abi, receiver, Alice, one };
  }
  it('Assigns initial balance', async () => {
    const { contract, sender } = await setup();
    const result = await contract.query.balanceOf(sender.address);
    expect(result.output).to.equal(1000);
  });
  it('Transfer emits event', async () => {
    const { contract, sender, receiver } = await setup();
    await expect(contract.tx.transfer(receiver.address, 7))
      .to.emit(contract, 'Transfer')
      .withArgs(sender.address, receiver.address, 7);
  });
  it('Can not transfer above the amount', async () => {
    const { contract, receiver } = await setup();
    await expect(contract.tx.transfer(receiver.address, 1007)).to.not.emit(
      contract,
      'Transfer'
    );
  });
  it('Can not transfer from empty account', async () => {
    const { contract, Alice, one, sender } = await setup();
    const emptyAccount = await getRandomSigner(Alice, one.muln(10000));
    await expect(
      contract.tx.transfer(sender.address, 7, {
        signer: emptyAccount
      })
    ).to.not.emit(contract, 'Transfer');
  });
});
```

Run the test command.

```bash
npx redspot test --no-compile
```

You will get results similar to the following.

```bash
âœ“ Can not transfer from empty account (17912ms)
  4 passing (46s)
```