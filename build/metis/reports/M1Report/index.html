<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Metis(ink!标准库)项目的提案征求意见稿 | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/metis/reports/M1Report"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Metis(ink!标准库)项目的提案征求意见稿 | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="Metis 是 Patract 开发的 WebAssembly 合约标准库。Patract Labs 将联合社区力量一起制定各项 WebAssembly 合约标准，开发 ink! 和 Ask! 版本的对应实现，并进行专业机构审计。"><meta data-react-helmet="true" property="og:description" content="Metis 是 Patract 开发的 WebAssembly 合约标准库。Patract Labs 将联合社区力量一起制定各项 WebAssembly 合约标准，开发 ink! 和 Ask! 版本的对应实现，并进行专业机构审计。"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/metis/reports/M1Report"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/metis/reports/M1Report" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/en/metis/reports/M1Report" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/metis/reports/M1Report" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/assets/js/runtime~main.7085b59a.js" as="script">
<link rel="preload" href="/assets/js/main.b191e191.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>主页<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/metis/reports/M1Report" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="/en/metis/reports/M1Report" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">介绍</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/introduction">Substrate 合约书</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/overview">合约综述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/model">合约模型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/language">合约语言</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/wasm_first_step">Wasm简要介绍</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Metis</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/metis/introduction">Metis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/metis/tokens">ERC20</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/metis/access-control">Access Control</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Reports</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/metis/reports">Metis议会提案报告</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/metis/reports/M1Report">Metis(ink!标准库)项目的提案征求意见稿</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Metis(ink!标准库)项目的提案征求意见稿</h1></header><p>Metis 是 Patract 开发的 WebAssembly 合约标准库。Patract Labs 将联合社区力量一起制定各项 WebAssembly 合约标准，开发 ink! 和 Ask! 版本的对应实现，并进行专业机构审计。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="0-动机"></a>0. 动机<a class="hash-link" href="#0-动机" title="Direct link to heading">#</a></h2><p>我们认为，Wasm 合约生态中，一个类似于 Openzeppelin-contracts 的开发库是十分必要的，这就是Metis。出于对简单性与可读性的考虑，这个库提供的模式与元语应该尽可能与 Openzeppelin-contracts 保持一致，这样可以减少开发者的负担，同时有效的吸收 Solidity 生态所积累的经验。</p><p>不过需要意识到，基于 ink! 与 Ask! 的 Wasm 合约开发，与基于 Solidity 的 EVM 合约开发有着很大的不同。Wasm 成熟的体系支持，使得开发者可以使用各种不同的语言与工具开发智能合约，通过基于这些成熟或者快速迭代中的平台，开发者可以享受到大量的底层设施支持与开发经验积累，但是不同的语言和工具，往往具有不同的考量和权衡。这意味着，开发者会使用完全不同的代码，表达同样的机制与设计，这将会给社区带来巨大的沟通成本与心智负担。</p><p>面对这样的问题，我们需要总结与积累智能合约开发中的实现模式，这一思路由 Kent Beck 所著的「实现模式」一书中引入。总结实现模式的目的就在于，通过这些明确的模式清晰准确的表达出开发者的意图与想法，这样就可以实现&quot;别人能懂的代码&quot;，在合约开发中，这中思路是非常重要的。</p><p>从 Openzeppelin-contracts 中，我们可以看到其总结了数个智能合约开发中的实现模式，如基于 Solidity 继承语法的&quot;合约拓展模式&quot;，这些实现模式是 Solidity 生态中积累的宝贵经验。当然，不同的语言下，实践这些模式的方式有所不同，Metis 将会贯彻这些模式，并在不同平台提供对应的支持。例如在 Rust 中, 显然不能直接使用继承的方式实现合约拓展，对此 Metis 中将会提供代码实现范例，并提供一系列帮助库来减少开发者的心智成本。</p><p>Metis 将不仅仅是一个 Wasm 合约标准库，我们希望通过 Metis 的实践，在充分继承吸收以往合约开发经验的同时探索 Wasm 合约开发最佳实践。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-问题"></a>1. 问题<a class="hash-link" href="#1-问题" title="Direct link to heading">#</a></h2><p>目前基于合约的开发者主要面临以下几个问题:</p><ul><li>缺乏常见合约(如ERC20)的可靠实现</li><li>难以实现类似Solidity继承机制的合约组合与拓展</li><li>缺乏一系列可靠的公共组件以实现合约</li><li>缺乏基于ink!开发合约的经验积累和模式总结</li></ul><p>以上几个问题严重限制了当前基于ink!的合约开发生态, metis将会解决这些问题, 同时避免Solidity中已经存在的问题.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-metis合约开发库"></a>2. metis合约开发库<a class="hash-link" href="#2-metis合约开发库" title="Direct link to heading">#</a></h2><p>metis将会实现一系列通用组件, 类似于Openzeppelin-contracts开发库, 这些组件将会经过完善的测试和代码审计,
这些组件将会尽可能与 Openzeppelin-contracts 保持一致，这样可以减少开发者的负担，同时有效的吸收 Solidity 生态所积累的经验。</p><p>metis将会包含以下几部分组件:</p><ul><li>类Openzeppelin-contracts组件, 包括基础的Access与Security组件, 以及Token与Governance组件</li><li>面向ink!合约开发的组件, 基于wasm的合约可以支持更好的抽象机制, 我们可以实现更加复杂和实用的组件</li><li>从成熟合约项目中总结抽象的组件, metis将会吸纳社区的经验和积累, 既包括成熟的 Solidity生态, 也包括新兴的区块链合约项目.</li><li>ink!合约的拓展, 包括面向不同场景的基础数据结构等.</li></ul><p>在metis的前期版本中, 我们将会首先实现类Openzeppelin-contracts组件以供开发者使用, 这些组件包括:</p><ul><li>Token: ERC20, ERC721, ERC777, ERC1155以及上述Token合约的拓展合约</li><li>Access: Ownable, AccessControl, TimelockController</li><li>Security: PullPayment, ReentrancyGuard, Pausable</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-ink组件"></a>3. ink!组件<a class="hash-link" href="#3-ink组件" title="Direct link to heading">#</a></h2><p>Metis的大部分开发库都是由合约组件构成, 在Solidity, 可以基于继承来实现合约组件的引入, 一般来说合约组件将会包括以下几部分:</p><ul><li>组件Storage: 组件自身逻辑相关的存储状态, 这些状态无需对外暴露</li><li>组件Message: 组件面向外部的Message</li><li>组件Event: 组件自身逻辑将会触发(emit)的Event</li><li>组件内部接口: 供合约其他逻辑调用的接口</li></ul><p>例如常见的Ownable合约:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Solidity"><pre tabindex="0" class="prism-code language-Solidity codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">abstract contract Ownable is Context {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 组件Storage</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    address private _owner;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 组件Event</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 组件内部接口</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    modifier onlyOwner() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // 组件Message</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    function renounceOwnership() public virtual onlyOwner {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>如果一个合约需要具备Ownable, 则继承合约即可:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Solidity"><pre tabindex="0" class="prism-code language-Solidity codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">contract Escrow is Ownable {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>同样其他组件也可以通过继承具备Ownable:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Solidity"><pre tabindex="0" class="prism-code language-Solidity codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">contract Pausable is Ownable {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  function unpause() public onlyOwner whenPaused {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这里继承的意图实际上是组合而非<code>is-a</code>关系, 虽然在Solidity中过多的使用继承会带来很多问题, 但是针对特定意图的继承依然是重要的实现途径.</p><p>在基于ink!的合约开发, 通过metis, 我们也可以基于泛型和trait来实现同样的动机:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[metis::contract] // metis contract macro, will use ink_lang::contract auto</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod flipper {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[import(ownable)] // flipper import the ownable</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Flipper {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ownable: ownable::Data&lt;Flipper&gt;, // data by ownable</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value: bool,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(ownable)] // TODO: event in ink! will refactor</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct OwnershipTransferred {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl Flipper {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn flip(&amp;mut self) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // check owner</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ownable::Impl::ensure_caller_is_owner(self);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.value = !self.value;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn renounce_ownership(&amp;mut self) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ownable::Impl::renounce_ownership(self) // owner message</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>metis通过一系列帮助宏来辅助开发者实现相同的功能, 为了提高合约的可审计性, 这里我们希望用户明确的实现storage, event与message的声明.</p><p>同时metis完善了组件的实现方式:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Storage</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[metis::component::storage]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Data&lt;E&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">where</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    E: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner: Lazy&lt;Option&lt;E::AccountId&gt;&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Event trait</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub trait EventEmit&lt;E: Env&gt;: EnvAccess&lt;E&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Impl trait</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub trait Impl&lt;E: Env&gt;: Storage&lt;E&gt; + EventEmit&lt;E&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // logics</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn init(&amp;mut self) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_mut().set_ownership(&amp;Some(Self::caller()));</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn renounce_ownership(&amp;mut self) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.ensure_caller_is_owner();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.emit_event_ownership_transferred(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.get().get_ownership().clone(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            None);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_mut().set_ownership(&amp;None);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Panic if `owner` is not an owner</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn ensure_owner(&amp;self, owner: &amp;E::AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        assert!(&amp;self.get().get_ownership().clone().unwrap() == owner);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这样的组件可以通过继承其他组件来拓展其功能, 例如一个具有销毁代币功能的Erc20组件:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub trait Impl&lt;E&gt;: erc20::Impl&lt;E&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">where</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    E: Env,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn _burn(&amp;mut self, account: &amp;E::AccountId, amount: E::Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn burn(&amp;mut self, amount: E::Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self._burn(&amp;Self::caller(), amount)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn burn_from(&amp;mut self, account: &amp;E::AccountId, amount: E::Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>基于metis, 我们可以在限定的意图之下, 实现Solidity通过继承实现的各种合约组合模式, 同时借助rust的零成本抽象, 这些抽象不会带来额外的性能消耗.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-路线图"></a>4. 路线图<a class="hash-link" href="#4-路线图" title="Direct link to heading">#</a></h2><p>metis for ink!分为五个里程碑:</p><ul><li>[M1] 实现基础的组件宏和组件, 完善对于组件的测试支持, 开发者可以基于metis构建常见的DAPP</li><li>[M2] 完善组件宏, 完善组件的开发支持, 开发者可以构建自定义的组件. 完成metis组件对应的api支持.</li><li>[M3] 丰富组件库, 完成面向治理与金融机制的组件及API支持, 完善适用于合约开发的数学库以支持需要复杂计算的Defi类合约.</li></ul><p>考虑到目前的ink!与contract-pallet依然在迭代中, 一些metis特性将会基于后续的改进来实现, 包括:</p><ul><li>合约Proxy与可升级支持, 将会依赖于后续合约call的改进<a href="https://github.com/paritytech/ink/issues/739" target="_blank" rel="noopener noreferrer">739</a>.</li><li>组件中的Event, 当前ink!中的Event不能独立于合约<a href="https://github.com/paritytech/ink/issues/759" target="_blank" rel="noopener noreferrer">759</a>, 现在的组件中的event仅仅早期的实现, 后续会基于ink!的改进而重构.</li></ul><p>随着ink!合约社区的丰富和完备, metis也会进一步实现更多公共的组件和库, 辅助开发者开发大型的合约项目. 因此我们可能会安排 [MR] 里程碑。</p><p>其将会基于ink!的迭代进度安排开发.</p><ul><li>[MR] 根据基于ink!的迭代进度及社区反馈，合约升级, 合约代理与跨合约调用支持, 重构Event相关实现， 完善基础组件并添加开发辅助宏, 在保证可审计性的情况下减少重复代码。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-m1里程碑计划"></a>5. M1里程碑计划<a class="hash-link" href="#5-m1里程碑计划" title="Direct link to heading">#</a></h2><ul><li>M1.1 设计并完善支持开发metis组件的宏, 确定组件开发范式</li><li>M1.2 设计并完善支持合约引入metis组件的宏, 确定合约拓展与引入组件的开发范式</li><li>M1.3 设计并完善针对组件的单元测试支持</li><li>M1.4 设计并完善基于redspot的集成测试支持</li><li>M1.5 完成Access相关组件的实现与测试</li><li>M1.6 完成Security相关组件的实现与测试</li><li>M1.7 完成Token相关组件的实现与测试</li><li>M1.8 完成详细的metis组件设计文档</li><li>M1.9 完成metis组件使用文档及示例</li></ul><p>M1检查点如下:</p><p>完成metis组件相关的宏及测试, 所有测试可以通过.
完成详细的metis组件设计文档.
完成以下合约组件的实现及测试, 所有测试可以通过:</p><ul><li>ERC20及其拓展组件(包括可增发, 可销毁等)</li><li>ERC721及其拓展组件</li><li>ERC777及其拓展组件</li><li>ERC1155及其拓展组件</li><li>Ownable</li><li>AccessControl</li><li>TimelockController</li><li>PullPayment</li><li>ReentrancyGuard</li><li>Pausable</li></ul><p>完成上述合约组件的文档及示例.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/metis/reports/M1Report.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/metis/reports"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Metis议会提案报告</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/carpo/introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Carpo »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#0-动机" class="table-of-contents__link">0. 动机</a></li><li><a href="#1-问题" class="table-of-contents__link">1. 问题</a></li><li><a href="#2-metis合约开发库" class="table-of-contents__link">2. metis合约开发库</a></li><li><a href="#3-ink组件" class="table-of-contents__link">3. ink!组件</a></li><li><a href="#4-路线图" class="table-of-contents__link">4. 路线图</a></li><li><a href="#5-m1里程碑计划" class="table-of-contents__link">5. M1里程碑计划</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.7085b59a.js"></script>
<script src="/assets/js/main.b191e191.js"></script>
</body>
</html>