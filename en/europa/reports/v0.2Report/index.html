<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">v0.2Report | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/substrate-contracts-book/en/europa/reports/v0.2Report"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="v0.2Report | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="Report for Europa v0.2"><meta data-react-helmet="true" property="og:description" content="Report for Europa v0.2"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-contracts-book/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/substrate-contracts-book/en/europa/reports/v0.2Report"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/europa/reports/v0.2Report" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/en/europa/reports/v0.2Report" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/europa/reports/v0.2Report" hreflang="x-default"><link rel="stylesheet" href="/substrate-contracts-book/en/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/runtime~main.7645ed62.js" as="script">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/main.a780d21c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-contracts-book/en/"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Site</b></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/substrate-contracts-book/europa/reports/v0.2Report" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡</a></li><li><a href="/substrate-contracts-book/en/europa/reports/v0.2Report" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/introduction">Substrate contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/overview">Contract overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/model">Contract model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/language">Contract language</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/wasm_first_step">Brief introduction of Wasm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Europa</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Get Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/intro/overview">Europa Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/intro/europa-ui">Europa UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/intro/europa-cli">Europa CLI</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/architecture">Architeture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/implementation">Contract Pallet Implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/custom-rpcs">Custom RPCs and commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/contract-log">Europa contract execution log</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/backtrace">Europa&#x27;s Wasm Backtrace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/debug-example">Europa debugging example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/wasm-executor">Europa Wasm executor</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Chain Extensions</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/extensions/custom-chain-extensions">Custom ChainExtensions</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Reports</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/reports">Report for Europa proposals</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/reports/v0.1Report">Report for Europa v0.1</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-contracts-book/en/europa/reports/v0.2Report">v0.2Report</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/reports/v0.3Report">v0.3Report</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Metis</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">v0.2Report</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="report-for-europa-v02"></a>Report for Europa v0.2<a class="hash-link" href="#report-for-europa-v02" title="Direct link to heading">#</a></h2><p>Six weeks ago, Patract Hub (<a href="https://patract.io" target="_blank" rel="noopener noreferrer">https://patract.io</a>) applied a <a href="https://polkadot.polkassembly.io/treasury/27" target="_blank" rel="noopener noreferrer">Treasury Proposal #27</a> for Europa v0.2 , and now we have finished all the development work in (<a href="https://github.com/patractlabs/Europa" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/Europa</a>). Europa is kind of another implementation for <a href="https://github.com/paritytech/substrate/tree/master/client" target="_blank" rel="noopener noreferrer">Substrate client</a> in our design. We know that the runtime of a blockchain is the business logic that defines its behavior, and the Substrate runtime need to run by an executor and environment. So that we design the executor and environment more like a &quot;sandbox&quot; to run a Substrate runtime.</p><p>In v0.2, the primary target is to modify <code>Pallet Contracts</code> in runtime to provide more detailed debugging information, including contract execution process information (in <code>Pallet Contracts</code> layer) and Wasm execution information (in WASMI execution layer).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="recap-of-europas-future-plan"></a>Recap of Europa&#x27;s future plan<a class="hash-link" href="#recap-of-europas-future-plan" title="Direct link to heading">#</a></h3><ul><li><del>v0.1: Have an independent runtime environment to facilitate more subsequent expansion directions.</del></li><li><del>v0.2: Modify at FRAME Contracts pallet level to provide more information</del></li><li>v0.3: Improve the development experience, strengthen collaboration with other tools, and extend the sandbox to be compatible with other runtime modulesã€‚</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="recap-of-verification-for-europa-v02"></a>Recap of verification for Europa v0.2:<a class="hash-link" href="#recap-of-verification-for-europa-v02" title="Direct link to heading">#</a></h3><blockquote><ul><li>Construct incorrect contracts and execute logs printing to determine whether it meets expectations</li><li>Display the call statistics of the <code>define_env!</code> interface during contract execution</li><li>Execute the log printing function, provide formatted printing examples of different data, and judge whether it meets expectations</li><li>Construct a contract that crashes under different conditions and record the log after execution. Then judge whether the backtrace information of the contract execution is completely printed, and check whether it matches the actual execution of the collapsed contract.</li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1design"></a>1.Design<a class="hash-link" href="#1design" title="Direct link to heading">#</a></h2><p>In 0.2, the debugging information function of the upgrade contract module is divided into three parts of modification:</p><ul><li>Modification on the <code>Pallet Contracts</code> layer: By adding trace during the execution of the contract by <code>Pallet Contracts</code>, the information in the contract layer is recorded, and the calling level of the contract is recorded. On the other hand, the error message of calling Wasm execution is improved.</li><li>Modification on the <code>wasmi</code> layer: We have provided the backtrace function of recording wasm execution for <code>wasmi</code>, and provided support for <code>parity-wasm</code>, <code>pwasm-utils</code>, and <code>cargo-contract</code> during wasm processing of the contract contains the function of the name section.</li><li>Contract logging function: Use the function of <code>ChainExtensions</code> to realize the library for printing the <code>log</code> in the contract.</li></ul><p>In the current <code>Pallet Contracts</code>, when an error occurs in the execution of <code>wasmi</code>, and in the <a href="https://webassembly.github.io/spec/core/exec/runtime.html#function-instances" target="_blank" rel="noopener noreferrer">host_function</a> call of <code>Pallet Contracts</code> during the execution of wasmi, it will be displayed as a <code>ContractTrap</code> error externally. In this situation, it is difficult for developers to locate the cause of the error. Only from this information, it is impossible to tell whether the problem is the contract itself, <code>ink!</code>, or <code>Pallet Contracts</code>. Therefore, the rich information that Europa v0.2 can provide allows developers to directly locate the cause of the problem.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="11-on-pallet-contracts-layer"></a>1.1 on <code>Pallet Contracts</code> layer<a class="hash-link" href="#11-on-pallet-contracts-layer" title="Direct link to heading">#</a></h3><p>During the contract debugging process, Europa believes that developers need:</p><ol><li>Rich error information: Wasm records the error information during the entire execution process, including Wasm executor errors and host_function errors. The backtrace information of wasmi will be unified with the error information here.</li><li>Execution in the debugging process: The main modification information of <code>Pallet Contracts</code>, the &quot;contract stack&quot; is used to record the process of contract calling contract, and any information that can assist debugging during the execution of this layer of contract, such as the situation of calling the host_function, selector, and calling contract parameters, etc.</li></ol><p>Therefore, in response to such needs, Europa made the following designs and modifications:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="111-rich-error-information"></a>1.1.1 rich error information<a class="hash-link" href="#111-rich-error-information" title="Direct link to heading">#</a></h4><p><strong>1.error on the wasm executor layerï¼š</strong> </p><p>Europa designed our own <code>ep-sandbox</code> to replace the original <code>sp-sandbox</code> used by <code>Pallet Contracts</code>, and modified <code>ep_sandbox::Error</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">use patract_wasmi::Error as WasmiError;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Error {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Module(WasmiError),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OutOfBounds,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Execution,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WasmiExecution(WasmiError),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>Module(WasmiError)</code> carries the original error information of the Wasm layer, and the <code>to_execution_result</code> in <code>frame/contracts/src/wasm/runtime.rs</code> is converted to <code>String</code> to throw an error message.</p><p>Europa&#x27;s own <code>ep-sandbox</code> only has the <code>std</code> version (because Europa has removed all Wasm parts, there is no need for <code>ep-sandbox</code> to support <code>no-std</code>), so in the future, <strong><code>ep-sandbox</code> can be replaced with different wasm executors to support running tests of different wasm executors, and replaced with wasm executors that support debugging and other features. </strong></p><p>Currently <code>ep-sandbox</code> uses a forked version of <code>wasmi</code> as the executor, so the error it throws is <code>WasmiError</code>. See the next chapter for errors in<code>wasmi</code>.</p><p><strong>2.error of host_functions:</strong></p><p>The host function execution error will cause Trap, and will record <code>TrapReason</code>. No modification to the data structure, just record.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="112-execution-during-debugging"></a>1.1.2 Execution during debugging<a class="hash-link" href="#112-execution-during-debugging" title="Direct link to heading">#</a></h4><p>The Europa forked version of <code>Pallet Contracts</code> has designed an object to record any information that can help debugging during contract execution:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Record the contract execution context.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Current depth</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    depth: usize,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The current contract execute result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext_result: ExecResult,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The value in sandbox successful result</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sandbox_result_ok: Option&lt;ReturnValue&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Who call the current contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    caller: AccountId32,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The account of the current contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    self_account: Option&lt;AccountId32&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The input selector</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    selector: Option&lt;HexVec&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The input arguments</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    args: Option&lt;HexVec&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The value in call or the endowment in instantiate</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    value: u128,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The gas limit when this contract is called</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gas_limit: Gas,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The gas left when this contract return</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gas_left: Gas,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The host function call stack</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env_trace: EnvTraceList,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The error in wasm</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    wasm_error: Option&lt;WasmErrorWrapper&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The trap in host function execution</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    trap_reason: Option&lt;TrapReason&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Nested contract execution context</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nest: Vec&lt;NestedRuntime&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the model of <code>Pallet Contracts</code>, a contract calling another contract is in the &quot;contract stack&quot; model, so <code>NestedRuntime</code> will track the execution process of the entire contract stack, and use the property of <code>nest</code> to store a list of <code>NestedRuntime</code> to represent other contracts the the contract called.</p><p>In the process of executing a contract by <code>Pallet Contracts</code>, Europa records the relevant information in the execution process in the structure of <code>NestedRuntime</code> in the form of a bypass, and will print the <code>NestedRuntime</code> to the log (show the case later) in a certain format after the contract call ends. Contract developers can analyze the information printed by <code>NestedRuntime</code> to obtain various detailed information during the execution of the contract, which can be used in various situations:</p><ol><li>help to locate where the error occurs, including the following situations:<ol><li><code>Pallet Contracts</code> layer</li><li><code>ink!</code> layer</li><li>The specific position in the contract layer</li><li>Locate which level of the contract is when a contract calling another contract</li></ol></li><li>Analyze the information during the execution of the contract at this timing:<ol><li>Analyze the consumption of gas execution</li><li>Analyze the call of <code>get_storage</code> and <code>set_storage</code>, help reconstruct the contract code and analyze the demand of <code>rent</code></li><li>According to <code>selector</code>, <code>args</code> and <code>value</code>, analyze and locate whether the transaction parameters of the third-party SDK are legal.</li><li>Analyze the execution path of the contract and adjust the contract based on the <code>nest</code> information and combined with the <code>seal_call</code> information.</li><li>etc.</li></ol></li></ol><p>The process of recording <code>Pallet Contracts</code> executing contract to <code>NestEdRuntime</code> is relatively fine-grained.
The process of logging the information of the execution contract of <code>Pallet Contracts</code> to <code>NestEdRuntime</code> is relatively fine-grained. Take <code>seal_call</code> in <code>define_env!</code> as an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct SealCall {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    callee: Option&lt;HexVec&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gas: u64,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    value: Option&lt;u128&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    input: Option&lt;HexVec&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    output: Option&lt;HexVec&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The attributes are basically <code>Option&lt;&gt;</code>. For example, before calling the contract, the <code>input</code> will be set to <code>Some</code>, and the return value will be set after the calling contract is normal. If there is an error in the calling contract, then <code>output</code> will remain <code>None</code>. Therefore, if <code>input</code> is <code>Some</code> and <code>output</code> is <code>None</code>, it means that there is a problem with the called contract during the process of calling the contract.</p><p>The current information of <code>NestedRuntime</code> is only printed in the log. <strong>In the future, <code>NestedRuntime</code> will be stored locally and provide corresponding RPC for external access</strong>. Therefore, in the future, third-party applications can obtain <code>NestedRuntime</code> for further processing. For example, in our <code>Redspot</code>, a plug-in can be designed to generate a contract call another contract topology based on the information of <code>NestedRuntime</code>, and a visual contract call path can be generated on the web wallet interface, etc.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="12-on-wasmi-layer"></a>1.2 on <code>wasmi</code> layer<a class="hash-link" href="#12-on-wasmi-layer" title="Direct link to heading">#</a></h3><p>We forked wasmi and integrated it into <code>ep-sandbox</code>. Forked <code>Pallet Contracts</code> can obtain the error information of forked <code>wasmi</code> through <code>ep-sandbox</code>, including the backtrace information of <code>wasmi</code>.</p><p>If you need to make <code>wasmi</code> can retain the backtrace information during execution, you need to have the following functions:</p><ol><li>The &quot;name section&quot; section is required in the Wasm source file (see <a href="https://webassembly.github.io/spec/core/appendix/custom.html#name-section" target="_blank" rel="noopener noreferrer">the specification of name section)</a>)</li><li>Keep the &quot;name section&quot; information in the process of checking the contract by <code>Pallet Contracts</code> and still have a corresponding relationship with the wasm source file after the process.</li><li>During the execution of <code>wasmi</code>, the execution stack needs to be preserved with the key information of the functions. At the same time, the &quot;name section&quot; needs to be parsed and correspond to the function information reserved by the <code>wasmi</code> execution stack.</li></ol><p>The changes to 2 involve <code>cargo-build</code> and <code>parity-wasm</code>, while the changes to 1 and 3 are mainly in the forked <code>wasmi</code>, and a small part involves <code>pwasm-utils</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="121-submitted-wasm-files-contains-debug-info-from-name-section"></a>1.2.1 Submitted Wasm files contains debug info from &quot;name section&quot;<a class="hash-link" href="#121-submitted-wasm-files-contains-debug-info-from-name-section" title="Direct link to heading">#</a></h4><ul><li>PR: <a href="https://github.com/paritytech/cargo-contract/pull/131" target="_blank" rel="noopener noreferrer">paritytech/cargo-contract#131</a></li><li>Source: <a href="https://github.com/patractlabs/cargo-contract" target="_blank" rel="noopener noreferrer">patractlabs/cargo-contract</a></li></ul><p>Frist of all, we have to submit <strong>wasm files which contain the debug info</strong> that the on-chain side can parse and get the panic errors.</p><p>Currently, <a href="https://github.com/patractlabs/cargo-contract" target="_blank" rel="noopener noreferrer">parity/cargo-contract</a> trims debug info while building contracts, we can get them back with the following steps.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-keep-name-section-from-striping"></a>1. Keep name section from striping<a class="hash-link" href="#1-keep-name-section-from-striping" title="Direct link to heading">#</a></h5><p>The name section has been striped at <a href="https://github.com/paritytech/cargo-contract/blob/71525f9ec5f21e6113a614c2fb4d1eb5e62ebf8b/src/cmd/build.rs#L247" target="_blank" rel="noopener noreferrer">cargo-contract/cmd/build.rs#L247</a>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-keep-debug-info-from-wasm-opt"></a>2. Keep debug info from <code>wasm-opt</code><a class="hash-link" href="#2-keep-debug-info-from-wasm-opt" title="Direct link to heading">#</a></h5><p><code>cargo-contract</code> passes <code>debug_info: false</code> to <code>wasm-opt</code>, so the debug-info will be always optimized when we run <code>wasm-opt</code>, the code is here: <a href="https://github.com/paritytech/cargo-contract/blob/71525f9ec5f21e6113a614c2fb4d1eb5e62ebf8b/src/cmd/build.rs#L267" target="_blank" rel="noopener noreferrer">cargo-contract/cmd/build.rs#L267</a>.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-keep-debug-info-from-rustc"></a>3. Keep debug info from <code>rustc</code><a class="hash-link" href="#3-keep-debug-info-from-rustc" title="Direct link to heading">#</a></h5><p><code>cargo-contract</code> executes realease build by default, here we can enable debug build or modify the opt-level flag of <code>rustc</code> to keep debug infos at <a href="https://github.com/paritytech/cargo-contract/blob/71525f9ec5f21e6113a614c2fb4d1eb5e62ebf8b/src/cmd/build.rs#L137" target="_blank" rel="noopener noreferrer">cargo-contract/cmd/build.rs#L137</a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="122-save-debug-info-from-the-scraper-of-pallet-contracts"></a>1.2.2 Save debug info from the scraper of <code>Pallet Contracts</code><a class="hash-link" href="#122-save-debug-info-from-the-scraper-of-pallet-contracts" title="Direct link to heading">#</a></h4><p>What happends to the <code>Pallet Contracts</code> while we calling a contract?</p><ul><li><strong>Get the Wasm binary from storage</strong></li><li><strong>Inject gas meter to the contract</strong></li><li>Inject stack height to the contract</li><li>Put the contract into <code>sp-sandbox</code> and execute it</li><li>Get the result from <code>sp-sandbox</code> and return the result to us</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-store-name-section-while-building-wasm-module"></a>1. Store name section while building Wasm module<a class="hash-link" href="#1-store-name-section-while-building-wasm-module" title="Direct link to heading">#</a></h5><ul><li>PR: <a href="https://github.com/paritytech/parity-wasm/pull/300" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/parity-wasm/pull/300</a></li></ul><p><code>Pallet Contracts</code> builds Wasm modules from storage and drops custom sections by default, here we should get them back.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-update-function-indices-in-name-section-while-injecting-gas-meter"></a>2. Update function indices in name section while injecting gas meter<a class="hash-link" href="#2-update-function-indices-in-name-section-while-injecting-gas-meter" title="Direct link to heading">#</a></h5><ul><li>PR: <a href="https://github.com/paritytech/wasm-utils/pull/146" target="_blank" rel="noopener noreferrer">paritytech/wasm-utils#146</a></li><li>Source: <a href="https://github.com/patractlabs/wasm-utils" target="_blank" rel="noopener noreferrer">patractlabs/wasm-utils#146</a></li></ul><p><code>Pallet Contracts</code> reorders the indcies of functions in our Wasm contracts after injecting gas memter to the Wasm contracts at <a href="https://github.com/paritytech/wasm-utils/blob/d9432bafa9321f8e0e5b8a143f1ed858dbbbe272/src/gas/mod.rs#L467" target="_blank" rel="noopener noreferrer">paritytech/wasm-utils/gas/mod.rs#L467</a>, this will mess up the function indecies in name section that we can not get the correct backtraces.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-impelment-wasm-backtrace-to-wasmi"></a>3. Impelment Wasm backtrace to WASMI<a class="hash-link" href="#3-impelment-wasm-backtrace-to-wasmi" title="Direct link to heading">#</a></h4><ul><li>Source: <a href="https://github.com/patractlabs/wasmi" target="_blank" rel="noopener noreferrer">patractlabs/wasmi</a></li></ul><p>Remember the last two steps in chapter 2, the core part of enabling Wasm backtrace to <code>Pallet Contract</code> is making <code>wasmi</code> support backtrace.</p><p>The process of executing a function in the interpreter of wasmi is like:</p><ul><li>Invoke the target function</li><li>call and call and call over again<ul><li>Panic if the process breaks.</li></ul></li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="add-function-info-field-to-funcref"></a>Add function info field to <code>FuncRef</code><a class="hash-link" href="#add-function-info-field-to-funcref" title="Direct link to heading">#</a></h5><p><code>FuncRef</code> is the &#x27;function&#x27; wasmi interpreter calling directly, so we need to embed the debug info into the <code>FuncRef</code> as the first time, source at <a href="https://github.com/patractlabs/wasmi/blob/v0.6.2/src/func.rs#L26" target="_blank" rel="noopener noreferrer">wasmi/func.rs#L26</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//! patractlabs/wasmi/src/func.rs#L26</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct FuncRef {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Function name and index for debug</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    info: Option&lt;(usize, String)&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="set-function-info-using-name-section-while-parsing-wasm-modules"></a>Set function info using name section while parsing Wasm modules<a class="hash-link" href="#set-function-info-using-name-section-while-parsing-wasm-modules" title="Direct link to heading">#</a></h5><p>We alread have the <code>info</code> field in <code>FuncRef</code>, now we need to fill this field using name section while parsing Wasm modules, source at <a href="https://github.com/patractlabs/wasmi/blob/7a6feaea70f47aa6e62f097fb0d9a4ea0ce7d1fc/src/runner.rs#L1491" target="_blank" rel="noopener noreferrer">wasmi/module#L343</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//! wasmi/src/module.rs#L343</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if has_name_section {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     if let Some(name) = function_names.get((index + import_count) as u32) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         func_instance = func_instance.set_info(index, name.to_string());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     } else {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         func_instance = func_instance.set_info(index, &quot;&lt;unknown&gt;&quot;.to_string());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="make-the-interpreter-support-trace"></a>Make the interpreter support <code>trace</code><a class="hash-link" href="#make-the-interpreter-support-trace" title="Direct link to heading">#</a></h5><p>However, we don&#x27;t need to get infos of every functions but the panicked series in the stack of the interpreter, source at <a href="https://github.com/patractlabs/wasmi/blob/7a6feaea70f47aa6e62f097fb0d9a4ea0ce7d1fc/src/runner.rs#L1491" target="_blank" rel="noopener noreferrer">wasmi/runner.rs#L1491</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//! wasmi/src/runner.rs#L1491</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Get the functions of current the stack</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn trace(&amp;self) -&gt; Vec&lt;Option&lt;&amp;(usize, String)&gt;&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    self.buf.iter().map(|f| f.info()).collect::&lt;Vec&lt;_&gt;&gt;()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="gather-debug-infos-when-program-breaks"></a>Gather debug infos when program breaks<a class="hash-link" href="#gather-debug-infos-when-program-breaks" title="Direct link to heading">#</a></h5><p>Just gather backtraces when we invoke function failed, source at <a href="https://github.com/patractlabs/wasmi/blob/7a6feaea70f47aa6e62f097fb0d9a4ea0ce7d1fc/src/func.rs#L170" target="_blank" rel="noopener noreferrer">wasmi/func.rs#L170</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//! wasmi/src/func.rs#L170</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let res = interpreter.start_execution(externals);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if let Err(trap) = res {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let mut stack = interpreter</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .trace()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .iter()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .map(|n| {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if let Some(info) = n {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            format!(&quot;{:#}[{}]&quot;, rustc_demangle::demangle(&amp;info.1), info.0)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;&lt;unknown&gt;&quot;.to_string()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .collect::&lt;Vec&lt;_&gt;&gt;();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Append the panicing trap</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stack.append(&amp;mut trap.wasm_trace().clone());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stack.reverse();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Embed this info into the trap</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Err(trap.set_wasm_trace(stack))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="13-contract-log-functions"></a>1.3 Contract Log functions<a class="hash-link" href="#13-contract-log-functions" title="Direct link to heading">#</a></h3><p>In the process of contract debugging, you need to know the internal execution of the contract and the intermediate data. In the current lack of debugging conditions (such as using gdb for debugging), log printing is the most convenient way. As mentioned in the Europa v0.2 proposal, the current <code>Pallet Contracts</code> and <code>ink!</code> already support <code>format!</code>+<code>seal_println</code> to format and print strings, but this mode has two defects :</p><ol><li>All the logs of <code>seal_println</code> printed on the node side are <code>target: runtime</code> and level <code>DEBUG</code>, but when developing complex contracts, a lot of logs will be printed. If you cannot filter by <code>target</code> and log level, then the development process will be full of interference from irrelevant information.</li><li>The contract developer wrote <code>seal_println</code> when needed during the development process, but all <code>seal_println</code> must be deleted when the contract is released. Although the contract developer can encapsulate a conditionally compiled function to control it, it is more convenient if a tool library already provides such a function.</li></ol><p>Therefore, Europa provides a log library <a href="https://github.com/patractlabs/ink-log" target="_blank" rel="noopener noreferrer">patractlabs/ink-log</a> that mimics Rust&#x27;s <code>log</code> crete to solve the above problems. Its usage is the same as that of Rust. <code>log</code> is completely consistent, which reduces the learning cost of developers.</p><p>The <code>ink-log</code> is generally implemented by the <code>ChainExtension</code> of <code>Pallet Contracts</code>, the agreed <code>function_id</code> is <code>0xfeffff00</code>, and the message is transmitted in the wasm memory through the structure <code>LoggerExt</code>. Therefore this library is divided into the following two parts:</p><ol><li><p><code>ink_log</code>: In the <code>ink-log/contracts</code> directory, provide <code>info!</code>, <code>debug!</code>, <code>warn!</code>, <code>error!</code>, <code>trace!</code>, same as Rust&#x27;s <code>log</code> library in the same macro, and the call method of the macro is also the same. These macros are packaged implementations of <code>seal_chain_extensions</code> on the ink! side, and are <strong>tool library for contract developers</strong>. For example, after this library is introduced in the contract <code>Cargo.toml</code>, the log can be printed as follows:</p><p>In <code>Cargo.toml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cargo"><pre tabindex="0" class="prism-code language-cargo codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_log = { version = &quot;0.1&quot;, git = &quot;https://github.com/patractlabs/ink-log&quot;, default-features = false, features = [&quot;ink-log-chain-extensions&quot;] }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[features]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default = [&quot;std&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">std = [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ink_log/std&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the contract, you can use the following methods to print logs in the node:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_log::info!(target: &quot;flipper-contract&quot;, &quot;latest value is: {}&quot;, self.value);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><p><code>runtime_log</code>: In the <code>ink-log/runtime</code> directory, this library is based on the contents of the <code>function_id</code> and <code>LoggerExt</code> structures passed from <code>ChainExtensions</code> to call the corresponding logs under <code>debug</code> in <code>frame_support</code> to print. It is an implementation library of <code>ink_log</code> prepared for developers of the chain. **For example, chain developers can use it in their own <code>ChainExtensions</code>:</p><p>   In <code>Cargo.toml</code>ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">runtime_log = { version = &quot;0.1&quot;, git = &quot;https://github.com/patractlabs/ink-log&quot;, default-features = false }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[features]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default = [&quot;std&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">std = [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;runtime_log/std&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>   In <code>ChainExtensions</code>&#x27;s implementationï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct CustomExt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl ChainExtension for CustomExt {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn call&lt;E: Ext&gt;(func_id: u32, env: Environment&lt;E, InitState&gt;) -&gt; Result&lt;RetVal, DispatchError&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    where</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &lt;E::T as SysConfig&gt;::AccountId: UncheckedFrom&lt;&lt;E::T as SysConfig&gt;::Hash&gt; + AsRef&lt;[u8]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        match func_id {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ... =&gt; {/* other ChainExtension */ }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            0xfeffff00 =&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // TODO add other libs</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                runtime_log::logger_ext!(func_id, env);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // or use</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // LoggerExt::call::&lt;E&gt;(func_id, env)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                Ok(RetVal::Converging(0))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }   </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><code>ink_log</code> corresponds to <code>runtime_log</code>, so if contract developers need to use <code>ink_log</code>, they need to pay attention to the chain corresponding to the debugging contract that needs to implement <code>runtime_log</code>. </strong></p><p>On the other hand, after contract developers introduce <code>ink_log</code>, they need to pay attention to <code>features = [&quot;ink-log-chain-extensions&quot;]</code>, <code>ink_log</code> will call <code>seal_chain_extensions</code> to interact with the chain only when this feature is enabled. Without this feature, <code>noop</code> will be used to skip the process of contract printing.</p><p>Therefore, contract developers can control the contract to print logs in the debugging environment and the production environment through features. The contract compiled in the debugging environment opens the <code>&quot;ink-log-chain-extensions&quot;</code> feature, and the contract compiled in the production environment removes this feature.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-what-europa-can-do-in-v02"></a>2. What Europa can do in v0.2<a class="hash-link" href="#2-what-europa-can-do-in-v02" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-build"></a>2.1 Build<a class="hash-link" href="#21-build" title="Direct link to heading">#</a></h3><p>For contract developers, it is necessary to prepare <code>Europa</code> and <code>cargo-contract</code> tools.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="211-europa"></a>2.1.1 Europa<a class="hash-link" href="#211-europa" title="Direct link to heading">#</a></h4><p>The building process for this project is as same as <a href="https://github.com/paritytech/substrate/" target="_blank" rel="noopener noreferrer">Substrate</a>.</p><p>When building finished, current executable file in <code>target</code> directory is named <code>Europa</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone --recurse-submodules https://github.com/patractlabs/Europa.git</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="212-cargo-contract"></a>2.1.2 cargo-contract<a class="hash-link" href="#212-cargo-contract" title="Direct link to heading">#</a></h4><p>If you want to see the backtrace executed by Wasm during the operation of Europa, you must use the <code>cargo-contract</code> version we provide. Because the current paritytech repo <a href="https://github.com/paritytech/cargo-contract" target="_blank" rel="noopener noreferrer">cargo-contract</a> uses the highest optimization level when compiling the contract, and discards the &quot;name section&quot; part in Wasm. As mentioned above, if you need to print the call stack information in the wasmi execution contract, the contract file must have the &quot;name section&quot; part, so the use of the <code>cargo-contract</code> provided by paritytech cannot meet the requirements. We completed this function in our forked repo. On the other hand, we think that the function of &quot;name section&quot; in Wasm may not only be needed by Europa, so we submitted <a href="https://github.com/paritytech/cargo-contract/pull/131" target="_blank" rel="noopener noreferrer">pr#131[Enable debug info to the source warehouse with flag in command build]</a> provides this feature.</p><p>Before this PR is merged, currently only the <code>cargo-contract</code> version provided by us (Patract Labs) can be used:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> --git https://github.com/patractlabs/cargo-contract --branch cmd/debug --force</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you do not want this version of <code>cargo-contract</code> to override the version released by paritytech, then it is recommended to compile locally and use the compiled <code>cargo-contract</code> directly:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/patractlabs/cargo-contract --branch cmd/debug</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cargo-contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo build --release</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>Note: Executing the <code>cargo-contract build</code> command requires the <code>default toolchain</code> of the rust tool-chain to be <code>nightly</code>, otherwise you can only use <code>cargo +nightly contract build</code>, but using <code>cargo</code> to call <code>cargo-contract</code> needs to be executed <code>cargo install</code> installs or overwrites the compiled product in the <code>~/.cargo/bin</code> directory, and cannot co-exist with paritytech&#x27;s <code>cargo-contract</code></p></blockquote><p>Execute:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo-contract build --help</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># or</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo +nightly contract build --help</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you can see:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FLAGS:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -d, --debug      </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Emits debug info into wasm </span><span class="token function" style="color:rgb(130, 170, 255)">file</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It means that you are using the <code>cargo-contract</code> provided by Patract Labs. If you want to see the backtrace of the Wasm contract execution crash while using Europa, you need to add the <code>--debug</code> command when compiling the contract.</p><p>Using the <code>--debug</code> command will generate another file besides the normal file in the <code>target/ink</code> directory of the originally compiled contract, ending with <code>*.src.wasm</code>. This <code>*.src.wasm</code> file is the Wasm contract file containing the &quot;name section&quot; part.</p><p><strong>If you need to use Europa for testing, the contract deployed to Europa needs to use this <code>*.src.wasm</code> file instead of the originally generated <code>*.wasm</code> file. </strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example"></a>example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h3><p>We can use one simple case and other cases we have encountered to verify the reliability of Europa&#x27;s positioning problems.</p><p>In the following context, the methods of starting Europa are all used by:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ Europa --tmp -lruntime</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">debug</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Every time Europa is started in this way, new data is created. If you want to keep Europa&#x27;s execution data, please refer to Europa&#x27;s <a href="https://github.com/patractlabs/europa" target="_blank" rel="noopener noreferrer">README</a> or Europa v0.1&#x27;s [Report](<a href="https://polkadot.polkassembly.io/post/" target="_blank" rel="noopener noreferrer">https://polkadot.polkassembly.io/post/</a> 166), you can get more command introduction.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="case-1ï¼šsimple-case"></a>Case 1ï¼šSimple case<a class="hash-link" href="#case-1ï¼šsimple-case" title="Direct link to heading">#</a></h4><p>For example, we modify the example contract <code>ink/example/erc20</code> in the <a href="https://github.com/paritytech/ink" target="_blank" rel="noopener noreferrer">ink!</a> project as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn transfer(&amp;mut self, to: AccountId, value: Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let from = self.env().caller();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    self.transfer_from_to(from, to, value)?;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    panic!(&quot;123&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Wasm, it corresponds to the code after the macro expansion of the original file, so if you want to compare the errors of the call stack, you need to expand the macro of the original contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">expand</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> ink/example/erc20</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo </span><span class="token function" style="color:rgb(130, 170, 255)">expand</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> tmp.rs</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After reading the <code>tmp.rs</code> file, we can know that Wasm needs to go through when it executes the <code>transfer</code> function:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> u32 </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Erc20 as ::ink_lang::DispatchUsingMode</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::dispatch_using_mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain">Erc20 as ::ink_lang::ConstructorDispatcher</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::Type as ::ink_lang::Execute</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># compile selector at here</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> ::ink_lang::execute_message_mut</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> move </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">state: </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">mut Erc20</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># a closure</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">__ink_Msg</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> 2644567034usize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> as ::ink_lang::MessageMut</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::CALLABLE</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> transfer</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Therefore, if the <code>panic</code> in <code>transfer</code> is encountered during the contract call, the backtrace of Wasm should be similar to this.</p><p>First we start Europa:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ Europa --tmp -lruntime</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">debug</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then we deploy this erc20 and call transfer to execute.</p><p>We can use <a href="https://polkadot.js.org/apps" target="_blank" rel="noopener noreferrer"><code>Polkadot/Substrate Portal</code></a> or use <a href="https://redspot.patract.io/en/tutorial/" target="_blank" rel="noopener noreferrer">RedSpot</a> to verify this process. Suppose we use <code>RedSpot</code> to execute a <code>transfer</code> call of this wrong ERC20 contract. Please note that the <code>--debug</code> subcommand must be added in the process of compiling the contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ npx redspot-new erc20</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> erc20/contracts</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># add panic in `transfer` function as abrove</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">vim</span><span class="token plain"> lib.rs </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># notice must add --debug when compile contract</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># due current cargo-contract is not paritytech, we need to copy compile product into `artifacts` directory. RedSpot would support Europa and PatractLabs&#x27;s cargo-contract in next version.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo +nightly contract build --debug </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/artifacts</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># notice must cp erc20.src.wasm, not erc20.wasm</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> ./target/ink/erc20.src.wasm </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/artifacts  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># notice must rename metadata.json to erc20.json</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> ./target/ink/metadata.json </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/artifacts/erc20.json </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># enter redspot console, use `--no-compile` to deny recompile contract</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ npx redspot console --no-compile  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># in redspot console</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Welcome to Node.js v12.16.1.Type </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.help&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">more</span><span class="token plain"> information.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> var factory </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> await patract.getContractFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># do following command could deploy the erc20 contract</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> var contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> await factory.deployed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;new&#x27;</span><span class="token plain">, </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1000000&#x27;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">value: </span><span class="token number" style="color:rgb(247, 140, 108)">20000000000</span><span class="token plain">, salt:1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># do a transfer call directly</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> await contract.transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;5GcTYx4dPTQfi4udKPvE4VKmbooV7zY6hNYVF9JXHJL4knNF&quot;</span><span class="token plain">, </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then in Europa&#x27;s log, you can see:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext_result: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">failed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> ExecError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error: DispatchError::Module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">index:5, error:17, message: Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ContractTrapped&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">, orign: ErrorOrigin::Caller </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    caller: d43593c715fdd31c61141abd04a99fd6822</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">5GrwvaEF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    self_account: b6484f58b7b939e93fff7dc10a654af7e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">5GBi41bY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    selector: 0xfae3a09d,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    args: 0x1cbd2d43530a44705ad088af313e18f80b5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    value: </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gas_limit: </span><span class="token number" style="color:rgb(247, 140, 108)">409568000000</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    gas_left: </span><span class="token number" style="color:rgb(247, 140, 108)">369902872067</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env_trace: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_value_transferred</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0x00000000000000000000000000000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0xfae3a09d1cbd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_get_storage</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">((</span><span class="token variable" style="color:rgb(191, 199, 213)">Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x0100000000000</span><span class="token variable" style="color:rgb(191, 199, 213)">....</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token variable" style="color:rgb(191, 199, 213)"> Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x010000000100000001000000</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_caller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0xd43593c715fdd31c61141abd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_hash_blake256</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">((</span><span class="token variable" style="color:rgb(191, 199, 213)">Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x696e6b20686173</span><span class="token variable" style="color:rgb(191, 199, 213)">....</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token variable" style="color:rgb(191, 199, 213)"> Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x0873b31b7a3cf</span><span class="token variable" style="color:rgb(191, 199, 213)">....</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...  </span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_deposit_event</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">((</span><span class="token variable" style="color:rgb(191, 199, 213)">Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">[</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x45726332303a</span><span class="token variable" style="color:rgb(191, 199, 213)">...</span><span class="token variable number" style="color:rgb(247, 140, 108)">.00000000000</span><span class="token variable" style="color:rgb(191, 199, 213)">]</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token variable" style="color:rgb(191, 199, 213)"> Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x000</span><span class="token variable" style="color:rgb(191, 199, 213)">..</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    trap_reason: TrapReason::SupervisorError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DispatchError::Module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> index: </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain">, error: </span><span class="token number" style="color:rgb(247, 140, 108)">17</span><span class="token plain">, message: Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ContractTrapped&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    wasm_error: Error::WasmiExecution</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trap </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> kind: Unreachable </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        wasm backtrace: </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  core::panicking::panic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  erc20::erc20::_::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">impl erc20::erc20::Erc2</span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1697</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">erc20::erc20::_::__ink_Msg</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2644567034</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> as ink_lang::traits::MessageMut</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::CALLABLE::</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">closure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">611</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  core::ops::function::FnOnce::call_once</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">610</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">erc20::erc20::_::_::__ink_MessageDispatchEnum as ink_lang::dispatcher::Execute</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::execute::</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">closure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1675</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  ink_lang::dispatcher::execute_message_mut</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1674</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">erc20::erc20::_::_::__ink_MessageDispatchEnum as ink_lang::dispatcher::Execute</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1692</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  erc20::erc20::_::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">impl ink_lang::contract::DispatchUsingMode </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> erc20::erc20::Erc2</span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::dispatch_using_mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1690</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1691</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â•°â”€</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">unknown</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2387</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nest: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let us explain the information printed above:</p><ol><li><p><code>ext_result</code>: indicates that this contract call is displayed as successful or failed:</p><ol><li><code>[success]</code>: indicates the successful execution of this contract (Note: the successful execution of the contract does not mean the successful execution of the business logic of the contract itself. There may be an error return in <code>ink!</code> or the business logic of the contract itself, as in case 3 in the following text.) And the <code>ExecResultValue {flag:0, data: 0x...}</code> followed by <code>[success]</code> indicates the return value after this contract is executed.</li><li><code>[failed]</code>: indicates that the execution of this contract failed, and the <code>ExecError {.. }</code> followed by <code>[failed]</code> indicates the cause of this error. The reason for this is the value recorded in <code>event</code> on the chain, which is the value defined in <code>decl_error!</code> of <code>Pallet Contracts</code>.</li></ol></li><li><p><code>1: NestedRuntime </code>&amp;<code>nest</code>: The contract information that represents the current print information is located in the first layer of the contract call stack. If the current contract calls another contract, it will appear in the array of the <code>nest</code> field. <code>2: NestedRuntime</code> and <code>1: NestedRuntime</code> has the same structure. Among them, <code>2</code> indicates that the called contract is in the second layer of the contract call stack. If several contracts are called across contracts in the current contract, there will be several <code>NestedRuntime</code> in the array of <code>nest</code>. If there are other contract calls in the second-level contract, the same goes for.</p><p>For example, if there are contracts A, B, C, if it is the following situation:</p><ol><li><p>After A calls B, it returns to A to continue execution, and then calls contract C</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">|A|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |-&gt;|B|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |&lt;-</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |-&gt;|C|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |&lt;-</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then it will produce a log print similar to the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1: NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> self_account: A,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> nest:[</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     2: NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         self_account: B,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         nest:[],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     2: NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         self_account: C,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         nest:[],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>After A calls B, B calls contract C again, and finally returns to A</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">|A|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |-&gt;|B|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |  | |-&gt;|C|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |  | |&lt;-</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| |&lt;-</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then it will produce a log print similar to the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1: NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> self_account: A,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> nest:[</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     2: NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         self_account: B,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         nest:[</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            3: NestedRuntime {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self_account: C,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                nest:[],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         ],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     }  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol></li><li><p><code>caller</code>: who is the caller of the current contract. If the contract calls the contract, the value of the called contract is the address of the upper-level contract.</p></li><li><p><code>self_account</code>: represents the address of the current contract itself.</p></li><li><p><code>selector</code> &amp; <code>args</code>&amp;<code>value</code>: Represents the <code>selector</code> and parameters passed in when calling the current contract. <strong>These information can quickly locate whether the calling contract method is correct</strong>.</p></li><li><p><code>gas_limit</code> &amp; <code>gas_left</code>: Represents the <code>gas_limit</code> passed in when the contract is currently called and the remaining gas after <strong>executing this layer</strong>. Note here that <code>gas_left</code> refers to the remaining gas after the execution of this layer of contract, so In the contract call contract, the gas consumed by each layer of contract can be determined through <code>gas_left</code>, not only get the consumption after the execution of the entire contract.</p></li><li><p><code>env_trace</code>: Indicates that during the execution of the current layer of the contract, each time host_function is called in the contract Wasm execution, a record will be added to the list here. Because all host_functions and the definitions in <a href="https://github.com/paritytech/substrate/blob/master/frame/contracts/src/wasm/runtime.rs#L610" target="_blank" rel="noopener noreferrer"><code>define_env!</code> in the <code>Pallet Contracts</code> module</a> are related, so tracing <code>env_trace</code> can trace the process of interacting with <code>Pallet Contracts</code> during the execution of the current Wasm contract. </p><p>For example, if following thing appears in <code>env_trace</code>:</p><ul><li><code>seal_call</code>: It means that there is a contract call contract situation in the current contract. According to the order in which <code>seal_call</code> appears in <code>env_trace</code>, it can correspond to <code>nest</code> to calculate the state before and after the contract calls the contract.</li><li><code>seal_get_storage</code>&amp;<code>seal_set_storage</code>: It means that data read and write occurred in the contract. Through these two interfaces, it is possible to intercept and count the data read and write during the execution of the current contract, and the data size calculated by <strong><code>seal_set_storage</code> can also be used to infer the storage size required by <code>rent</code>. </strong></li><li><code>seal_deposit_event</code>: indicates that the event is printed in the contract. Here you can intercept the content of each event separately, instead of getting a unified event at the end. And the following text will use an example to surface that Europa can quickly locate the bug in the <code>host_function</code>.</li></ul><p>On the other hand, the statistics of <code>env_trace</code> are relatively <strong>fine-grained</strong>. For example, if there are multiple possible errors in <code>host_function</code>, when an error occurs, all the information before the error will be retained, so it can be located to the place where the problem occurred during the execution of <code>host_function</code>.</p><p>And if there is an error in <code>host_function</code> that causes the contract to end execution, <code>env_trace</code> records the last error <code>host_function</code> call, so you can directly locate which <code>host_function</code> caused the contract execution exception.</p></li><li><p><code>trap_reason</code>: According to the definition of <code>TrapReason</code> in <code>Pallet Contracts</code>, <code>trap_reason</code> can be divided into 2 categories:</p><ol><li><code>Return</code> &amp; <code>Termination</code> &amp; <code>Restoration</code>: indicates that the contract exit is the design of <code>Pallet Contracts</code>, not an internal error. This type of trap indicates that the contract is executed normally and is not an error.</li><li><code>SupervisorError</code>: Indicates that an error occurred during the execution of the contract calling host_function.</li></ol><p>Therefore, the current Europa log printing design is designed to record whenever <code>trap_reason</code> appears. On the other hand, <code>trap_reason</code> may not always appear during the execution of the contract. Combining the design of <code>Pallet Contracts</code> and <code>ink!</code>, there is a case where the successful execution of the contract or the execution failure in the <code>ink!</code> layer does not generate <code>trap_reason</code>. Therefore, in addition to recording <code>trap_reason</code>, Europa also <strong>records the results returned by the Wasm executor after execution, which is recorded with <code>sandbox_result_ok</code>. </strong></p></li></ol><ol start="9"><li><p><code>sandbox_result_ok</code>: The value of <code>sandbox_result_ok</code> represents the result of the contract after the Wasm executor is executed. This value could have been recorded as <code>sandbox_result</code>, including correct and incorrect conditions. However, due to the limitations of Rust and combined with the business logic of <code>Pallet Contracts</code>, only the result of <code>sandbox_result</code> is kept as <code>Ok</code> here. <strong>For log printing, Europa is designed to print <code>sandbox_result_ok</code> only when trap_reason is the first case, as information to assist in judging contract execution. </strong></p><p> <code>sandbox_result_ok</code> is the Wasm executor <a href="https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f/frame/contracts/src/wasm/mod.rs#L155-L156" target="_blank" rel="noopener noreferrer">result after calling <code>invoke</code></a> After the processing of <code>to_execution_result</code>, if there is no <code>trap_reason</code>, the result of <code>Ok(..)</code> is [discarded](<a href="https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f</a> /frame/contracts/src/wasm/runtime.rs#L366-L368). But in fact there are two situations here:</p><ol><li>An error occurred in <code>ink!</code>: According to the implementation of <code>ink!</code>, before calling the functions wrapped by the contract <code>#[ink(message)]</code> and <code>#[ink(constructor)]</code>, the input The process of decoding and matching <code>selector</code>. If an error occurs during this process, the contract will return <a href="https://github.com/paritytech/ink/blob/abd5cf14c0883cb2d5acf81f2277aeec330aa843/crates/lang/src/error.rs#L22" target="_blank" rel="noopener noreferrer">error code <code>DispatchError</code></a>. But for the Wasm executor, the Wasm code is executed normally, so the result will be returned, including this error code. <strong>This contract execution process is an error situation. </strong></li><li>The return value of <code>#[ink(message)]</code> is defined as <code>()</code>: According to the implementation of <code>ink!</code>, if the return value type is <code>()</code>, <code>seal_reason</code> will not be called, so it will not Contains <code>trap_reason</code>. <strong>This contract execution process is an correct situation. </strong></li></ol><p>Since <code>ink!</code> is only a contract implementation that runs on <code>Pallet Contracts</code>, other implementations may have different rules, so currently <code>sandbox_result_ok</code> is only used to assist in determining the execution of the <code>ink!</code> contract, the value is <a href="https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f/primitives/wasm-interface/src/lib.rs#L462-L467" target="_blank" rel="noopener noreferrer"><code> ReturnValue</code></a>. Among them, if the <code>&lt;num&gt;</code> part of <code>ReturnValue::Value(&lt;num&gt;)</code> of the log is not 0, it means that there may be an error in the execution of <code>ink!</code>. You can use <code>ink!</code> for <a href="https://github.com/paritytech/ink/blob/abd5cf14c0883cb2d5acf81f2277aeec330aa843/crates/lang/src/error.rs#L66-L80" target="_blank" rel="noopener noreferrer"><code>DispatchError</code> The error code</a> determines the error.</p></li><li><p><code>wasm_error</code>: indicates the backtrace when Wasm executes an error. This part will be printed only when <code>ext_result</code> is <code>failed</code>.</p><p> In the above example, because the execution of <code>transfer</code> will trigger <code>panic</code>, you can see that the cause of the error here is <code>WasmiExecution(Trap(Trap {kind: Unreachable }))</code>, indicating that this time the failure is due to execution The situation of <code>Unreacble</code> in the contract process is caused, and the backtrace information below also <strong>very accurately describes</strong> the function execution call stack when an error is encountered after the expansion of the contract macro discussed above. The following calling process can be clearly found from the backtrace.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">call -&gt; dispatch_using_mode -&gt; ... -&gt; transfer -&gt; panic </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This process is consistent with the original information of the contract.</p></li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="case-2ï¼šcontracttrap-caused-by-locating-duplicate-topics"></a>Case 2ï¼š<code>ContractTrap</code> caused by locating duplicate topics<a class="hash-link" href="#case-2ï¼šcontracttrap-caused-by-locating-duplicate-topics" title="Direct link to heading">#</a></h4><p>Some time ago, we (Patract Labs) reported a bug to <code>ink!</code>, see issue:<a href="https://github.com/paritytech/ink/issues/589" target="_blank" rel="noopener noreferrer">&quot;When set &#x27;0&#x27; value in contracts event, may cause <code>Error::ContractTrapped</code> and panic in contract #589&quot; </a>. It is very difficult to locate this error before Europa has developed the relevant function. Thank you @athei <a href="https://github.com/paritytech/ink/issues/589#issuecomment-731571918" target="_blank" rel="noopener noreferrer">located the error</a>. Here we reproduce this error and use Europa&#x27;s log to quickly analyze and locate the place where the bug appears:</p><ol><li><p>checkout <code>ink!</code> to commit <code>8e8fe09565ca6d2fad7701d68ff13f12deda7eed</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> ink</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> checkout 8e8fe09565ca6d2fad7701d68ff13f12deda7eed -b tmp</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Go in <code>ink/examples/erc20/lib.rs:L90</code> to change <code>value</code> to <code>0_u128</code> in <code>Transfer</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn new(initial_supply: Balance) -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Self::env().emit_event(Transfer {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        from: None,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        to: Some(caller),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // change this from `initial_supply` to `0_u128`</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value: 0_u128.into() // initial_supply,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    instance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Execute <code>cargo +nightly contract build --debug</code> to compile the contract</p></li><li><p>Use <a href="https://redspot.patract.io/en/tutorial/" target="_blank" rel="noopener noreferrer">RedSpot</a> or <a href="https://polkadot.js.org/apps" target="_blank" rel="noopener noreferrer"><code>Polkadot/Substrate Portal</code></a> to deploy this contract ( Note that you must use the erc20.src.wasm file)</p></li></ol><p>You should encounter <code>DuplicateTopics</code> in the deployment phase (before this <a href="https://github.com/paritytech/substrate/pull/7762" target="_blank" rel="noopener noreferrer">bug</a> is corrected, the reported error is <code>ContractTrap</code>), and in the Europa log Will show:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env_trace: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0xd183512b0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#...    </span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_deposit_event</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">((</span><span class="token variable" style="color:rgb(191, 199, 213)">Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">[</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x45726332303a3a5472616e736</span><span class="token variable" style="color:rgb(191, 199, 213)">....]</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token variable" style="color:rgb(191, 199, 213)"> None</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    trap_reason: TrapReason::SupervisorError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DispatchError::Module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> index: </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain">, error: </span><span class="token number" style="color:rgb(247, 140, 108)">23</span><span class="token plain">, message: Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DuplicateTopics&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    wasm_error: Error::WasmiExecution</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trap </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> kind: Host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DummyHostError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        wasm backtrace: </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  ink_env::engine::on_chain::ext::deposit_event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1623</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  ink_env::engine::on_chain::impls::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">impl ink_env::backend::TypedEnvBackend </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> ink_env::engine::on_chain::EnvInstance</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::emit_event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1564</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  ink_env::api::emit_event::</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">closure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1563</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ink_env::engine::on_chain::EnvInstance as ink_env::engine::OnInstance</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::on_instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1562</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  ink_env::api::emit_event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1561</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  erc20::erc20::_::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">impl ink_lang::events::EmitEvent</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">erc20::erc20::Erc2</span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">0</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> ink_lang::env_access::EnvAccess</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain">erc20::erc20::Erc20 as ink_lang::env_access::ContractEnv</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::Env</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token plain">::emit_event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1685</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  deploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1691</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â•°â”€</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">unknown</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2385</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nest: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see from the above log:</p><ol><li>The last record of <code>env_trace</code> is <code>seal_deposit_event</code> instead of <code>seal_return</code> (when the contract is executed correctly, the last record must be <code>seal_return</code>)</li><li>The second parameter of <code>seal_deposit_event</code> is <code>None</code> instead of an existing value, which indicates that the host_function of <code>seal_deposit_event</code> has not been executed, but an error occurred during the execution (see the forked dependency of Europa) See the [corresponding implementation] (<a href="https://github.com/patractlabs/substrate/blob/3624deb47cabe6f6cd44ec2c49c6ae5a29fd2198/frame/contracts/src/wasm/runtime.rs#L1399" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/substrate/blob/3624deb47cabe6f6cd44ec2c49c6ae5a29fd2198/frame/contracts/src/wasm/runtime.rs#L1399</a>) for the source code of the version of <code>Pallet Contracts</code>.</li><li>Combined with the error stack of wasm backtrace, we can intuitively see that the top call stack of backtrace is <code>deposit_event</code>.</li></ol><p>Therefore, combining the above information, we can directly infer that the host_function of <code>seal_deposit_event</code> has an exception during the execution. (Before the submission of <code>Pallet Contracts</code><a href="https://github.com/paritytech/substrate/pull/7762" target="_blank" rel="noopener noreferrer">pull#7762</a>, we recorded the error message in host_function. After the merge, we used <code>trap_reason</code> unified error message.)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="case-3-when-error-is-caused-by-the-chain-using-type-balanceu64-instead-of-type-balanceu128"></a>Case 3: When error is caused by the chain using <code>type Balance=u64</code> instead of <code>type Balance=u128</code><a class="hash-link" href="#case-3-when-error-is-caused-by-the-chain-using-type-balanceu64-instead-of-type-balanceu128" title="Direct link to heading">#</a></h4><p>If the chain uses the definition of <code>Balance=u64</code>, and the definition of <code>Balance</code> in the chain is unknown to <code>ink!</code> (the default definition of Balance is <code>u128</code>). Therefore, when using <code>u128</code> to define <code>Balance</code>&#x27;s <code>ink!</code> as a dependency compiled contract, when running on a chain where <code>Balance</code> is defined as <code>u64</code>, it will cause the <code>Pallet Contracts</code> module to transfer values to the contract , The contract internally regards the <code>value</code> of <code>u64</code> as a decoding error of <code>u128</code>.</p><p>Take the example contract of erc20 as an example, after expanding the macro of the contract, you can see:</p><ul><li>When there is an error in the <code>dispatch_using_mode</code> stage of decoding <code>input</code>, the contract returns with <code>::ink_lang::DispatchError::CouldNotReadInput</code>, but the model design of <code>Pallet Contracts</code> believes that the Wasm contract execution is not abnormal.</li><li>In the call of <code>call</code>, since <code>deny_payment</code> is checked before calling <code>dispatch_using_mode</code>, and if an Error is returned when checking <code>deny_payment</code>, it will be directly <code>panic</code>.</li></ul><p>Therefore, in this case, the contract for deploying (<code>Instantiate</code>) ERC20 will execute normally, and any method of ERC20 such as <code>transfer</code> will be called with <code>ContractTrap</code>.</p><p>Let&#x27;s look at these two situations separately:</p><ol><li><p><code>instantiate</code> stageï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext_result: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">success</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> ExecError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error: DispatchError::Module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">index:5, error:17, message: Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ContractTrapped&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">, orign: ErrorOrigin::Caller </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env_trace: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0xd183512b008cb6611e0100000000000000000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_caller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0xd43593c715fdd31c61141abd04a99fd682</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_set_storage</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">((</span><span class="token variable" style="color:rgb(191, 199, 213)">Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x030000000100000</span><span class="token variable" style="color:rgb(191, 199, 213)">...</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token variable" style="color:rgb(191, 199, 213)"> Some</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable number" style="color:rgb(247, 140, 108)">0x000000000000000</span><span class="token variable" style="color:rgb(191, 199, 213)">...</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sandbox_result_ok: RuntimeValue::Value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nest: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>From the above log, we can see:</p><ol><li><p>The end of <code>env_trace</code> does not end with <code>seal_return</code>, it means that the contract has not been executed normally. Because it can be seen from the design of <code>ink!</code> that if you enter <code>#[ink(constructor)]</code> normally or enter <code>#[ink(message)]</code>, then must be executed to <code>::ink_lang::execute_message </code> (<code>::ink_lang::execute_message</code> will call <code>seal_return</code>), and the absence of <code>seal_return</code> means that the execution has not reached the stage of <code>execute</code>.</p></li><li><p><code>sandbox_result_ok</code> indicates that the return value of the execution is <code>7</code>. By querying <code>ink!</code> for the implementation of <code>DispatchError</code>, you can see that this error code represents <code>CouldNotReadInput</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DispatchError::CouldNotReadInput =&gt; Self(0x07),</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>According to the expanded code of the contract macro, you can see that in the <code>dispatch_using_mode</code> function, <code>::ink_env::decode_input</code> is called before calling <code>execute</code>, and this function has a <code>return Error</code> situation. Therefore, it is reasonable to guess that an exception occurred when parsing <code>input</code>. The input parameter <code>args:0x008cb6611e0100000000000000000000</code> is recorded in the log. Observing this parameter, it can be found that its length is significantly smaller than the <code>u128</code> code. Therefore, it can be inferred from <code>args</code> and <code>env_trace</code> that an error occurred when decoding <code>input</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// this part code is expanded by erc20 example.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">::ink_env::decode_input::&lt;&lt;Erc20 as ::ink_lang::ConstructorDispatcher&gt;::Type&gt;().map_err(|_| ::ink_lang::DispatchError::CouldNotReadInput)?</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol></li></ol><p>At this point, the contract instantiation is successful, but the constructor to execute the instantiation exists. Therefore, the contract exists on the chain but the process of <code>#[ink(constructor)]</code> is not executed normally.</p><ol start="2"><li><p>The <code>call</code> stage, such as calling <code>transfer</code>:</p><p> Calling <code>transfer</code> to the above successfully instantiated function, <code>ContractTrap</code> will appear, Europa&#x27;s log shows as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext_result: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">failed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> ExecError </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> error: DispatchError::Module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">index:5, error:17, message: Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ContractTrapped&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">, orign: ErrorOrigin::Caller </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env_trace: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        seal_value_transferred</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">0x0000000000000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    wasm_error: Error::WasmiExecution</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Trap </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> kind: Unreachable </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">))</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        wasm backtrace: </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  core::panicking::panic_fmt.60</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1743</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  core::result::unwrap_failed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">914</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  core::result::Result</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">T,E</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">915</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  ink_lang::dispatcher::deny_payment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1664</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1691</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        â•°â”€</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">unknown</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2387</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nest: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>First notice that the last record of <code>env_trace</code> is still not <code>seal_return</code>, and the error cause of <code>wasm_error</code> is <code>WasmiExecution::Unreachable</code>. Therefore, it can be determined that <code>panic</code> or <code>expect</code> was encountered during the execution of the contract.</p><p> From the wasm backtrace, it is very obvious that the execution process is</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   call -</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> deny_payment -</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">expect</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>According to the code expanded macro (<code>cd ink/examples/erc20; cargo expand&gt; tmp.rs</code>), we can see:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#[no_mangle]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn call</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> u32 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     ::ink_lang::deny_payment::</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain">Erc20 as ::ink_lang::ContractEnv</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::Env</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .expect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;caller transferred value even though all ink! message deny payments&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ::ink_lang::DispatchRetCode::from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Erc20 as ::ink_lang::DispatchUsingMode</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">::dispatch_using_mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ::ink_lang::DispatchMode::Call,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .to_u32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>   Therefore, it can be judged that an error was returned in <code>deny_payment</code> during the execution of the contract in the process of <code>transfer</code>, and the direct processing of the error as <code>expect</code> resulted in the execution result of <code>wasmi</code> being <code>Unreachable</code> Tracking the code of <code>deny_payment</code> can find that the function returns <code>expect</code> caused by <code>Error</code></p><blockquote><p>Noteï¼ŒThe relevant code is as follows:</p><p>In <code>ink_lang</code> <a href="https://github.com/paritytech/ink/blob/master/crates/lang/src/dispatcher.rs#L140-L150" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/ink/blob/master/crates/lang/src/dispatcher.rs#L140-L150</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn deny_payment&lt;E&gt;() -&gt; Result&lt;()&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">where</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    E: Environment,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    let transferred = ink_env::transferred_balance::&lt;E&gt;()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .expect(&quot;encountered error while querying transferred balance&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if transferred != &lt;E as Environment&gt;::Balance::from(0u32) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return Err(DispatchError::PaidUnpayableMessage)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>There will be a difference between the <code>off_chain</code> part and the <code>on_chain</code> part in the ink</strong>, <code>off_chain</code> will think that an error is returned at the stage of <code>ink_env::transferred_balance::&lt;E&gt;()</code>, so it is executing<code> After transferred_balance</code>, you will encounter <code>expect</code> which leads to <code>panic</code>, and part of <code>on_chain</code> is taken from the memory of wasm, it will normally get the characters corresponding to u128 length and decode to get <code>transferred</code>, which is just decoded The result will not meet expectations, causing <code>transferred!=0</code> to make <code>deny_payment</code> return an Error, and the part where <code>deny_payment</code> is called in the macro expansion of the contract triggers <code>expect</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">if true {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ::ink_lang::deny_payment::&lt;&lt;Erc20 as ::ink_lang::ContractEnv&gt;::Env&gt;()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .expect(&quot;caller transferred value even though all ink! message deny payments&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Therefore, for wasm backtrace, <code>expect</code> appears when <code>deny_payment</code> is called in <code>call</code>, not when <code>transferred_balance</code> is called in <code>deny_payment</code>.</p><p><strong>This example side shows that <code>ink!</code> currently does not completely correspond to the processing of <code>off_chain</code> and <code>on_chain</code>, and may cause difficult-to-check errors for contract users in some cases</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="verify-v02"></a>Verify v0.2<a class="hash-link" href="#verify-v02" title="Direct link to heading">#</a></h2></blockquote><ul><li><p><del>Construct incorrect contracts and execute logs printing to determine whether it meets expectations</del></p></li><li><p><del>Display the call statistics of the <code>define_env!</code> interface during contract execution</del></p><ul><li><p>run test case <code>instantiate_return_code</code> in <a href="https://github.com/patractlabs/substrate/blob/europa-contracts/frame/contracts/src/tests.rs" target="_blank" rel="noopener noreferrer">patractlabs/substrate branch:europa-contracts</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> europa/vendor/substrate/frame/contracts</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> --package pallet-contracts --lib tests::instantiate_return_code -- --exact</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># then you could see</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    caller: 0101010101010101010101010101010101010101010101010101010101010101 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">5C62Ck4U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>run test case <code>run_out_of_gas</code> in <a href="https://github.com/patractlabs/substrate/blob/europa-contracts/frame/contracts/src/tests.rs" target="_blank" rel="noopener noreferrer">patractlabs/substrate branch:europa-contracts</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> europa/vendor/substrate/frame/contracts</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> --package pallet-contracts --lib tests::run_out_of_gas -- --exact</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: NestedRuntime </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#...</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        gas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    trap_reason: TrapReason::SupervisorError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">DispatchError::Module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> index: </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">, error: </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">, message: Some</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OutOfGas&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    nest: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><p>Anyone can check whether the printed log matching with the test case.</p></li><li><p><del>Execute the log printing function, provide formatted printing examples of different data, and judge whether it meets expectations</del></p><p>Using <a href="https://github.com/patractlabs/ink-log" target="_blank" rel="noopener noreferrer"><code>ink-log</code></a> in <code>ink!</code> example could test this part.</p></li><li><p><del>Construct a contract that crashes under different conditions and record the log after execution. Then judge whether the backtrace information of the contract execution is completely printed, and check whether it matches the actual execution of the collapsed contract.</del></p><p>We provide a test case repo <a href="https://github.com/patractlabs/europa_contracts_test_templates" target="_blank" rel="noopener noreferrer">europa_contracts_test_templates</a>. Any one could using Polkadot/Substrate Portal or RedSpot to deploy and call this test contract to verify this.</p></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/europa/reports/v0.2Report.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-contracts-book/en/europa/reports/v0.1Report"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Report for Europa v0.1</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-contracts-book/en/europa/reports/v0.3Report"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">v0.3Report Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#report-for-europa-v02" class="table-of-contents__link">Report for Europa v0.2</a><ul><li><a href="#recap-of-europas-future-plan" class="table-of-contents__link">Recap of Europa&#39;s future plan</a></li><li><a href="#recap-of-verification-for-europa-v02" class="table-of-contents__link">Recap of verification for Europa v0.2:</a></li></ul></li><li><a href="#1design" class="table-of-contents__link">1.Design</a><ul><li><a href="#11-on-pallet-contracts-layer" class="table-of-contents__link">1.1 on <code>Pallet Contracts</code> layer</a></li><li><a href="#12-on-wasmi-layer" class="table-of-contents__link">1.2 on <code>wasmi</code> layer</a></li><li><a href="#13-contract-log-functions" class="table-of-contents__link">1.3 Contract Log functions</a></li></ul></li><li><a href="#2-what-europa-can-do-in-v02" class="table-of-contents__link">2. What Europa can do in v0.2</a><ul><li><a href="#21-build" class="table-of-contents__link">2.1 Build</a></li><li><a href="#example" class="table-of-contents__link">example</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/substrate-contracts-book/en/assets/js/runtime~main.7645ed62.js"></script>
<script src="/substrate-contracts-book/en/assets/js/main.a780d21c.js"></script>
</body>
</html>