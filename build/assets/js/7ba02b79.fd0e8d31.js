"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4305],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),u=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,f=d["".concat(i,".").concat(m)]||d[m]||s[m]||l;return n?a.createElement(f,o(o({ref:t},p),{},{components:n})):a.createElement(f,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=d;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},711:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return i},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),o=["components"],c={},i="Europa \u5408\u7ea6\u6267\u884c\u65e5\u5fd7\u5206\u6790",u={unversionedId:"europa/execution_info",id:"europa/execution_info",isDocsHomePage:!1,title:"Europa \u5408\u7ea6\u6267\u884c\u65e5\u5fd7\u5206\u6790",description:"\u80cc\u666f\u4fe1\u606f",source:"@site/docs/europa/execution_info.md",sourceDirName:"europa",slug:"/europa/execution_info",permalink:"/europa/execution_info",editUrl:"https://github.com/patractlabs/substrate-contracts-book/docs/europa/execution_info.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Europa\u6559\u7a0b",permalink:"/europa/tutorial"},next:{title:"Europa \u8c03\u8bd5\u793a\u4f8b",permalink:"/europa/sample"}},p=[{value:"\u80cc\u666f\u4fe1\u606f",id:"\u80cc\u666f\u4fe1\u606f",children:[]},{value:"\u65e5\u5fd7\u5b57\u6bb5\u8bf4\u660e",id:"\u65e5\u5fd7\u5b57\u6bb5\u8bf4\u660e",children:[]},{value:"\u5408\u7ea6\u5d4c\u5957\u8c03\u7528",id:"\u5408\u7ea6\u5d4c\u5957\u8c03\u7528",children:[]}],s={toc:p};function d(e){var t=e.components,c=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},s,c,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"europa-\u5408\u7ea6\u6267\u884c\u65e5\u5fd7\u5206\u6790"},"Europa \u5408\u7ea6\u6267\u884c\u65e5\u5fd7\u5206\u6790"),(0,l.kt)("h2",{id:"\u80cc\u666f\u4fe1\u606f"},"\u80cc\u666f\u4fe1\u606f"),(0,l.kt)("p",null,"\u5f53\u524dEuropa\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"pallet-contract"),"\u4e2d\u8bb0\u5f55\u5408\u7ea6\u6267\u884c\u4fe1\u606f\u7684\u7ed3\u6784\u4f53\u5982\u4e0b\u6240\u793a\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-rust"},"/// Record the contract execution context.\npub struct NestedRuntime {\n        /// Current depth\n    depth: usize,\n        /// The current contract execute result\n        ext_result: ExecResultTrace,\n        /// The value in sandbox successful result\n        sandbox_result_ok: Option<ReturnValue>,\n        /// Who call the current contract\n    caller: AccountId32,\n        /// The account of the current contract\n    self_account: Option<AccountId32>,\n        /// The input selector\n    selector: Option<HexVec>,\n        /// The input arguments\n    args: Option<HexVec>,\n        /// The value in call or the endowment in instantiate\n    value: u128,\n        /// The gas limit when this contract is called\n    gas_limit: Gas,\n        /// The gas left when this contract return\n    gas_left: Gas,\n        /// The host function call stack\n    env_trace: EnvTraceList,\n        /// The error in wasm\n    wasm_error: Option<WasmErrorWrapper>,\n        /// The trap in host function execution\n    trap_reason: Option<TrapReason>,\n        /// Nested contract execution context\n    nest: Vec<NestedRuntime>,\n}\n")),(0,l.kt)("p",null,"\u8be5\u7ed3\u6784\u5bf9\u5e94\u7684\u65e5\u5fd7\u793a\u4f8b\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"1: NestedRuntime {\n    ext_result: [success] ExecReturnValue { flags: 0, data:  },\n    caller: d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d (5GrwvaEF...),\n    self_account: 0144d6fc570d7bddda6f8e36141f179cd172324599b556ef514193f3105865f6 (5C6NMXaS...),\n    selector: 0x9bae9d5e,\n    args: 0x40420f00000000000000000000000000,\n    value: 10000000000000000,\n    gas_limit: 200000000000,\n    gas_left: 190018947968,\n    env_trace: [\n        seal_input(Some(0x9bae9d5e40420f00000000000000000000000000)),\n        seal_caller(Some(0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d)),\n        ...\n       seal_set_storage((Some(0x0300000001000000000000000000000000000000000000000000000000000000), Some(0x000000000000000000000000))),\n    ],\n    sandbox_result_ok: Value(\n        I32(\n            0,\n        ),\n    ),\n    nest: [],\n}\n")),(0,l.kt)("h2",{id:"\u65e5\u5fd7\u5b57\u6bb5\u8bf4\u660e"},"\u65e5\u5fd7\u5b57\u6bb5\u8bf4\u660e"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u5173\u952e\u5b57"),(0,l.kt)("th",{parentName:"tr",align:null}))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"1: NestedRuntime"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8c03\u7528\u6df1\u5ea6\u4e3a1\u7684\u5408\u7ea6\u6267\u884c\u65e5\u5fd7\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ext_result"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5408\u7ea6\u5728",(0,l.kt)("inlineCode",{parentName:"td"},"pallet-contract"),"\u5c42\u7684\u6267\u884c\u7ed3\u679c\uff0c\u6709success\u548cfailed\u4e24\u79cd\u60c5\u51b5\u3002 success\u53ea\u80fd\u8bf4\u660e\u5728",(0,l.kt)("inlineCode",{parentName:"td"},"pallet-contract"),"\u5c42\u662f\u6267\u884c\u6210\u529f\u7684\uff0c\u4f46\u662f\u5408\u7ea6\u672c\u8eab\u7684\u4e1a\u52a1\u903b\u8f91\u53ef\u80fd\u662f\u629b\u51faError\u7684\u3002",(0,l.kt)("inlineCode",{parentName:"td"},"ExecResultValue {flag:0, data: 0x...}"),"\u4e2d\u7684data\u503c\u4e5f\u8bb8\u662f\u5408\u7ea6\u7684\u8fd4\u56de\u503c\uff0c\u4e5f\u8bb8\u662f\u5408\u7ea6\u5185\u5b9a\u4e49\u7684Error\u7684\u679a\u4e3e\u503c\u3002 failed\u540e\u9762\u4f1a\u8ddf\u968f\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"td"},"ExecError {.. }"),"\uff0c\u9519\u8bef\u4fe1\u606f\u662f\u5b9a\u4e49\u5728",(0,l.kt)("inlineCode",{parentName:"td"},"pallet-contracts"),"\u4e2d\u7684\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"caller"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8be5\u5408\u7ea6\u7684\u8c03\u7528\u8005\uff0c\u53ef\u80fd\u662f\u7528\u6237\uff0c\u4e5f\u53ef\u80fd\u662f\u53e6\u5916\u4e00\u4e2a\u5408\u7ea6\u8d26\u6237\u3002\u5f53\u8be5\u503c\u4e3a",(0,l.kt)("inlineCode",{parentName:"td"},"0x000..."),"\u65f6\uff0c\u662f\u88abRPC\u8c03\u7528\u7684\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"self_account"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5f53\u524d\u5408\u7ea6\u8d26\u6237\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"selector"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4f20\u9012\u7ed9\u5408\u7ea6\u7684\u51fd\u6570\u6807\u8bc6\uff0c\u5728\u5408\u7ea6\u7684metadata.json\u4e2d\u67e5\u8be2\u5230\u5bf9\u5e94\u5173\u7cfb\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"args"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4f20\u9012\u7ed9\u5408\u7ea6\u8c03\u7528\u51fd\u6570\u7684\u53c2\u6570\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"value"),(0,l.kt)("td",{parentName:"tr",align:null},"\u7ed9\u5f53\u524d\u5408\u7ea6\u8f6c\u8d26\u6570\u91cf\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"gas_limit"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5f53\u524d\u5408\u7ea6\u6700\u591a\u53ef\u4ee5\u4f7f\u7528\u7684gas\u6570\u91cf\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"gas_left"),(0,l.kt)("td",{parentName:"tr",align:null},"\u9000\u51fa\u5f53\u524d\u5408\u7ea6\u65f6\uff0c\u8fd8\u5269\u4f59\u7684gas\u6570\u91cf\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"env_trace"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5728\u5f53\u524d\u5408\u7ea6\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0chost_function\u7684\u8c03\u7528\u6808\uff0c\u8be6\u7ec6\u5730\u7ed9\u51fa\u4e86\u6bcf\u4e2afunction\u7684\u53c2\u6570\u3002\u4ee5",(0,l.kt)("inlineCode",{parentName:"td"},"seal_call"),"\u4e3a\u4f8b\uff0c\u5982\u679c\u8f93\u5165\u4e3aSome(xxx)\uff0c\u8f93\u51fa\u4e3a\u7a7a\uff0c\u90a3\u4e48\u53ef\u80fd\u662f\u5728\u5408\u7ea6\u4e92\u76f8\u8c03\u7528\u8fc7\u7a0b\u4e2d\u51fa\u9519\u4e86\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"trap_reason"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5728\u6267\u884chost_function\u8fc7\u7a0b\u4e2d\uff0c\u9047\u5230trap\u7684\u539f\u56e0\u3002 Return & Termination & Restoration\uff1a\u662f\u5408\u7ea6\u6267\u884c\u7684\u6b63\u5e38\u9000\u51fa\u7b56\u7565\uff0c\u4e0d\u662fError\u3002 SupervisorError\uff1a\u5b9a\u4e49\u5728",(0,l.kt)("inlineCode",{parentName:"td"},"pallet_contracts"),"\u4e2d\u7684DispatchError\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"wasm_error"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5982\u679c\u5408\u7ea6\u5185\u90e8\u51fa\u73b0\u4e86Wasm\u6267\u884c\u9519\u8bef\uff0c\u4f1a\u5c06Wasm\u8c03\u7528\u6808\u6253\u5370\u5728\u8be5\u5b57\u6bb5\u4e2d\u3002\u5f53\u4e14\u4ec5\u5f53",(0,l.kt)("inlineCode",{parentName:"td"},"ext_result"),"\u662ffailed\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"sandbox_result_ok"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5047\u5982\u5728host_function\u6267\u884c\u8fc7\u7a0b\u4e2d\u6ca1\u6709",(0,l.kt)("inlineCode",{parentName:"td"},"trap"),"\uff0c\u5e76\u4e14\u6ca1\u6709",(0,l.kt)("inlineCode",{parentName:"td"},"wasm_error"),"\uff0c\u90a3\u4e48\u8ba4\u4e3a\u5408\u7ea6\u6267\u884c\u6210\u529f\uff0c\u6253\u5370\u8be5\u5b57\u6bb5\u3002\u8be5\u5b57\u6bb5\u643a\u5e26\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"td"},"ReturnValue"),"\u7684\u4fe1\u606f\uff0c\u5728",(0,l.kt)("inlineCode",{parentName:"td"},"ink!"),"\u4e2d\uff0c\u5982\u679c\u8fd4\u56de\u7684value\u503c\u4e0d\u4e3a0\uff0c\u90a3\u4e48\u53ef\u80fd\u662f\u51fa\u73b0\u4e86\u4e00\u4e2a",(0,l.kt)("inlineCode",{parentName:"td"},"ink!"),"\u5185\u5b9a\u4e49\u7684Error\uff0c\u9700\u8981\u67e5\u8be2\u76f8\u5e94\u7684",(0,l.kt)("a",{parentName:"td",href:"https://github.com/paritytech/ink/blob/abd5cf14c0883cb2d5acf81f2277aeec330aa843/crates/lang/src/error.rs#L66-L80"},"DispatchError "),"\u3002")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"nest"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5d4c\u5957\u8c03\u7528\u7684\u5408\u7ea6\u65e5\u5fd7\u3002\u5982\u679c\u5f53\u524d\u5408\u7ea6\u8c03\u7528\u4e86\u5176\u4ed6\u5408\u7ea6\uff0c\u90a3\u4e48\u88ab\u8c03\u7528\u5408\u7ea6\u7684\u6267\u884c\u65e5\u5fd7\u4f1a\u88ab\u5d4c\u5957\u5728\u8be5\u5b57\u6bb5\u4e4b\u4e2d\u3002")))),(0,l.kt)("h2",{id:"\u5408\u7ea6\u5d4c\u5957\u8c03\u7528"},"\u5408\u7ea6\u5d4c\u5957\u8c03\u7528"),(0,l.kt)("p",null,"\u5408\u7ea6\u95f4\u7684\u4e92\u76f8\u8c03\u7528\uff0c\u793a\u4f8b\u5982\u4e0b\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5728\u5408\u7ea6A\u4e2d\uff0c\u8c03\u7528\u5408\u7ea6B\u4e4b\u540e\u518d\u8c03\u7528\u5408\u7ea6C\u3002"),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{src:n(7684).Z})))),(0,l.kt)("p",null,"\u65e5\u5fd7\u5982\u4e0b\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"1: NestedRuntime {\n        self_account: A,\n        nest:[\n             2: NestedRuntime {\n                     self_account: B,\n                     nest:[],\n             },\n             2: NestedRuntime {\n                     self_account: C,\n                     nest:[],\n             }\n        ]\n}\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"\u5728\u5408\u7ea6A\u4e2d\uff0c\u8c03\u7528\u5408\u7ea6B\uff0c\u5728\u5408\u7ea6B\u4e2d\uff0c\u8c03\u7528\u5408\u7ea6C\u3002"),(0,l.kt)("p",{parentName:"li"},(0,l.kt)("img",{src:n(7438).Z})))),(0,l.kt)("p",null,"\u65e5\u5fd7\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"1: NestedRuntime {\n        self_account: A,\n        nest:[\n                2: NestedRuntime {\n                        self_account: B,\n                        nest:[\n                             3: NestedRuntime {\n                             self_account: C,\n                             nest:[],\n                        }\n                        ],\n                }  \n        ]\n}\n")))}d.isMDXComponent=!0},7684:function(e,t,n){t.Z=n.p+"assets/images/call_other_1-eb688f8f77489cd94eea42116f9aac41.png"},7438:function(e,t,n){t.Z=n.p+"assets/images/call_other_2-f9b33fdd6032c00de5986de19d8229c3.png"}}]);