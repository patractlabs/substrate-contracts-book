"use strict";(self.webpackChunksubstrate_contracts_book=self.webpackChunksubstrate_contracts_book||[]).push([[640],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return p}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(a),p=o,m=u["".concat(c,".").concat(p)]||u[p]||g[p]||r;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function p(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},8438:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return d},default:function(){return u}});var n=a(7462),o=a(3366),r=(a(7294),a(3905)),i=["components"],l={},c="Contract language",s={unversionedId:"contracts/language",id:"contracts/language",isDocsHomePage:!1,title:"Contract language",description:"Background Information",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/contracts/language.md",sourceDirName:"contracts",slug:"/contracts/language",permalink:"/substrate-contracts-book/en/contracts/language",editUrl:"https://github.com/patractlabs/substrate-contracts-book/edit/master/docs/contracts/language.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Contract model",permalink:"/substrate-contracts-book/en/contracts/model"},next:{title:"Brief introduction of Wasm",permalink:"/substrate-contracts-book/en/contracts/wasm_first_step"}},d=[{value:"Background Information",id:"background-information",children:[]},{value:"Correspondence between contract language and contract model",id:"correspondence-between-contract-language-and-contract-model",children:[{value:"Abstract representation of existing models",id:"abstract-representation-of-existing-models",children:[]}]},{value:"Comparison of the advantages and disadvantages of contract language framework and contract language",id:"comparison-of-the-advantages-and-disadvantages-of-contract-language-framework-and-contract-language",children:[{value:"Disadvantages",id:"disadvantages",children:[]},{value:"Advantages",id:"advantages",children:[]},{value:"Summarize",id:"summarize",children:[]}]},{value:"Pallet-contracts and the corresponding contract language",id:"pallet-contracts-and-the-corresponding-contract-language",children:[]},{value:"More information",id:"more-information",children:[]}],g={toc:d};function u(e){var t=e.components,l=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},g,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"contract-language"},"Contract language"),(0,r.kt)("h2",{id:"background-information"},"Background Information"),(0,r.kt)("p",null,"Corresponding to the concept of contract model, we can derive the concept of contract language (framework) (write code that can run on the platform). The contract language is not simply used here, but the description of the contract language (framework) is used because in actual use, some contract platforms have designed a new language to write contracts (such as Solidity), and some contract platforms are  on the basis of existing languages (such as Rust, C++, AssemblyScript), write a library or framework to make an existing language have the function of writing contracts, and some platforms even change an existing language into this language Dialects to support the function of writing contracts."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"Operating platform"),(0,r.kt)("th",{parentName:"tr",align:null},"Category"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Solidity"),(0,r.kt)("td",{parentName:"tr",align:null},"The compiled results run on EVM"),(0,r.kt)("td",{parentName:"tr",align:null},"A new language")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ink!"),(0,r.kt)("td",{parentName:"tr",align:null},"The compiled results run on Frame Contract Pallet"),(0,r.kt)("td",{parentName:"tr",align:null},"Write a library or framework on an existing language (Rust)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Vyper"),(0,r.kt)("td",{parentName:"tr",align:null},"The compiled results run on EVM"),(0,r.kt)("td",{parentName:"tr",align:null},"Dialect of Python")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://vyper.readthedocs.io/en/stable/"},"Vyper")," is a contract-oriented Python programming language, and the compilation target is the OP_CODE which running on Ethereum Virtual Machine (EVM).")),(0,r.kt)("p",null,"For scenarios where a library or framework is added to an existing language, in most cases the function of the compiler to process the syntax tree is needed, so we prefer to call it a language framework rather than a library or framework in the conventional sense."),(0,r.kt)("p",null,"The contract language and contract language framework are for the description of different contract platforms. For the convenience of the following introduction, when describing the nature of the concept, the contract language is used to replace the two concepts of contract language and contract language framework. When describing specific objects, Use the corresponding concepts specifically."),(0,r.kt)("h2",{id:"correspondence-between-contract-language-and-contract-model"},"Correspondence between contract language and contract model"),(0,r.kt)("h3",{id:"abstract-representation-of-existing-models"},"Abstract representation of existing models"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(2875).Z})),(0,r.kt)("p",null,"As shown in the figure above, the upper part describes the relationship between EVM and Solidity. EVM and Solidity proposed earlier, and their model is consistent with the usual model relationship between computer virtual machine and language. The lower part is the correspondence between the language part after separating the contract model. Here, I will focus on the lower part of the figure. In the upper part, you can analyze it based on your own experience in Ethereum  contract development compared with the introduction later."),(0,r.kt)("p",null,"In the system of compiled languages, for the convenience of the following introduction, first briefly define the following concepts (non-rigorous terms):"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"S language: The original language (Source) for programmers to write code. For example, if C++ is compiled into assembly, then C++ is the original language S."),(0,r.kt)("li",{parentName:"ul"},"T language: the language (Target) generated after the original language is compiled by the compiler. For example, if C++ is compiled into assembly, the assembly is the target language T.")),(0,r.kt)("p",null,"The previous article introduced that the environment for running the contract system can be logically split into a contract model and a contract virtual machine. The contract model manages the business logic of the contract, and the contract virtual machine manages how to run the code of the contract. Correspondingly, the contract language part can also be split into the contract language and the S language compiled into the contract virtual machine."),(0,r.kt)("p",null,"According to this definition, it is clear that Solidity is a product that has both contract language and S language features."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Solidity has a Turing complete language system, so Solidity is a language (compared with BTC scripts).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The grammar of Solidity has many keywords with contract characteristics, corresponding to the concept of contract language. Such as\uff1a"),(0,r.kt)("table",{parentName:"li"},(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"keywords"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"mapping"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Typical case of contract storage")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"msg.sender\u3001msg.value"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Variables related to contract calls")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"view\u3001pure"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Modifier\uff0cPlay a modifying role")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"call\u3001delegate_cal"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Keywords related to contract call")))))),(0,r.kt)("p",null,"Among them, the concept in point 2 does not exist to support the logic that the Solidity language can execute, but to serve the business logic of the Ethereum contract virtual machine. Therefore, this part can be attributed to the specific functions of the contract language."),(0,r.kt)("p",null,"The purpose of the contract language is to correspond to the business logic of the contract model. What kind of contract model requires what kind of contract language."),(0,r.kt)("p",null,"Such as\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The bottom layer of EVM is Key-Value type storage, so the ",(0,r.kt)("inlineCode",{parentName:"li"},"mapping")," designed in Solidity cannot be traversed unless extra storage is attached."),(0,r.kt)("li",{parentName:"ul"},"The contract model of EVM contract interaction is designed as a contract calling contract mode, so the keywords ",(0,r.kt)("inlineCode",{parentName:"li"},"call")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"delegate_call")," are provided in Solidity.")),(0,r.kt)("p",null,"The same applies to other contract systems."),(0,r.kt)("h2",{id:"comparison-of-the-advantages-and-disadvantages-of-contract-language-framework-and-contract-language"},"Comparison of the advantages and disadvantages of contract language framework and contract language"),(0,r.kt)("h3",{id:"disadvantages"},"Disadvantages"),(0,r.kt)("p",null,"For the contract language framework, it is an additional function erected on the S language, so the functions provided by the contract language framework are ultimately compiled to the T language corresponding to the S language. Some of the features required by the blockchain will be constrained at this level, such as the implementation of consistency requirements and the disallowing of operating system calls. Therefore, in addition to providing contract model functions to the S language, the contract language framework also needs to impose certain constraints on the language itself. This step is also a difficult place in the development and understanding of the contract language. At the same time, it is precisely for this reason that contract developers will have a lot of discomfort in the process of using the contract model framework."),(0,r.kt)("p",null,"The final result of the contract language framework is related to the ability of the language to expand the syntax tree. If the language itself provides more flexible interfaces (macros, plug-ins, etc.) for modifying or adding syntax trees, then the contract language can achieve more functions. If the language itself provides few such extensibility functions, then the contract language can only consider modifying the syntax required by the compiler and extensions to support the contract model, so that the final language becomes a dialect of the original language."),(0,r.kt)("p",null,"As for the contract language, languages like Solidity and Move are new languages developed for the contract platform. Although there are traces of grammatically imitating other languages, there are no ambiguity instructions when it comes to constraints. In terms of support for contract functions, corresponding keywords can also be designed directly, so it is more friendly to contract developers. For example, Solidity itself is positioned as a language designed to serve the writing of contracts. Therefore, the instructions related to the contract mentioned in the previous chapter can be designed as keywords, and you can use them directly."),(0,r.kt)("p",null,"Therefore, compared with the contract language, the contract language framework is very difficult to handle in terms of providing support for the contract and the constraints of running the contract. This is one of the reasons why it is more difficult for contract developers to use the framework functions."),(0,r.kt)("p",null,"Take ink! as an example:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The use of float should be avoided in the blockchain, because floating-point numbers may produce indeterminate behavior. Therefore, in contract runtime development, if you need to use floating-point numbers, or when overflowing numbers are multiplied and divided, you need to introduce fixed-point numbers to deal with. Therefore, the fixed-point library provided by Substrate runtime can be introduced into the ink! contract for processing."),(0,r.kt)("li",{parentName:"ul"},"Since the contract model of ",(0,r.kt)("inlineCode",{parentName:"li"},"pallet-contracts")," is basically the same as EVM, the contract storage of ",(0,r.kt)("inlineCode",{parentName:"li"},"pallet-contracts")," is also composed of Key-Value mode. Then the contract model framework needs to deal with the various collection types provided in the standard library. Therefore, the collection types that may be used in the standard library are rewritten in ink!, and the process of processing the collection element types into Key-Value mode data is added. Therefore, in the ink! contract storage, if a collection type is designed, then only the types provided in the ink! standard library can be used. On the other hand, since the return value of ink! needs to export metadata for third-party processing, and the current metadata interface implementation is only implemented for the collection in the standard library, so the collection of the return value of the ink! method can only use the collection type of the standard library. The code example is as follows.",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"#[ink::contract]\nmod test {\n    // Introduce Vec realized by ink\n    use ink_storage::collections::Vec as StorageVec;\n    // Introduce the Vec of the standard library\n    use ink_prelude::vec::Vec;\n    #[ink(storage)]\n    pub struct Test {\n        owners: StorageVec<AccountId>, // Only ink's Vec can be used\n    }\n    impl Test {\n        #[ink(message)]\n        pub fn get_owners(&self) -> Vec<AccountId> {\n            // Convert Vec implemented by ink to Vec implemented by standard library\n            self.owners.iter().map(Clone::clone).collect()\n        }\n    }\n}\n")))),(0,r.kt)("h3",{id:"advantages"},"Advantages"),(0,r.kt)("p",null,"Although there are many limitations to using contract language frameworks, there are still many advantages to designing a framework in an existing language compared to designing a new language."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:null},"Contract language framework"),(0,r.kt)("th",{parentName:"tr",align:null},"Contract language"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Attractive to developers"),(0,r.kt)("td",{parentName:"tr",align:null},"It is easier to attract developers in this language ecology."),(0,r.kt)("td",{parentName:"tr",align:null},"Convincing developers to use a new language is very difficult.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Language abstraction"),(0,r.kt)("td",{parentName:"tr",align:null},"Language design has been tested by engineering, with high abstract dimension and strong language expression."),(0,r.kt)("td",{parentName:"tr",align:null},"The language design is relatively simple, and the abstraction of language expression is relatively weak, and it is difficult to write complex business logic.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Ecological Prosperity"),(0,r.kt)("td",{parentName:"tr",align:null},"In many cases, the existing basic libraries and tool libraries in the language ecology can be reused."),(0,r.kt)("td",{parentName:"tr",align:null},"Almost all the basic components have to be rewritten.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Engineering cost"),(0,r.kt)("td",{parentName:"tr",align:null},"Designing a library is relatively simple."),(0,r.kt)("td",{parentName:"tr",align:null},"Designing a complete language is very complicated.")))),(0,r.kt)("p",null,'In summary, as a contract platform designer, choosing to use the contract language framework is to "substrate" from an existing language. Choosing to use contract language is "doing addition" from scratch. Both options have their own advantages and disadvantages. Designers will make choices according to their own scenarios to attract developers to the greatest extent and promote the development of their own ecology.'),(0,r.kt)("h3",{id:"summarize"},"Summarize"),(0,r.kt)("p",null,"In summary, in the model structure:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The contract language and contract model are in correspondence, and the characteristics of the contract language will match the contract model one by one."),(0,r.kt)("li",{parentName:"ul"},"The contract language provides the S language with business functions for the contract model, and at the same time restricts the S language itself according to the requirements of the contract business logic."),(0,r.kt)("li",{parentName:"ul"},"According to the needs of contract platform designers, they will eventually choose to use the contract language framework or design a contract language for developers to write contracts. Both methods have their own advantages and disadvantages.")),(0,r.kt)("h2",{id:"pallet-contracts-and-the-corresponding-contract-language"},"Pallet-contracts and the corresponding contract language"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(9797).Z})),(0,r.kt)("p",null,"With the concept of the contract language model, we can nest the contract model framework on Substrate's Wasm contract system."),(0,r.kt)("p",null,"The realization of ink! The whole system corresponds to the contract model of ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),". ink! 3.0 introduces the functional logic corresponding to ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts")," into Rust through the system of process macros (2.0 through declaration macros). Therefore, the S language in this system is Rust, and the T language is Wasm bytecode. Ink! uses the auxiliary tool ",(0,r.kt)("inlineCode",{parentName:"p"},"cargo-contract")," to compile the Rust code using the ink! framework into the Wasm bytecode of the contract. The environment in which Wasm  bytecode runs on the chain is wasmi. In the future, JIT-type operating environments such as Wasmtime will also be introduced."),(0,r.kt)("p",null,"And because the execution environment of ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),"  is Wasm bytecode, a language that can be compiled into Wasm bytecode and a contract language that conforms to the ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts")," contract model can be generated and run on the contract platform of ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),"  Contract. For ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),", you can design a contract system in different languages for you to choose, and you can use different languages to develop Wasm contracts."),(0,r.kt)("h2",{id:"more-information"},"More information"),(0,r.kt)("p",null,"In addition to Rust's ink!, the contract languages currently supported to run on pallet-contracts also have the following projects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ask!\uff1aDeveloped by Patract, it is a contract language based on the  AssemblyScript language . (It is being developed)"),(0,r.kt)("li",{parentName:"ul"},"Solang\uff1a It is a tool that is developed by hyperledger-labs and supports the compilation of Solidity to Wasm of pallet-contracts.")))}u.isMDXComponent=!0},9797:function(e,t,a){t.Z=a.p+"assets/images/englanguage_2-4c210332435592dd6d08e24a34a694a9.jpg"},2875:function(e,t,a){t.Z=a.p+"assets/images/language_1-ee6de6d50c981f16c309037e74408c2b.jpg"}}]);