<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">ERC20 | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/substrate-contracts-book/en/metis/tokens"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ERC20 | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="metis provides trait_definition and calling stub between contracts that fully complies with the ERC20 standard. com/patractlabs/metis/tree/master/stubs/token/erc20)"><meta data-react-helmet="true" property="og:description" content="metis provides trait_definition and calling stub between contracts that fully complies with the ERC20 standard. com/patractlabs/metis/tree/master/stubs/token/erc20)"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-contracts-book/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/substrate-contracts-book/en/metis/tokens"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/metis/tokens" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/en/metis/tokens" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/metis/tokens" hreflang="x-default"><link rel="stylesheet" href="/substrate-contracts-book/en/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/runtime~main.4f2bb0f7.js" as="script">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/main.32f2285c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-contracts-book/en/"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Site</b></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/substrate-contracts-book/metis/tokens" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡</a></li><li><a href="/substrate-contracts-book/en/metis/tokens" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/introduction">Substrate contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/overview">Contract overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/model">Contract model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/language">Contract language</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/wasm_first_step">Brief introduction of Wasm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Metis</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/introduction">Metis</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-contracts-book/en/metis/tokens">ERC20</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/access-control">Access Control</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Reports</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">ERC20</h1></header><p>metis provides <a href="https://github.com/patractlabs/metis/tree/master/traits/token/erc20" target="_blank" rel="noopener noreferrer">trait_definition</a> and <a href="https://github.com/patractlabs/metis/tree/master/traits/token/erc20" target="_blank" rel="noopener noreferrer">calling stub between contracts</a> that fully complies with the <code>ERC20</code> standard. com/patractlabs/metis/tree/master/stubs/token/erc20)
And the standard implementation of <a href="https://github.com/patractlabs/metis/tree/master/impls/token/erc20" target="_blank" rel="noopener noreferrer">erc20 contract</a>.</p><p>The following is a detailed introduction to the use of the erc20 trait and stub provided by metis.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="trait-definition"></a>Trait Definition<a class="hash-link" href="#trait-definition" title="Direct link to heading">#</a></h2><p>By processing macros with <code>#[ink::trait_definition]</code>, developers can define their own trait definitions, which can then be implemented by ink! smart contract. This allows the definition of shared smart contract interfaces for different specific implementations. Note that this <code>#[ink::trait_definition]</code> can be defined anywhere, even in another crate!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="erc20-trait-source-code-analysis"></a>erc20 trait source code analysis<a class="hash-link" href="#erc20-trait-source-code-analysis" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Note: The tarit definition needs to be exported here for other packages to use</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub use self::erc20::{Error, IErc20, Result};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub mod events {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // pub use crate::erc20::{Transfer, Approval};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ink_lang as ink;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink::contract]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod erc20 {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_lang as ink;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_prelude::string::String;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The ERC-20 result type.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub type Result&lt;T&gt; = core::result::Result&lt;T, Error&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Event emitted when a token transfer occurs.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Transfer {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub from: Option&lt;AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub to: Option&lt;AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Event emitted when an approval occurs that `spender` is allowed to withdraw</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// up to the amount of `value` tokens from `owner`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Approval {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub owner: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub spender: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The ERC-20 error types.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[derive(Debug, PartialEq, Eq, scale::Encode, scale::Decode)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[cfg_attr(feature = &quot;std&quot;, derive(scale_info::TypeInfo))]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub enum Error {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returned if not enough balance to fulfill a request is available.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        InsufficientBalance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returned if not enough allowance to fulfill a request is available.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        InsufficientAllowance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Trait implemented by all ERC-20 respecting smart contracts.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink::trait_definition]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub trait IErc20 {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Creates a new ERC-20 contract with the specified initial supply.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn new(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            initial_supply: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            symbol: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            decimals: Option&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; Self;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the token name.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn token_name(&amp;self) -&gt; Option&lt;String&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the token symbol.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn token_symbol(&amp;self) -&gt; Option&lt;String&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the token decimals.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn token_decimals(&amp;self) -&gt; Option&lt;u8&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the total token supply.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn total_supply(&amp;self) -&gt; Balance;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the account balance for the specified `owner`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn balance_of(&amp;self, owner: AccountId) -&gt; Balance;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Transfers `value` amount of tokens from the caller&#x27;s account to account `to`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn transfer(&amp;mut self, to: AccountId, value: Balance) -&gt; Result&lt;()&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the amount which `spender` is still allowed to withdraw from `owner`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn allowance(&amp;self, owner: AccountId, spender: AccountId) -&gt; Balance;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Transfers `value` tokens on the behalf of `from` to the account `to`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn transfer_from(&amp;mut self, from: AccountId, to: AccountId, value: Balance) -&gt; Result&lt;()&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Allows `spender` to withdraw from the caller&#x27;s account multiple times, up to</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// the `value` amount.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn approve(&amp;mut self, spender: AccountId, value: Balance) -&gt; Result&lt;()&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // TODO tmp hack struct for passing compile</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Phantom;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl Phantom {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn new() -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Phantom {}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn message(&amp;self) {}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>First, you must define <code>#[ink::trait_definition]</code>, where a trait interface of <code>IErc20</code> is defined. At least one of <code>#[ink(constructor)]</code> and <code>#[ink(message)]</code> must be defined in trait_definition.
All interfaces have only declarations, not implementations.</p><p><code>#[ink::trait_definition]</code> can be defined separately from <code>#[ink::contract]</code>. For simple traits, you only need to define trait_definition, as defined in the introduction. But in this erc20 trait
In the implementation, the reason why it is defined in <code>#[ink::contract]</code> is because of the existence of <code>#[ink(event)]</code>. We hope to not only provide interfaces, but also provide some event and error definitions, so that developers When using our erc20-trait package, you can clearly know that it will
Which events are triggered and what errors occur, but the catch is that <code>#[ink(event)]</code> cannot be separated from the separate definition of <code>#[ink::contract]</code>, so we can only temporarily implement a <code>Phantom</code> contract and store it. Make the compilation pass. We have submitted this issue as an official issue
(Https://github.com/paritytech/ink/issues/683).</p><p>After defining <code>#[ink::trait_definition]</code>, pay attention to exporting the trait, such as: <code>pub use self::erc20::{Error, IErc20, Result};</code>, only after exporting can it be used by other crates .</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="use-erc20-trait-to-implement-the-contract"></a>Use erc20-trait to implement the contract<a class="hash-link" href="#use-erc20-trait-to-implement-the-contract" title="Direct link to heading">#</a></h3><ol><li>Create a new contract</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo contract new myerc20</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note: The ink! dependencies of all contracts in metis are the codes in the latest ink warehouse, so you need to change the dependencies in the newly created contract project to the latest, otherwise it will cause version conflicts, as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_primitives = { version = &quot;3.0.0-rc3&quot;, git = &quot;https://github.com/paritytech/ink&quot;, default-features = false }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_metadata = { version = &quot;3.0.0-rc3&quot;, git = &quot;https://github.com/paritytech/ink&quot;, default-features = false, features = [&quot;derive&quot;], optional = true }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_env = { version = &quot;3.0.0-rc3&quot;, git = &quot;https://github.com/paritytech/ink&quot;, default-features = false }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_storage = { version = &quot;3.0.0-rc3&quot;, git = &quot;https://github.com/paritytech/ink&quot;, default-features = false }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_lang = { version = &quot;3.0.0-rc3&quot;, git = &quot;https://github.com/paritytech/ink&quot;, default-features = false }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ink_prelude = { version = &quot;3.0.0-rc3&quot;, git = &quot;https://github.com/paritytech/ink&quot;, default-features = false }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Add the <code>erc20-trait</code> package to the <code>cargo.toml</code> dependency of the new contract project</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20-trait = { git = &quot;https://github.com/patractlabs/metis&quot;, default-features = false, features = [&quot;ink-as-dependency&quot;] }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[features]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default = [&quot;std&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">std = [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;erc20-trait/std&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When adding a dependency here, the <code>features = [&quot;ink-as-dependency&quot;]</code> feature is enabled because it is in ink! As a dependency, the Chinese contract needs to be turned on and modified.</p><ol start="3"><li>Implement the erc20 trait in the new contract project</li></ol><p>The complete code is at: <code>https://github.com/patractlabs/metis/blob/master/impls/token/erc20</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ink_lang as ink;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink::contract]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod erc20 {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Here you need to import the interface and errors defined in erc20_trait</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use erc20_trait::{Error, IErc20, Result};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_prelude::string::String;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Basic version of StandardToken, with no allowances.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Erc20 {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Total token supply.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        total_supply: Lazy&lt;Balance&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Mapping from owner to number of owned token.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        balances: StorageHashMap&lt;AccountId, Balance&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Mapping of the token amount which an account is allowed to withdraw</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// from another account.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        allowances: StorageHashMap&lt;(AccountId, AccountId), Balance&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Name of the token</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Symbol of the token</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        symbol: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Decimals of the token</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        decimals: Option&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl IErc20 for Erc20 {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn new(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            initial_supply: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            name: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            symbol: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            decimals: Option&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // implementation ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Omitted part of interface</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn transfer_from(&amp;mut self, from: AccountId, to: AccountId, value: Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // implementation ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn approve(&amp;mut self, spender: AccountId, value: Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // implementation ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="call-stub-across-contracts"></a>Call stub across contracts<a class="hash-link" href="#call-stub-across-contracts" title="Direct link to heading">#</a></h2><p>Before that, we have implemented the standard erc20 contract through the erc20 trait, and it is essential to interact with the erc20 contract in some complex dapps. Metis provides <code>erc20-stub</code> to support cross-contract calls. We have implemented the erc20 contract.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="erc20-stub-source-code-analysis"></a>erc20 stub source code analysis<a class="hash-link" href="#erc20-stub-source-code-analysis" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Need to export Erc20Stub for sub-contract call</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub use self::erc20::Erc20Stub;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ink_lang as ink;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink::contract]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod erc20 {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_prelude::string::String;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The ERC-20 error types.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[derive(Debug, PartialEq, Eq, scale::Encode, scale::Decode)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[cfg_attr(feature = &quot;std&quot;, derive(scale_info::TypeInfo))]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub enum Error {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returned if not enough balance to fulfill a request is available.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        InsufficientBalance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returned if not enough allowance to fulfill a request is available.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        InsufficientAllowance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The ERC-20 result type.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub type Result&lt;T&gt; = core::result::Result&lt;T, Error&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Erc20Stub {}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl Erc20Stub {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Creates a new ERC-20 contract with the specified initial supply.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn new(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _initial_supply: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _name: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _symbol: Option&lt;String&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _decimals: Option&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the token name.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0x6b1bb951&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn token_name(&amp;self) -&gt; Option&lt;String&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the token symbol.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0xb42c3368&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn token_symbol(&amp;self) -&gt; Option&lt;String&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the token decimals.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0xc64b0eb2&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn token_decimals(&amp;self) -&gt; Option&lt;u8&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the total token supply.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0x143862ae&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn total_supply(&amp;self) -&gt; Balance {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the account balance for the specified `owner`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0xb7d968c9&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn balance_of(&amp;self, _owner: AccountId) -&gt; Balance {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Transfers `value` amount of tokens from the caller&#x27;s account to account `to`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0x10d455c2&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn transfer(&amp;mut self, _to: AccountId, _value: Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the amount which `spender` is still allowed to withdraw from `owner`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0xc04aa300&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn allowance(&amp;self, _owner: AccountId, _spender: AccountId) -&gt; Balance {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Transfers `value` tokens on the behalf of `from` to the account `to`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0xbb399017&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn transfer_from(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _from: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _to: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Allows `spender` to withdraw from the caller&#x27;s account multiple times, up to</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// the `value` amount.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, selector = &quot;0x4ce0e831&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn approve(&amp;mut self, _spender: AccountId, _value: Balance) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>From the above code, we can know that there is no erc20 specific logic implementation in the stub contract, only an empty implementation of the interface is provided, and the contract will be instantiated by the child contract as the parent contract.
And you can call the interface of the parent contract in the child contract.</p><p>Note: In the erc20-stub contract, the <code>selector</code> of each contract method is set with a fixed value, where the value of <code>selector</code> is determined by <code>BLAKE2(&quot;IErc20::{message_func_name}&quot;.to_string().as_bytes ())[0..4]</code>
The formula is calculated.</p><p>The calculation method of <code>selector</code> in the ink! system is different from that of solidity. In solidity, the method signature is hashed, while in ink! there is a set of calculation methods. The simplest one is for <code>{message_func_name} </code>
Perform hash operation, but when message is implemented by <code>#[ink::trait_definition]</code>, use {trait_name} + {message_func_name} mixed hash method, detailed calculation rules,
You can check ink! Source code (<a href="https://github.com/paritytech/ink/blob/master/crates/lang/ir/src/ir/item_impl/callable.rs#L190" target="_blank" rel="noopener noreferrer">https://github.com/paritytech/ink/blob/master/crates/lang/ir/src/ir/item_impl/callable.rs#L190</a>).</p><p>Therefore, erc20-stub is only applicable to cross-contract calls of the erc20 contract implemented in metis (implemented through the IErc20 trait). If it is an erc20 contract implemented in other ways, this stub cannot be used due to the mismatch of <code>selector</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cross-contract-call-through-erc20-stub"></a>Cross-contract call through erc20 stub<a class="hash-link" href="#cross-contract-call-through-erc20-stub" title="Direct link to heading">#</a></h3><ol><li>Add the <code>erc20-stub</code> package to the <code>cargo.toml</code> dependency of the new contract project</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20-stub = {git = &quot;https://github.com/patractlabs/metis&quot;, default-features = false, features = [&quot;ink-as-dependency&quot;]}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[features]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default = [&quot;std&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">std = [</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;erc20-stub/std&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>Instantiate erc20 stub in the new contract</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ink_lang as ink;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink::contract]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod delegate {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use erc20_stub::Erc20Stub;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_env::call::FromAccountId;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_storage::Lazy;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct CrossCall {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        callee: Lazy&lt;Erc20Stub&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl CrossCall {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn new(callee: AccountId) -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            let token: Erc20Stub = FromAccountId::from_account_id(callee);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Self { callee: Lazy::new(token) }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn transfer(&amp;mut self, owner: AccountId, amount: Balance) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.callee.transfer(owner, amount).unwrap();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the ink! contract, you can use <code>FromAccountId</code> to instantiate the contract object (not to create a new contract), and then you can use the contract object to make cross-contract calls to contract methods.</p><blockquote><p><code>ink_storage::Lazy</code> manages data entities and delays the execution of read/write operations on the storage. Only when it is determined that reading/writing is really needed, it will be executed on the storage.</p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/metis/tokens.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-contracts-book/en/metis/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Metis</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-contracts-book/en/metis/access-control"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Access Control Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#trait-definition" class="table-of-contents__link">Trait Definition</a><ul><li><a href="#erc20-trait-source-code-analysis" class="table-of-contents__link">erc20 trait source code analysis</a></li><li><a href="#use-erc20-trait-to-implement-the-contract" class="table-of-contents__link">Use erc20-trait to implement the contract</a></li></ul></li><li><a href="#call-stub-across-contracts" class="table-of-contents__link">Call stub across contracts</a><ul><li><a href="#erc20-stub-source-code-analysis" class="table-of-contents__link">erc20 stub source code analysis</a></li><li><a href="#cross-contract-call-through-erc20-stub" class="table-of-contents__link">Cross-contract call through erc20 stub</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/substrate-contracts-book/en/assets/js/runtime~main.4f2bb0f7.js"></script>
<script src="/substrate-contracts-book/en/assets/js/main.32f2285c.js"></script>
</body>
</html>