"use strict";(self.webpackChunksubstrate_contracts_book=self.webpackChunksubstrate_contracts_book||[]).push([[7383],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=l(n),d=o,p=m["".concat(c,".").concat(d)]||m[d]||h[d]||r;return n?a.createElement(p,i(i({ref:t},u),{},{components:n})):a.createElement(p,i({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1613:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return u},default:function(){return m}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],s={},c="Contract overview",l={unversionedId:"contracts/overview",id:"contracts/overview",isDocsHomePage:!1,title:"Contract overview",description:"Background Information",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/contracts/overview.md",sourceDirName:"contracts",slug:"/contracts/overview",permalink:"/substrate-contracts-book/en/contracts/overview",editUrl:"https://github.com/patractlabs/substrate-contracts-book/docs/contracts/overview.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Substrate contract",permalink:"/substrate-contracts-book/en/contracts/introduction"},next:{title:"Contract model",permalink:"/substrate-contracts-book/en/contracts/model"}},u=[{value:"Background Information",id:"background-information",children:[]},{value:"What is a sandbox\uff1f",id:"what-is-a-sandbox\uff1f",children:[]},{value:"Sandbox for running contracts",id:"sandbox-for-running-contracts",children:[]},{value:"More information",id:"more-information",children:[]}],h={toc:u};function m(e){var t=e.components,s=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},h,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"contract-overview"},"Contract overview"),(0,r.kt)("h2",{id:"background-information"},"Background Information"),(0,r.kt)("p",null,"The model of blockchain running contracts can essentially be considered as a blockchain environment (distributed consensus system) and a platform that can run a piece of logic. From this, we can draw:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Bitcoin model can be split into block model/PoW and Bitcoin script."),(0,r.kt)("li",{parentName:"ul"},"The Ethereum model can be divided into blocks, state models/PoW and EVM."),(0,r.kt)("li",{parentName:"ul"},"Substrate's model can be divided into blocks, state models/Bft consensus and Runtime.")),(0,r.kt)("p",null,"Therefore, in general, the model of the blockchain can be split into:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Run the underlying system of the blockchain: Provide a distributed and trusted environment."),(0,r.kt)("li",{parentName:"ul"},"The business logic of the chain: run in a trusted environment.")),(0,r.kt)("p",null,"In the blockchain system, it is required that for the same code and the same state, the execution results must be consistent. Therefore, at the level of the business logic of the supply chain, in order to ensure the consistency of the execution results, it is required that the entire operating environment does not cause inconsistent running results due to inconsistencies in running nodes (referring to not the same node). In order to ensure this characteristic, most blockchains will adopt the sandbox/virtual machine model and tailor some functions to achieve it."),(0,r.kt)("p",null,"The platform for running the contract is a kind of business logic of the chain. This kind of business logic is especially open for the code that can be run on it, and the content of the contract is not controlled by the chain itself. In this case, a sandbox environment is needed to isolate the operation of various contracts."),(0,r.kt)("h2",{id:"what-is-a-sandbox\uff1f"},"What is a sandbox\uff1f"),(0,r.kt)("p",null,"The concept of sandbox in the computer field is very extensive, and virtual machines are the easiest to simulate the environment of the sandbox. Therefore, in the blockchain, in general, the sandbox will be run by a virtual machine. Different chains use different virtual machines to run the contract sandbox."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ethereum")),(0,r.kt)("p",null,"Gavin Wood's yellow paper proposed the EVM model, created the concept of the Ethereum Virtual Machine (EVM) and drafted the OP_CODE of the EVM, and then designed the Solidity to compile to the OP_CODE, thus having the entire ecology of Ethereum. It is equivalent to Ethereum's contract sandbox model for processing blockchain, building all facilities from zero to one. Therefore, the syntax of Solidity and the things that EVM can do are very rudimentary compared with the current blockchain, such as the syntax of Solidity and the stack depth limit of EVM. But as a pioneer, it pioneered the blockchain contract virtual machine model."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fabric")),(0,r.kt)("p",null,"As a consortium chain, it is different from the public chain in usage scenarios. Fabric puts forward the concept of chain code and runs the chain code on Docker. Compared with EVM, Docker is a heavier type of virtual machine. Therefore, compared with EVM, Fabric's chaincode can do more than Solidity, of course, the cost of its operation will be relatively higher."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"EOS")),(0,r.kt)("p",null,"EOS adopted Wasm as the virtual machine of the contract, which was also EOS's advantage at the time. Compared to the EVM running Solidity, EOS's Wasm virtual machine has a much higher operating efficiency. Using C++ as a language compiled to Wasm has also attracted many traditional developers. EOS, as the forerunner of Wasm virtual machine, had already demonstrated the advantages of Wasm over EVM at that time. However, due to the design defects of its contract model and the constraints of the environment at the time, and EOS is not a true decentralized system, EOS was not very Well demonstrated the capabilities of the Wasm contract system."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Substrate's ",(0,r.kt)("inlineCode",{parentName:"li"},"pallet-contracts"))),(0,r.kt)("p",null,"Pallet-contracts uses the Wasm virtual machine to run contracts. Currently, for security reasons, only the",(0,r.kt)("inlineCode",{parentName:"p"},"Wasmi")," interpreter is used to execute Wasm. But its contract model is similar to the EVM contract model (see the next chapter for details). The Wasm virtual machine and EVM also have the characteristics of fast startup and loss as you use it. It has high performance and high scalability while not being too large like Docker and JVM. Therefore, Wasm is slowly being adopted in more scenarios outside the browser environment, such as edge computing and hot updates. Therefore, more and more new blockchains will use the Wasm virtual machine as the main solution when they need a sandbox environment. On the other hand, Wasm also has the features of compiling from different languages to Wasm, such as Rust, Assemblyscript, C++, etc., which attracts all kinds of developers to join the contract development process."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Other blockchains")),(0,r.kt)("p",null,"Other blockchains will also have their own solutions in order to achieve the goal of this sandbox. Some alliance chains use tailored JVMs, some public chains use",(0,r.kt)("inlineCode",{parentName:"p"},"RISC-V"),"virtual machines, and some chains use a design from scratch. A virtual machine (for example \uff0clibra). Each of these solutions has its own requirements and characteristics, but from the perspective of the model, no matter what the solution, the ultimate goal is to provide a virtual machine environment to run the contract sandbox."),(0,r.kt)("h2",{id:"sandbox-for-running-contracts"},"Sandbox for running contracts"),(0,r.kt)("p",null,"Most of the business logic of the chain will run in the sandbox system, and the business logic of running contracts requires sandbox isolation. On the other hand, Substrate's runtime is a sandbox environment running in Wasm, so in Substrate's contract module"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Pallet-evm")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts")," need to run another sandbox in a sandbox environment, as shown in the figure below."),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(5949).Z})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On the left is the Ethereum model, which means that every time a contract is run, an Ethereum virtual machine needs to be started on the chain platform to run it."),(0,r.kt)("li",{parentName:"ul"},"On the right is the Substrate model. The business logic of the Substrate chain runs in the Wasm virtual machine.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Pallet-evm"),": The EVM of Ethereum is compiled into Runtime Wasm, so every contract that runs is actually consistent with Ethereum, and an Ethereum virtual machine is created to run. If the chain is running in Wasm form, that is, an Ethereum virtual machine is generated in the Wasm virtual machine to run."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),": Wasm contracts use Wasm virtual machine to run contracts. Unlike ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-evm,"),"if the chain is running in Wasm form, the virtual machine of Wasm contract jumps out of the current Runtime Wasm virtual machine and recreates a new Wasm virtual machine. The machine is running. Up to now,",(0,r.kt)("inlineCode",{parentName:"p"},"Wasmtime")," is recommended for the Wasm virtual machine of Runtime, and",(0,r.kt)("inlineCode",{parentName:"p"},"Wasmi"),"can only be used for ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),". Pallet-contracts can also be executed using Wasmtime, but Parity currently believes that Wasmtime is relatively uncontrollable, so ",(0,r.kt)("inlineCode",{parentName:"p"},"Wasmtime")," has not yet been adopted. Currently they have related plans and prototype code to use ",(0,r.kt)("inlineCode",{parentName:"p"},"Wasmtime")," to run",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts"),"contracts."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Notice, after the pr ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/paritytech/substrate/pull/9592"},"Remove dependency on sandboxing host functions #9592")," was merged in substrate, wasmi no longer jumps out of the current Wasm execution in the execution environment of Wasm The device executes independently, but as a normal program running in the current Wasm environment. The running model at this time is consistent with ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-evm"),". That is, a Wasm interpreter is run in the Wasm environment, and Wasm code is executed in the interpreter.")),(0,r.kt)("p",null,"In short, in the process of running the contract, most chains adopt a sandbox model to run the contract. And for EVM and for the ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts")," model, a virtual machine is created every time a contract is run."),(0,r.kt)("h2",{id:"more-information"},"More information"),(0,r.kt)("p",null,"Wasmtime is a Wasm virtual machine that implements JIT, and Wasmi is a pure interpreter-type Wasm virtual machine. In terms of execution efficiency, Wasmtime's execution efficiency is much higher than Wasmi."))}m.isMDXComponent=!0},5949:function(e,t,n){t.Z=n.p+"assets/images/overview_module-246e35270f68a24c0e5f508c185028d4.jpg"}}]);