<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Contract model | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/en/contracts/model"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Contract model | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="Background Information"><meta data-react-helmet="true" property="og:description" content="Background Information"><link data-react-helmet="true" rel="shortcut icon" href="/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/en/contracts/model"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/contracts/model" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/en/contracts/model" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/contracts/model" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/en/assets/js/runtime~main.0df25487.js" as="script">
<link rel="preload" href="/en/assets/js/main.9e69ee6e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><img src="/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Site</b></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/contracts/model" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡</a></li><li><a href="/en/contracts/model" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/en/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/introduction">Substrate contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/overview">Contract overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/en/contracts/model">Contract model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/language">Contract language</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/wasm_first_step">Brief introduction of Wasm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/en/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Metis</a></li><li class="menu__list-item"><a class="menu__link" href="/en/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/en/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Contract model</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="background-information"></a>Background Information<a class="hash-link" href="#background-information" title="Direct link to heading">#</a></h2><p>The contract sandbox only represents the environment in which the contract is run, but how the contract is run, how the contract interacts with the contract, and how the contract interacts with the data of the chain. These problems belong to the contract model problem. In other words, the contract model refers to the model in which the contract runs in the contract sandbox/virtual machine.</p><p><img src="/en/assets/images/engcontract_model_1-78a55603f316264f3cdf9440ceb1c27f.jpg"></p><p>As shown in the figure above, the contract model and the contract virtual machine can be decoupled in nature, and the relationship only exists whether the contract virtual machine supports the contract model required by the upper layer. To facilitate the understanding of the contract model, you can refer to the following examples.</p><ul><li>Bitcoin&#x27;s virtual machine is the stack executor of Bitcoin scripts. Because the executor design is a non-Turing complete OP_CODE, the upper-level contract model can only support Bitcoin scripts.</li><li>Following the inspiration of Bitcoin, Ethereum designed a Turing-complete OP_CODE, namely EVM . The OP_CODE of EVM is relatively simple, and only has a stack design without the concept of a heap. But EVM introduces the OP_CODE of read and write state, so the contract model can support the state model from the virtual machine mechanism. As described by Gavin Wood in the Ethereum Yellow Paper, EVM is also regarded as a state transition machine that performs state transitions. The state model is actually a more general abstract model. Most models can be simulated with the state model, for example, the UTXO model is constructed in the state model. In theory, as long as the OP_CODE of the EVM continues to be improved, the upper layer of the EVM can also construct other contract models.</li><li>libra believes that the core of the blockchain lies in the processing of assets, and proposed the concept of Move&#x27;s virtual machine model MVM (Move Virtual Machine). From the model of restricting the contract on the virtual machine, it can be understood as a set of OP_CODE with specialized logic. Therefore, the upper layer of MVM can only run the Move model.</li></ul><p>As described above , I believe you have a clearer understanding of the concept of the contract model, and realize the limitations of the virtual machine on the upper-level contract model.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="wasm-virtual-machine"></a>Wasm virtual machine<a class="hash-link" href="#wasm-virtual-machine" title="Direct link to heading">#</a></h2><p>The following describes the contract model that the Wasm virtual machine can run and the contract model composition of pallet-contracts.</p><p><a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">WebAssembly</a> (abbreviated as Wasm) is a binary instruction format that runs on a stack-based virtual machine, so the model structure of Wasm is similar to that of mainstream computer programs. On the other hand,  Wasm is designed into a more general form, and WASI is designed and supports the free definition of <code>host function</code> in the operating environment. Therefore, although Wasm evolved from a browser, the current usage scenarios are not limited to browsers, and begin to play a role in edge computing, hot updates, and Serverless platforms.</p><p>If the ability of a virtual machine is measured by the completeness of instructions, the EVM is at the level of a semi-finished product, which is more restrictive and not flexible enough. The instructions of the JVM and Wasm virtual machines are relatively complete, with few restrictions and strong functionality. On the other hand, the rationality of the instruction design will also affect the execution efficiency of the virtual machine to a certain extent, and the implementation scheme adopted by the virtual machine will also have a relatively large impact on the execution efficiency. For example, EVM currently can only be run in the form of an interpreter, and the current implementation process body (Go, C++, etc.) does not see optimization for the interpreter, and the execution efficiency is relatively low, while virtual machines such as JVM and Wasm use JIT The execution efficiency is quite high, even approaching the performance of local execution.</p><p><strong>Note</strong> The <code>pallet-contracts</code> currently can only use wasmi (interpreter) to execute Wasm code, so the execution performance of the contract is not as good as the execution performance of Runtime using wasmtime.</p><p>However, compared with virtual machines such as JVM, the Wasm virtual machine is light, fast, and highly customizable, and the function of the host function gives the Wasm virtual machine a channel for interaction with the host. Therefore, compared with other virtual machines, It is easier to combine the Wasm virtual machine as a blockchain contract sandbox with the functions of the chain.</p><p>At the same time, Wasm is a better abstraction layer between the underlying code and the upper code, and its complexity and completeness are far beyond EVM, which can better meet the needs of the blockchain contract field.</p><p>The sandbox environment provided by the Wasm virtual machine meets the following requirements on the premise that the contract sandbox is satisfied:</p><ul><li>Complete instructions, rich functionality, and high execution efficiency.</li><li>There is a suitable interface to interact with the host (here refers to the environment where Wasm is running, that is, the chain) to facilitate the host to provide the required functions.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="evm-contract-model"></a>EVM contract model<a class="hash-link" href="#evm-contract-model" title="Direct link to heading">#</a></h2><p>Ethereum is a blockchain that stores state, so the EVM contract model requires basic functions of reading and writing state. If the process of each contract operation is regarded as a process from the start of the program to the end of its execution, then the changes in the state data correspond to the changes in the data that the program needs to persist. For the read and write status, Ethereum&#x27;s EVM provides two instructions,<code>SLOAD </code>and <code>SSTORE</code>.</p><p>On the other hand, Ethereum describes an account that uses the account model, that is, the contract and the user calling the contract are regarded as an account. Under this account, there are concepts such as balance. Therefore, EVM provides a series of instructions such as <code>CALLER</code> ,<code>ORIGIN</code>,<code>CALLVALUE</code>, etc. to describe This model.</p><p>At the same time, in the abstract system of EVM, the contract and the user are considered to be consistent, so there is a model of contract calling contract, namely <code>CALL</code>,<code>DELEGATECALL </code> and other instructions, which brings the composability of the contract and achieves the prosperity of Ethereum&#x27;s ecology. In EVM, a contract relies on one EVM to run, so the contract calling contract starts another EVM in one EVM, and loads instructions for execution.</p><p>The original intention of the EVM virtual machine is to solve the problem of non-Turing completeness of the Bitcoin script. In order to solve this problem and ensure that the downtime problem does not occur, the instruction Gas billing model is introduced.</p><p>In summary, the EVM contract model has the following characteristics:</p><ol><li>The data processing model is the state machine model, and the state change is triggered by external calls (similar to the process of calling the state change function).</li><li>The contract model requires chain-related features.</li><li>Treat the contract as consistent with the user and allow the contract to call the contract.</li><li>Introduce an instruction billing model.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="pallet-contracts-contract-model"></a>Pallet-contracts contract model<a class="hash-link" href="#pallet-contracts-contract-model" title="Direct link to heading">#</a></h2><p>Although pallet-contracts uses the Wasm virtual machine to execute code, its contract model is basically the same as the EVM contract model. Therefore, the contract model of pallet-contracts also has the four characteristics of the EVM contract model mentioned above. Based on the storage lease model, storage lease charging is added:</p><ol><li>The data processing model is a state machine model, and the change of state is triggered by external calls.</li><li>The contract model requires chain-related features.</li><li>Treat the contract as consistent with the user and allow the contract to call the contract.</li><li>Introduce an instruction billing model.</li><li>Storage lease model.</li></ol><p>The contract execution environment and contract model can be decoupled, but because EVM was designed earlier, there is no concept of decoupling. Therefore, SLOAD, SSTORE, and similar chain-related instructions in the instructions are merged with other EVM instructions. Wasm was not originally designed for blockchain, so there are no instructions related to the chain environment.</p><p>The host function of Wasm is used to accomplish this. As the host , the chain only needs to provide the Wasm virtual machine with the methods it thinks the contract may use, and let it import these function objects, which can be used during the execution of the contract. Therefore, through the host function and pallet-contracts contract module, you can have the functions of 1, 2, and 4, and will provide some of the functions required by the third point, and the fifth feature (rental billing) can also be introduced. And the implementation of the third function above is also consistent with EVM. When there is a part of the contract calling the contract, the host function is used to return to the pallet-contracts module from Wasm, and a new Wasm virtual machine is started to execute the called contract. (This part will be elaborated in a future article).In summary, the contract model of pallet-contracts has the following characteristics:</p><ul><li>The contract model is consistent with the EVM contract model, and a storage billing model is added on this basis.</li><li>The interaction with the chain is realized through the host function feature of Wasm.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="use-wasm-virtual-machine-to-implement-other-contract-models"></a>Use Wasm virtual machine to implement other contract models<a class="hash-link" href="#use-wasm-virtual-machine-to-implement-other-contract-models" title="Direct link to heading">#</a></h2><p>The above describes how pallet-contracts implements the contract model on the Wasm virtual machine. It has also been mentioned in the previous document that the virtual machine and the contract model can be decoupled, so other things can also be implemented on the Wasm virtual machine. Contract model.</p><p>If the Move virtual machine is also transplanted to the Wasm virtual machine, there are two possible ways to implement.</p><ul><li>Analogous to running the EVM implementation in the Runtime Wasm environment, the MVM implementation can also be compiled into the form of Wasm (for example, named <code>pallet-mvm</code>) and run in the Runtime Wasm.</li></ul><p>Based on this implementation, Move can still be compiled in the normal way, and the compiled result of Solidity runs on <code>pallet-evm</code> consistent with that of Solidity, and the compiled result of Move is run on a platform such as <code>pallet-mvm</code>.</p><ul><li>Abstract one level of MVM, ownership, and chain-related features into the form of pallet-contracts, and design to compile the intermediate code IR compiled by the Move language to Wasm.</li></ul><p>Based on this realization, Move can be compiled into Wasm and run in the Wasm virtual machine.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="other-contract-models"></a>Other contract models<a class="hash-link" href="#other-contract-models" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="eos-contract-model"></a>EOS contract model<a class="hash-link" href="#eos-contract-model" title="Direct link to heading">#</a></h3><p>EOS&#x27;s contract model is similar to EVM, while strengthening the concept of account model. Therefore, the way EOS uses Wasm is also based on the execution of Wasm, and introduces chain-related functions by <code>host function</code>.</p><p>The main difference between the EOS and EVM models is that the EOS contract calls the contract in the form of transaction calls, and the EOS resource model is a mortgage model. At present, it is generally believed that EOS has not succeeded because of the EOS mortgage model.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="asynchronous-contract-model"></a>Asynchronous contract model<a class="hash-link" href="#asynchronous-contract-model" title="Direct link to heading">#</a></h3><p>Pallet-actor is the beginning of substrate&#x27;s attempt to implement an asynchronous contract model, but there is currently no progress. For details, please refer to the <a href="https://corepaper.org/contract/actor/" target="_blank" rel="noopener noreferrer">Actor-based contract model</a>. The <code>pallet-actor</code> model intends to use the Wasm virtual machine as the operating environment, and on this basis add asynchronous functions to improve performance. There are also a few other studies on asynchronous contract models, but they are all in the preliminary stage, so I won&#x27;t elaborate on them here.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/contracts/model.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/contracts/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Contract overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/en/contracts/language"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contract language Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background-information" class="table-of-contents__link">Background Information</a></li><li><a href="#wasm-virtual-machine" class="table-of-contents__link">Wasm virtual machine</a></li><li><a href="#evm-contract-model" class="table-of-contents__link">EVM contract model</a></li><li><a href="#pallet-contracts-contract-model" class="table-of-contents__link">Pallet-contracts contract model</a></li><li><a href="#use-wasm-virtual-machine-to-implement-other-contract-models" class="table-of-contents__link">Use Wasm virtual machine to implement other contract models</a></li><li><a href="#other-contract-models" class="table-of-contents__link">Other contract models</a><ul><li><a href="#eos-contract-model" class="table-of-contents__link">EOS contract model</a></li><li><a href="#asynchronous-contract-model" class="table-of-contents__link">Asynchronous contract model</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/en/assets/js/runtime~main.0df25487.js"></script>
<script src="/en/assets/js/main.9e69ee6e.js"></script>
</body>
</html>