<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Patract Hub&#x27;s treasury report for Himalia v0.1 &amp; v0.2(Contract SDKs) | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/himalia/reports/v0.1Report"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Patract Hub&#x27;s treasury report for Himalia v0.1 &amp; v0.2(Contract SDKs) | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="5 weeks ago，Patract Hub applied a treasury proposal #61 for Himalia v0.1&amp;v0.2, Now, we have finished all the work and you can review our codebase at："><meta data-react-helmet="true" property="og:description" content="5 weeks ago，Patract Hub applied a treasury proposal #61 for Himalia v0.1&amp;v0.2, Now, we have finished all the work and you can review our codebase at："><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/himalia/reports/v0.1Report"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/himalia/reports/v0.1Report" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/en/himalia/reports/v0.1Report" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/himalia/reports/v0.1Report" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/assets/js/runtime~main.ddf0c6c8.js" as="script">
<link rel="preload" href="/assets/js/main.89f4a9e7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>主页<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/himalia/reports/v0.1Report" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="/en/himalia/reports/v0.1Report" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">介绍</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/introduction">Substrate 合约书</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/overview">合约综述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/model">合约模型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/language">合约语言</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/contracts/wasm_first_step">Wasm简要介绍</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Himalia</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/himalia/introduction">Himalia</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/himalia/tutorial">tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/himalia/go-patract">go-patract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/himalia/py-patract">py-patract</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Reports</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/himalia/reports">Himalia议会提案报告</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/himalia/reports/v0.1Report">Patract Hub&#x27;s treasury report for Himalia v0.1 &amp; v0.2(Contract SDKs)</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Metis</a></li><li class="menu__list-item"><a class="menu__link" href="/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Patract Hub&#x27;s treasury report for Himalia v0.1 &amp; v0.2(Contract SDKs)</h1></header><p>5 weeks ago，Patract Hub applied a <a href="https://kusama.polkassembly.io/treasury/61" target="_blank" rel="noopener noreferrer">treasury proposal #61</a> for Himalia v0.1&amp;v0.2, Now, we have finished all the work and you can review our codebase at：</p><ul><li>Himalia v0.1 PatractGo <a href="https://github.com/patractlabs/go-patract" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/go-patract</a></li><li>Himalia v0.2 PatractPy <a href="https://github.com/patractlabs/py-patract" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/py-patract</a></li></ul><p><code>PatractGo</code> mainly completes the contract-related interfaces and APIs, and supports scanning and monitoring (observer) of events generated by the contract. <code>PatractGo</code> is based on <a href="https://github.com/centrifuge/go-substrate-rpc-client" target="_blank" rel="noopener noreferrer">Centrifuge&#x27;s GSRPC</a>. In the development process, in order to make the API more convenient to use and embed other services, we encapsulated GSRPC, providing API call based on context style. In addition, some interfaces that are not provided by GSRPC but are more useful for development and debugging have been added, such as encode and decode of AccountID in ss58 format, and unit test environment support.</p><p><code>PatractGo</code> further encapsulates common ERC20 contracts, including API and monitoring support. This is convenient for processing ERC20 contracts, and can be used as an example to guide the development of other contract APIs. <strong>In the future, <code>PatractGo</code> will develop a code generator that automatically generates the corresponding go code based on the metadata of the contract. Since the logic of this generation process is the same for go and java, this part of the function is postponed to complete with <code>PatractJ</code>. An example of <code>ERC20</code> is provided in the current version to show how to make packaging calls for a specific contract.</strong> For more information about <code>PatractGo</code>, please refer to the following function description and sample code in the project.</p><p><code>PatractGo</code> also provieds the following founctions:</p><ul><li><a href="https://github.com/patractlabs/go-patract/tree/master/examples/dump" target="_blank" rel="noopener noreferrer">dump</a> provides an example of the ERC20 contract status synchronization tool. Dump will scan all events of the specified ERC20 contract. The number of tokens corresponding to the account is synchronized to a local database, and a simple query function is provided. This example can be used as an example of Oberver, and at the same time, it can be used as a tool to analyze the Token distribution of a specified ERC20 contract.</li><li><a href="https://github.com/patractlabs/go-patract/tree/master/examples/rest" target="_blank" rel="noopener noreferrer">rest</a> use [github.com/patractlabs/go-patract/rest](<a href="https://github.com" target="_blank" rel="noopener noreferrer">https://github.com</a> /patractlabs/go-patract/tree/master/rest) module. rest builds the url corresponding to the message based on metadata. Users can use this service to build the unsigned Extrinsic binary data of the specified contract, which can be sent to the trusted environment Third-party tool for signing. Based on this model, when contract developers use the Golang to develop contract back-end services, they can put the private key in an independent network environment and development environment to protect the security of the private key. In some scenarios, this processing is necessary , such as the account management of an exchange. As a developer-oriented SDK, programs containing <code>PatractGo</code> and other SDK codes may not be able to run in some sensitive environments. Therefore, rest provides an HTTP-based service interface, which is also convenient for developers to access existing authorization system.</li></ul><p><code>PatractPy</code> mainly completes the support of the unit test environment and scans and monitors the events generated by the contract. <code>PatractPy</code> is based on <a href="https://github.com/polkascan/py-substrate-interface" target="_blank" rel="noopener noreferrer">Polkascan&#x27;s Python Substrate Interface</a>. In the v0.11.8 version of <code>py-substrate-interface</code>, they have provided good support for contract API, so <code>PatractPy</code> mainly supplements some of the missing functions of <code>py-substrate-interface</code>, such as subscription API and deserialization support for contract events. <code>PatractPy</code> can automatically construct a python contract object based on the <code>message</code> part of the metadata, and has a method to call the contract, similar to the implementation of <code>api-contracts</code> in <code>polkadot.js</code>. Therefore, after loading metadata, <code>PatractPy</code> can simply call the contract according to the definition of the contract&#x27;s own method, without the need for static languages such as Java or Golang to provide a method of interacting with the contract through code generation. On the other hand, <code>PatractPy</code> completes the scanning and monitoring of events generated by the contract, and its implementation can also be used to process events from other modules.</p><p>As the most important function of <code>PatractPy</code>, we hope that it can support our <a href="https://github.com/patractlabs/europa" target="_blank" rel="noopener noreferrer">Europa</a> and complete unit testing for contracts based on it. On the one hand, as the realization of the test case of the <code>PatractPy</code> project itself, on the other hand, we can use python to implement the test case code for the contract based on the <code>PatractPy</code> to test and reproduce the test cases in complex scenarios, plus complete Python ecological test support can make smart contract development more convenient and efficient.</p><p>In the future, <code>PatractGo</code> and <code>PatractPy</code> will be integrated into our <code>Redspot</code> in the form of plug-ins. Therefore, for a contract development project, you can use <code>Redspot</code> to build a contract development framework, and then use Redspot&#x27;s own <code>polkadot.js</code> or use a plug-in<code>PatractPy</code> to quickly and easily perform contract debugging and integration testing in our <code>Europa</code>, and then use <code>PatractGo</code> to call the contract. After the entire system has been debugged in the test environment, use the backend required by <code>PatractGo</code> to develop the contract and use it in the production environment. The next version of <code>PatractJ</code> and <code>PatractN</code> will be integrated into the <code>Redspot</code> system in the same way.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-himalias-future-development-plan"></a>1. Himalia&#x27;s future development plan<a class="hash-link" href="#1-himalias-future-development-plan" title="Direct link to heading">#</a></h2><ul><li><del>M1: v0.1 PatractGo for Golang</del></li><li><del>M2: v0.2 PatractPy for Python</del></li><li>M3: v0.3 PatractJ for JVM </li><li>M4: v0.4 PatractN for .NET</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-patractgo-report"></a>2. PatractGo Report<a class="hash-link" href="#2-patractgo-report" title="Direct link to heading">#</a></h2><p>Based on PatractGo，we can interact with the contracts very easily。The design goal of PatractGo is closer to that the contract owner build its own business logic to interact with the contract on the chain through PatractGo, which is not suitable for the scenario of contract debugging. If you need to debug the contract, it is recommended to use <code>ParactPy</code> or <code>polkadot.js</code> for quick testing.</p><p>For <code>PatractGo</code>, we split the functions into three components:</p><ul><li>Contracts：provides the functions to interact with contracts</li><li>Rest：provides a way to generate an offline signature for contracts.</li><li>Observer: listens contract events and parses events by contract metadata.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-api-for-contracts"></a>2.1 API for Contracts<a class="hash-link" href="#21-api-for-contracts" title="Direct link to heading">#</a></h3><p>By Native Contract API，We Can Call Contracts Runtime Earlier。</p><p>Put Contracts Code to chain：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // read the code wasm from file</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   codeBytes, err := ioutil.ReadFile(&quot;/path/to/contracts.wasm&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   if err != nil {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      return err</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // create the api</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   cApi, err := rpc.NewContractAPI(env.URL())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // read the abi(metadata) for contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   metaBz, err := ioutil.ReadFile(&quot;/path/to/contracts_metadata.json&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   cApi.WithMetaData(metaBz)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // create context with from auth, like Alice</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   ctx := api.NewCtx(context.Background()).WithFrom(authKey)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // put code</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   _, err = cApi.Native().PutCode(ctx, codeBytes)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // do next steps</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Get Code from chain：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   codeHash := readCodeHash() // get code hash</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   var codeBz []byte</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err := cApi.Native().Cli.GetStorageLatest(&amp;codeBz,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;Contracts&quot;, &quot;PristineCode&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        []byte(codeHash), nil); err != nil {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return err</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   // codeBz is now code</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Instantiate Contract in chain:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var endowment uint64 = 1000000000000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Instantiate</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    _, contractAccount, err := cApi.Instantiate(ctx,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        types.NewCompactBalance(endowment),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        types.NewCompactGas(test.DefaultGas),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        contracts.CodeHashERC20,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        types.NewU128(totalSupply),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>api will return <code>contractAccount</code>, which can use it to call the contract.</p><p>For a contract, we can read or exec messages. Currently <code>CallToRead</code> and <code>CallToExec</code> implement a more basic level of encapsulation for contract calls, so contract developers need to write corresponding packaging functions according to the contract method, such as the ERC20 contract under the directory of <code>PatractGo/contracts/erc20</code> example.</p><p>Read the total_supply of ERC20 contract, no request params:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var res types.U128</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err := a.CallToRead(ctx,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;res,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        a.ContractAccountID,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        []string{&quot;total_supply&quot;},</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Read the balance_of of AccountID for ERC20 contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    req := struct {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Address types.AccountID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Address: owner,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var res types.U128</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err := a.CallToRead(ctx,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;res,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ContractAccountIDForERC20,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        []string{&quot;balance_of&quot;},</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        req,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Call Transfer:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    toParam </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Address AccountID</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> to</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    valueParam </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Value U128</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> amt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">CallToExec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ContractAccountID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        types</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">NewCompactBalance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        types</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">NewCompactGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DefaultGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;transfer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        toParam</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> valueParam</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>These behaviors will be automatically generated after the <code>auto contract code generator</code> is completed, without the developers needing to care about this part.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-rest-api-for-contract"></a>2.2 REST API for Contract<a class="hash-link" href="#22-rest-api-for-contract" title="Direct link to heading">#</a></h3><p>We can use rest to get unsigned raw byte data for contract call, it can help to build an offline signature for contract.</p><p>can use this for example: <a href="https://github.com/patractlabs/go-patract/blob/master/examples/rest/main.go" target="_blank" rel="noopener noreferrer">rest</a></p><p>start the rest server:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">go run ./examples/rest </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>to get data:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">curl</span><span class="token plain"> -X POST </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://localhost:8899/erc20/exec/transfer?isOffline=true&amp;contract=5HKinTRKW9THEJxbQb22Nfyq9FPWNVZ9DQ2GEQ4Vg1LqTPuk&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -H </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;content-type: application/json&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -d </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;nonce&quot;:1,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;chain_status&quot;:{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;spec_version&quot;:1,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;tx_version&quot;:1,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;block_hash&quot;:&quot;0xc20f241b61039e5685d118c7fbc8b27210153c21eee7686a9466f22e01281114&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;genesis_hash&quot;:&quot;0xc20f241b61039e5685d118c7fbc8b27210153c21eee7686a9466f22e01281114&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;contract&quot;:&quot;5HKinTRKW9THEJxbQb22Nfyq9FPWNVZ9DQ2GEQ4Vg1LqTPuk&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;origin&quot;:&quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;gas_limit&quot;:&quot;500000000000&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    &quot;args&quot;:{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;to&quot;:&quot;5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">        &quot;value&quot;:&quot;100000000&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">}&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23--observer"></a>2.3  observer<a class="hash-link" href="#23--observer" title="Direct link to heading">#</a></h3><p>For a contract, we need observer events for the contract, can use <code>observer</code> to build a contract events observer service:</p><p>a complete example: <a href="https://github.com/patractlabs/go-patract/blob/master/examples/observer/main.go" target="_blank" rel="noopener noreferrer">observer</a></p><p>Also can take the <a href="https://github.com/patractlabs/go-patract/blob/master/examples/dumper/main.go" target="_blank" rel="noopener noreferrer">dumper</a> for example, it dump events by contacts to a db.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // create observer</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    o := observer.New(logger, *flagURL)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ctx, cancelFunc := context.WithCancel(context.Background())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // other init functions</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // create a handler for process events in chain</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    h := observer.NewEvtHandler()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    h = h.WithContractExecution(func(l log.Logger, height uint64, evt types.EventContractsContractExecution) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        data := evt.Data</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        l.Debug(&quot;handler contract execution&quot;, &quot;height&quot;, height)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // for golang we need process each diff types for event</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        typ := metadata.GetEvtTypeIdx(data)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        switch typ {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case 0:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            var transfer erc20.EventTransfer</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            err := metaData.Spec.Events.DecodeEvt(metaData.NewCtxForDecode(data).WithLogger(l), &amp;transfer)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if err != nil {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                logger.Error(&quot;evt decode transfer error&quot;, &quot;err&quot;, err, &quot;height&quot;, height)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            logger.Info(&quot;transfer event&quot;, &quot;evt&quot;, transfer)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        case 1:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            var approve erc20.EventApproval</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            err := metaData.Spec.Events.DecodeEvt(metaData.NewCtxForDecode(data).WithLogger(l), &amp;approve)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if err != nil {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                logger.Error(&quot;evt decode approve error&quot;, &quot;err&quot;, err, &quot;height&quot;, height)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            logger.Info(&quot;approve event&quot;, &quot;evt&quot;, approve)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // watcher events</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err := o.WatchEvent(ctx, h); err != nil {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        logger.Error(&quot;watch event error&quot;, &quot;err&quot;, err)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="24-support-for-erc20-contract"></a>2.4 Support for ERC20 Contract<a class="hash-link" href="#24-support-for-erc20-contract" title="Direct link to heading">#</a></h3><p>In <code>github.com/patractlabs/go-patract/contracts/erc20</code>, Complete ERC20 contract support.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        erc20API := erc20.New(rpcAPI, contractAccountID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ctx := rpc.NewCtx(context.Background()).WithFrom(signature.TestKeyringPairAlice)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // transfer alice to bob</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        aliceTotal, err := erc20API.BalanceOf(ctx, test.AliceAccountID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // transfer</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _, err = erc20API.Transfer(ctx, bob, types.NewBalanceByU64(100))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        bobBalance, err := erc20API.BalanceOf(ctx, bob)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        aliceNewTotal, err := erc20API.BalanceOf(ctx, test.AliceAccountID)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="24-tools"></a>2.4 Tools<a class="hash-link" href="#24-tools" title="Direct link to heading">#</a></h3><p>We make some tools for developing constracts, like:</p><ul><li><a href="https://github.com/patractlabs/go-patract/tree/master/tools/parser" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/go-patract/tree/master/tools/parser</a> a parser for address</li><li><a href="https://github.com/patractlabs/go-patract/tree/master/tools/querier" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/go-patract/tree/master/tools/querier</a> a querier for get some datas from chain</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-patractpy-report"></a>3. PatractPy Report<a class="hash-link" href="#3-patractpy-report" title="Direct link to heading">#</a></h2><p>For Unittest, should install <a href="https://github.com/patractlabs/europa" target="_blank" rel="noopener noreferrer">Europa</a> at first.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">europa --version</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">europa </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain">.0-3f71403-x86_64-linux-gnu</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>All of test passed by <code>Europa</code> environment.</p><p>The design goal of <code>PatractPy</code> is to simplify the repetitive work of the interaction between developers and the contracts, and to monitor contract events, so as to provide a simplified way to quickly call and debug the contract. Therefore, the function of <code>PatractPy</code> will be similar to the <code>api-contracts</code> in <code>polkadot.js</code>. It can load contract instances according to the metadata of the contract, and automatically provide corresponding methods to the python contract instances according to the content of the metadata. Developers can call these generated methods to interact with the contract on the chain.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-basic-apis-for-contracts"></a>3.1 Basic Apis For Contracts<a class="hash-link" href="#31-basic-apis-for-contracts" title="Direct link to heading">#</a></h3><p>As <a href="https://github.com/polkascan/py-substrate-interface" target="_blank" rel="noopener noreferrer">polkascan&#x27;s Python Substrate Interface</a> has provide some support to contract api, so we not need to improve the apis for contract calls, but there is some api to add:</p><ul><li><code>SubstrateSubscriber</code> is a subscriber support to subscribe data changes in chain, for example, the events in chain.</li><li><code>get_contract_event_type</code> add event decode support for contracts.</li></ul><p>The basic api split into 2 parts:</p><ul><li>Contract, include:<ul><li>contractExecutor: This api could construct an extrinsic to call a contract, would be packed into a block and change state.</li><li>contractReader: This api could construct a rpc request to call a contract, do not pack into a block and do not change any state.</li><li>contractCreator: This api is used for <code>instantiate</code> a contract and holding the WASM code and metadata, receive following parameters:<ul><li><code>gas_limit</code></li><li><code>endowment</code></li><li><code>deployment_salt</code> (<code>salt</code> parameter in <code>instantiate</code>)</li></ul></li><li>ContractAPI: This api is used for <code>call</code> a contract, is a wrapper for <code>contractExecutor</code> and<code>contractReader</code>, developers could use this api to react with contracts. This api could create a instance depends on the metadata, auto generate the contract access functions based on the contract. And the auto-gen functions receive the parameters which defined in contracts, besides receive following common parameters:<ul><li><code>gas_limit</code></li><li><code>value</code> (notice, if current call&#x27;s <code>payable</code> is false, this <code>value</code> must be <code>0</code>)</li></ul></li><li>ContractFactory: This api is used for constructing a contract instance in python, and developer could use this instance to access contract. This is a wrapper for <code>contractCreator</code> and <code>ContractAPI</code></li></ul></li><li>Observer, include:<ul><li>ContractObserver: This api is used for listen the events in contracts.</li></ul></li></ul><p>Based on the api provided above, Python developers can refer to the following case to access the contract. The following example shows a contract instance loaded through the metadata of ERC20. Developers can directly call methods like <code>transfer</code> that are automatically created by metadata to send transactions to the node or call the node&#x27;s rpc to return the contract execution result. On the other hand, the following example also shows how to monitor the events of a contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> os</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> substrateinterface </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SubstrateInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Keypair</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> patractinterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">contract </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> ContractAPI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ContractFactory</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> patractinterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">observer </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> ContractObserver</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># use [europa](https://github.com/patractlabs/europa) as test node endpoint, notice `type_registry` should set correctly.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">SubstrateInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ws://127.0.0.1:9944&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> type_registry_preset</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> type_registry</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;types&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;LookupSource&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MultiAddress&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># load deployer key</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    alice </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Keypair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;//Alice&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bob </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Keypair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;//Bob&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 1. load a contract from WASM file and metadata.json file (Those files is complied by [ink!](https://github.com/paritytech/ink))</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># in this example, we use `ink/example/erc20` contract as example.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ContractFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">substrate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># should provide a subtrate endpoint</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            code_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;res&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.wasm&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metadata_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;res&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># upload code to chain directly</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    res </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">put_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;update code hash{} res:{}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">code_hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">hex</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">is_succes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 2. instantiate the uploaded code as a contract instance</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    erc20_ins </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> endowment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> gas_limit</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">20000000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deployment_salt</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x12&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 2.1 create a observer to listen event</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    observer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ContractObserver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">erc20_ins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">contract_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> erc20_ins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 3. send a transfer call for this contract</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    res </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> erc20_ins</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> gas_limit</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">20000000000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;transfer res&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">is_succes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">on_transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on_transfer in {} : {} {} {}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;from&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;to&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">on_approval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">print</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on_approval in {} : {} {} {}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;spender&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;value&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 4 set event callback </span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    observer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scanEvents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">handlers</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Transfer&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> on_transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Approve&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> on_approval</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;__main__&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">pass</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-contractobserver"></a>3.2 ContractObserver<a class="hash-link" href="#32-contractobserver" title="Direct link to heading">#</a></h3><p>ContractObserver can observer events for a contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">SubstrateInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ws://127.0.0.1:9944&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> type_registry_preset</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;canvas&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">contract_metadata </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ContractMetadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">substrate</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">observer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ContractObserver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x8eaf04151687736326c9fea17e25fc5287613693c912909cb226aa4794f26a48&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> contract_metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># for some handlers</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">observer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scanEvents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The handler function can take the erc20 support as a example.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="33-erc20-api"></a>3.3 ERC20 API<a class="hash-link" href="#33-erc20-api" title="Direct link to heading">#</a></h3><p>In addition to the normal use of metadata to construct contract objects to access the contract, developers can also package their own access methods to the contract according to the basic api provided by <code>PatractPy</code>.</p><p>ERC20 api provide a wrapper to erc20 contract exec, read and observer events, it can be a example for contracts api calling.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># init api</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">SubstrateInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ws://127.0.0.1:9944&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> type_registry_preset</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;canvas&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">contract_metadata </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ContractMetadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">substrate</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alice </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Keypair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;//Alice&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bob </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Keypair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;//Bob&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># erc20 api</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ERC20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_contracts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contract_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.wasm&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># deplay a erc20 contract</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">putAndDeploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># read total supply</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total_supply </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">totalSupply</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># transfer</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">transferFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fromAcc</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    toAcc</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">bob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    amt</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># get balance</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alice_balance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">balanceOf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># approve</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">approve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> spender</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">bob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> amt</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># get allowance</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alice_allowance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">allowance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>ERC20Observer</code> is a event observer for erc20 contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">observer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ERC20Observer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    substrate </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    contract_address </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> contract_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">on_transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fromAcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> toAcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> amt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    logging</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on_transfer in block[{}] : {} {} {}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fromAcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> toAcc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> amt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">on_approval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> spender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> amt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    logging</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;on_approval in block[{}] : {} {} {}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">format</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> owner</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> spender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> amt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">observer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scanEvents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">on_transfer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> on_transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> on_approval </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> on_approval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="34-unittest-node-environment"></a>3.4 Unittest Node Environment<a class="hash-link" href="#34-unittest-node-environment" title="Direct link to heading">#</a></h3><p>PatractPy can support write contract unittest by node environment.</p><p>At First We need install <a href="https://github.com/patractlabs/europa" target="_blank" rel="noopener noreferrer">europa</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> patractinterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">contracts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">erc20 </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> ERC20</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> patractinterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">unittest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">env </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SubstrateTestEnv</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">UnittestEnvTest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">unittest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">TestCase</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@classmethod</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setUp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># start env or use canvas for a 6s block</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">env </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SubstrateTestEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_europa</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">39944</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">startNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">api </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SubstrateInterface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> type_registry_preset</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">typ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">alice </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Keypair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;//Alice&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bob </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> Keypair</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_uri</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;//Bob&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">erc20 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ERC20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">create_from_contracts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            substrate</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">substrate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            contract_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.wasm&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            metadata_file</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__file__</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;constracts&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ink&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;erc20.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">putAndDeploy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000000</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tearDown</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cls</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">stopNode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">test_transfer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">erc20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">transferFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            fromAcc</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">alice</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            toAcc</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">bob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ss58_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            amt</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># some more test case</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    unittest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>By example, we can use python to write testcase for some complex logics, by <a href="https://github.com/patractlabs/europa" target="_blank" rel="noopener noreferrer">Europa</a>, we can test the contracts for python scripts.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-recap-of-verification-of-v01-and-v02"></a>4. Recap of verification of v0.1 and v0.2<a class="hash-link" href="#4-recap-of-verification-of-v01-and-v02" title="Direct link to heading">#</a></h2><p>v0.1 PatractGo</p><ul><li><del>Initialize the project and complete the native contract interaction API</del></li><li><del>Complete the contract interaction API and HTTP contract interaction service based on metadata.json</del></li><li><del>Complete contract status scan support</del></li><li><del>Monitor service support and complete the example to write into the database</del></li><li><del>Complete ERC20 contract support and complete the corresponding command line tools</del></li><li><del>Improve sample code and unboxing documentation</del></li></ul><p>v0.2 PatractPy</p><ul><li><del>Initialize the project and complete the native contract interaction API</del></li><li><del>Complete the contract interaction API based on metadata.json</del></li><li><del>Complete ERC20 contract support</del></li><li><del>Improve sample code and unboxing documentation</del></li></ul><p>We will propose v0.3 and v0.4 later after some time for research.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/himalia/reports/v0.1Report.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/himalia/reports"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Himalia议会提案报告</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/metis/introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metis »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-himalias-future-development-plan" class="table-of-contents__link">1. Himalia&#39;s future development plan</a></li><li><a href="#2-patractgo-report" class="table-of-contents__link">2. PatractGo Report</a><ul><li><a href="#21-api-for-contracts" class="table-of-contents__link">2.1 API for Contracts</a></li><li><a href="#22-rest-api-for-contract" class="table-of-contents__link">2.2 REST API for Contract</a></li><li><a href="#23--observer" class="table-of-contents__link">2.3  observer</a></li><li><a href="#24-support-for-erc20-contract" class="table-of-contents__link">2.4 Support for ERC20 Contract</a></li><li><a href="#24-tools" class="table-of-contents__link">2.4 Tools</a></li></ul></li><li><a href="#3-patractpy-report" class="table-of-contents__link">3. PatractPy Report</a><ul><li><a href="#31-basic-apis-for-contracts" class="table-of-contents__link">3.1 Basic Apis For Contracts</a></li><li><a href="#32-contractobserver" class="table-of-contents__link">3.2 ContractObserver</a></li><li><a href="#33-erc20-api" class="table-of-contents__link">3.3 ERC20 API</a></li><li><a href="#34-unittest-node-environment" class="table-of-contents__link">3.4 Unittest Node Environment</a></li></ul></li><li><a href="#4-recap-of-verification-of-v01-and-v02" class="table-of-contents__link">4. Recap of verification of v0.1 and v0.2</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.ddf0c6c8.js"></script>
<script src="/assets/js/main.89f4a9e7.js"></script>
</body>
</html>