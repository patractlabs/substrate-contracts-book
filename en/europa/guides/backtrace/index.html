<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Europa&#x27;s Wasm Backtrace | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/substrate-contracts-book/en/europa/guides/backtrace"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Europa&#x27;s Wasm Backtrace | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="Background Information"><meta data-react-helmet="true" property="og:description" content="Background Information"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-contracts-book/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/substrate-contracts-book/en/europa/guides/backtrace"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/europa/guides/backtrace" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/en/europa/guides/backtrace" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/europa/guides/backtrace" hreflang="x-default"><link rel="stylesheet" href="/substrate-contracts-book/en/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/runtime~main.63bea2d2.js" as="script">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/main.7f43b64a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-contracts-book/en/"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Site</b></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/substrate-contracts-book/europa/guides/backtrace" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡</a></li><li><a href="/substrate-contracts-book/en/europa/guides/backtrace" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/introduction">Substrate contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/overview">Contract overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/model">Contract model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/language">Contract language</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/wasm_first_step">Brief introduction of Wasm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Europa</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Get Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/intro/overview">Europa Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/intro/europa-ui">Europa UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/intro/europa-cli">Europa CLI</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/architecture">Architeture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/implementation">Contract Pallet Implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/custom-rpcs">Custom RPCs and commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/contract-log">Europa contract execution log</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-contracts-book/en/europa/guides/backtrace">Europa&#x27;s Wasm Backtrace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/debug-example">Europa debugging example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/guides/wasm-executor">Europa Wasm executor</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Chain Extensions</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/europa/extensions/custom-chain-extensions">Custom ChainExtensions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Reports</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Metis</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Europa&#x27;s Wasm Backtrace</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="background-information"></a>Background Information<a class="hash-link" href="#background-information" title="Direct link to heading">#</a></h2><p>The execution of <code>pallet-contracts</code> includes execution in the contract model and execution in Wasm. The execution process in the contract model is transferred to the <code>pallet-contracts</code> module through Wasm&#x27;s host_function. If panic or incorrect positioning occurs, the runtime of the node can be positioned in the form of native operation. Since the execution process in Wasm is in the Wasm virtual machine, it is a black box to the outside world. If the internal execution process crashes abnormally, it can only be displayed by the Wasm executor.</p><p>Europa&#x27;s <code>pallet-contracts</code> module currently supports the following two types of actuators:</p><ul><li><code>wasmi</code>: Wasm interpreter developed by the Parity. When Wasm executes panic, it will only return an error without Backtrace. Patract forks the official wasmi, and adds tracking and printing of the execution stack on top of the original. When a panic occurs during Wasm&#x27;s execution, the current execution stack and corresponding information will be returned with an error.</li><li><code>wasmtime</code>: Wasm&#x27;s JIT executor, which comes with Backtrace when it crashes.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-conditins-of-europa-can-print-out-wasm-backtrace"></a>The conditins of Europa can print out Wasm Backtrace<a class="hash-link" href="#the-conditins-of-europa-can-print-out-wasm-backtrace" title="Direct link to heading">#</a></h2><p>Wasm can print Backtrace, requiring the <code>name section</code> in the Wasm file compiled by the contract. Since <code>cargo-contract</code> provided by Parity encapsulated many operations, the current default operation is to compile the contract in the best optimized way, and the <code>name section</code> section will be removed in this process. On the other hand, cargo-contract does not provide corresponding interfaces or options that allow you to adjust the optimization conditions used in contract compilation and whether to retain some debugging information. Therefore, Patract can only provide a modified version of cargo-contract, and you can use this modified version of cargo-contract to compile a contract Wasm file with a name section.</p><p>On the other hand, the original code will be optimized during the compilation of the release, and it may be disturbed to locate the problem through the optimized Backtrace. Therefore, it is best to reduce the optimization level so that the Backtrace at the time of a crash will most likely match the original code.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="install-cargo-contract-under-patract-repository"></a>Install <code>cargo-contract</code> under Patract repository<a class="hash-link" href="#install-cargo-contract-under-patract-repository" title="Direct link to heading">#</a></h2><ul><li>Install <a href="https://github.com/patractlabs/cargo-contract" target="_blank" rel="noopener noreferrer">cargo-contract</a> under Patract repository.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> cargo-contract --git https://github.com/patractlabs/cargo-contract --branch</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">v0.12.1 --force</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><p><strong>Note</strong> Since the current version of Parity&#x27;s <code>cargo-contract</code> is <code>v0.12.1</code> , our Patract has added features based on this version. If <code>cargo-contract</code> continues to be upgraded in the future, Patract will continue to be maintained.</p><p>The <code>cargo-contract</code> installed in this way will overwrite the installed <code>cargo-contract</code>. Therefore, please pay attention to which repository the <code>cargo-contract</code> in the current environment comes from to prevent interference when locating problems.</p><p>Execute the following commandï¼ŒThe results listed can be used to judge what source the <code>cargo-contract</code> installation in the current environment comes from. For example, the following result is from Patract. If there is no parenthesis and the content in it, it means it is from <code>crates.io</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> --list </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> cargo-contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo-contract v0.12.1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">https://github.com/patractlabs/cargo-contract.git?branch</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">tag-v0.12.1</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#0d682762):</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo-contract</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>If you have installed the official <code>cargo-contract </code>and does not want to overwrite the installation, you can use manual compilation.<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/patractlabs/cargo-contract --branch</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">tag-v0.12.1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cargo-contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo build --release</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><p>After compilation, you can move the compiled product to any path that can be accessed globally, and rename it ,in case it conflicts with the installed cargo-contract.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> target/release/cargo-contract </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">to any path</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">/patract-cargo-contract</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the subsequent compilation of the ink! contract, use <code>patract-cargo-contract xxx</code> instead of <code>cargo +nighlty contract xxx</code> to execute the corresponding commands,but  this method requires the default toolchain to be nightly)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="use-patracts-cargo-contract-to-generatewasmcontractfiles-withname-sectionsection"></a>Use Patract&#x27;s cargo-contract to generate<code>*.wasm/*.contract</code>files with<code>name section</code>section<a class="hash-link" href="#use-patracts-cargo-contract-to-generatewasmcontractfiles-withname-sectionsection" title="Direct link to heading">#</a></h2><p>Patract&#x27;s <code>cargo-contract</code> provides <code>-d/--debug</code> options. When the following command is executed,The generated <code>*.wasm/*.contract</code> file is consistent with parity&#x27;s official <code>cargo-contract</code> execution result.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo +nightly contract build</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When the following command is executed,The generated <code>*.wasm/*.contract</code> file is the <code>*.wasm/*.contract</code> file that is not optimized and carries the <code>name section</code> section. It is equivalent to the files generated in this way replace the files generated by the original generation logic.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cargo +nightly contract build --debug</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Note</strong> The size of the compiled product generated by this way is generally several hundred times the size of the original product. Therefore, the developer can pay attention to the size of the generated product to roughly determine the compiled product generated by which compilation method.</p><p>The example is as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> target/ink</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> -h</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-rw-r-- </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">.5M </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">æœˆ  </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain">:01 flipper.contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-rw-r-- </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">.1K </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">æœˆ  </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain">:34 flipper.contract.old</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-rw-r-- </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> root root 732K </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">æœˆ  </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain">:00 flipper.wasm</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-rw-r-- </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">.5K </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">æœˆ  </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain">:34 flipper.wasm.old</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw-rw-r-- </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> root root </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">.1K </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">æœˆ  </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain">:01 metadata.json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The file with <code>*.old</code> means it was generated by the parity version of <code>cargo-contract</code>( renamed after the first compilation), on the contrary, the file with the same name is from Patract&#x27;s <code>cargo-contract</code> with the addition of <code>-- The debug</code> command is generated. You can see that the new file is many times larger than the old file. And <code>metadata.json</code> is unchanged.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="wasm-backtrace-description"></a>Wasm Backtrace description<a class="hash-link" href="#wasm-backtrace-description" title="Direct link to heading">#</a></h2><p>To be completed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="experimental-functions"></a>Experimental functions<a class="hash-link" href="#experimental-functions" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="wasm-backtrace-print-line-number-only-wasmtime-is-supported"></a>Wasm Backtrace print line number (only Wasmtime is supported)<a class="hash-link" href="#wasm-backtrace-print-line-number-only-wasmtime-is-supported" title="Direct link to heading">#</a></h3><p>TODO: This part is not completed</p><p>Add <code>WASMTIME_BACKTRACE_DETAILS=1</code> when starting Europa or set this variable as an environment variable</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">WASMTIME_BACKTRACE_DETAILS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> europa --tmp</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># or use</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">WASMTIME_BACKTRACE_DETAILS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">europa --tmp </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># run europa in normal way</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then in the <code>wasm_error</code> section of Europa&#x27;s log, the line number in the original code corresponding to the crash stack will appear.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wasm_error: Error::Trap</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Trap </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        code: TrapCode::UnreachableCodeReached,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trace: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wasm trap: unreachable&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wasm backtrace:&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    0: 0x31b2 - &lt;unknown&gt;!core::panicking::panic::he000af669cfcac01&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    1: 0x3c8c - &lt;unknown&gt;!flipper::flippter::_::&lt;impl flipper::flippter::Flippter&gt;::flip::h12b84979a77ae484&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    2: 0x10fa - core::result::Result&lt;T,E&gt;::map_err::h576871030fe833d4&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;                    at /home/clearloop/.cargo/registry/src/github.com-1ecc6299db9ec823/å®˜æ–¹-scale-codec-2.0.1/src/codec.rs:1199:31&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    3: 0x10d6 - core::result::Result&lt;T,E&gt;::map_err::h576871030fe833d4&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;                    at /home/clearloop/.cargo/registry/src/github.com-1ecc6299db9ec823/å®˜æ–¹-scale-codec-2.0.1/src/codec.rs:1198&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    4: 0x3966 - &lt;unknown&gt;!&lt;flipper::flippter::_::_::__ink_MessageDispatchEnum as ink_lang::dispatcher::Execute&gt;::execute::{{closure}}::hf35b139aaf5fba3b&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    5: 0x3941 - &lt;unknown&gt;!ink_lang::dispatcher::execute_message_mut::hf62eb790d230d371&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    6: 0x3c12 - &lt;unknown&gt;!&lt;flipper::flippter::_::_::__ink_MessageDispatchEnum as ink_lang::dispatcher::Execute&gt;::execute::heae3e5bbfc02afa0&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    7: 0x3a7a - &lt;unknown&gt;!flipper::flippter::_::&lt;impl ink_lang::contract::DispatchUsingMode for flipper::flippter::Flippter&gt;::dispatch_using_mode::h8e0c4495e09cd910&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    8: 0x3ba3 - &lt;unknown&gt;!call&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;    9: 0xf704 - &lt;unknown&gt;!&lt;wasm function 638&gt;&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">,</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this backtrace log, some parts that can parse the line number will be appended with the line number corresponding to the function in the error stack at the end of that line,The example is as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">&quot;2: 0x10fa - core::result::Result&lt;T,E&gt;::map_err::h576871030fe833d4&quot;</span><span class="token plain">,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;                    at /home/clearloop/.cargo/registry/src/github.com-1ecc6299db9ec823/parity-scale-codec-2.0.1/src/codec.rs:1199:31&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>codec.rs:1199:31</code> part means that this frame in the error stack corresponds to <code>codec.rs</code>. The line number of the file is 1199 and the column number is 31. The remaining lines do not have line numbers due to insufficient parsing or because the code is generated by macros.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/edit/master/docs/europa/guides/backtrace.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-contracts-book/en/europa/guides/contract-log"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Europa contract execution log</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-contracts-book/en/europa/guides/debug-example"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Europa debugging example Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background-information" class="table-of-contents__link">Background Information</a></li><li><a href="#the-conditins-of-europa-can-print-out-wasm-backtrace" class="table-of-contents__link">The conditins of Europa can print out Wasm Backtrace</a></li><li><a href="#install-cargo-contract-under-patract-repository" class="table-of-contents__link">Install <code>cargo-contract</code> under Patract repository</a></li><li><a href="#use-patracts-cargo-contract-to-generatewasmcontractfiles-withname-sectionsection" class="table-of-contents__link">Use Patract&#39;s cargo-contract to generate<code>*.wasm/*.contract</code>files with<code>name section</code>section</a></li><li><a href="#wasm-backtrace-description" class="table-of-contents__link">Wasm Backtrace description</a></li><li><a href="#experimental-functions" class="table-of-contents__link">Experimental functions</a><ul><li><a href="#wasm-backtrace-print-line-number-only-wasmtime-is-supported" class="table-of-contents__link">Wasm Backtrace print line number (only Wasmtime is supported)</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/substrate-contracts-book/en/assets/js/runtime~main.63bea2d2.js"></script>
<script src="/substrate-contracts-book/en/assets/js/main.7f43b64a.js"></script>
</body>
</html>