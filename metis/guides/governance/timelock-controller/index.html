<!doctype html>
<html lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Timelock Controller | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/substrate-contracts-book/metis/guides/governance/timelock-controller"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Timelock Controller | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="Contract module which acts as a timelocked controller. When set as the"><meta data-react-helmet="true" property="og:description" content="Contract module which acts as a timelocked controller. When set as the"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-contracts-book/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/substrate-contracts-book/metis/guides/governance/timelock-controller"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/metis/guides/governance/timelock-controller" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/en/metis/guides/governance/timelock-controller" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/metis/guides/governance/timelock-controller" hreflang="x-default"><link rel="stylesheet" href="/substrate-contracts-book/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/substrate-contracts-book/assets/js/runtime~main.8e90fe49.js" as="script">
<link rel="preload" href="/substrate-contracts-book/assets/js/main.0dec8028.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-contracts-book/"><img src="/substrate-contracts-book/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-contracts-book/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>主页<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文</span></span></a><ul class="dropdown__menu"><li><a href="/substrate-contracts-book/metis/guides/governance/timelock-controller" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li><li><a href="/substrate-contracts-book/en/metis/guides/governance/timelock-controller" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">介绍</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/contracts/introduction">Substrate 合约书</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/contracts/overview">合约综述</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/contracts/model">合约模型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/contracts/language">合约语言</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/contracts/wasm_first_step">Wasm简要介绍</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Metis</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Get Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/intro/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/intro/motivation">Motivation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/intro/architecture">Architectures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/intro/differences">Metis vs OpenZeppelin</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/guides/imports">Use Metis components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/guides/macros">Marcos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/guides/extensions">Extending Metis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/metis/guides/hook">Hooks</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Access control</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Governance</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-contracts-book/metis/guides/governance/timelock-controller">Timelock Controller</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Security</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Tokens</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Tools</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Utilities</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Reports</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Timelock Controller</h1></header><p>Contract module which acts as a timelocked controller. When set as the
owner of an <code>Ownable</code> smart contract, it enforces a timelock on all
<code>enuser_caller_owner</code> maintenance operations. This gives time for users of the
controlled contract to exit before a potentially dangerous maintenance
operation is applied.</p><p>By default, this contract is self administered, meaning administration tasks
have to go through the timelock process. The proposer (resp executor) role
is in charge of proposing (resp executing) operations. A common use case is
to position this <code>TimelockController</code> as the owner of a smart contract, with
a multisig or a DAO as the sole proposer.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dependency"></a>Dependency<a class="hash-link" href="#dependency" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">metis_timelock_controller   = { git = &quot;https://github.com/patractlabs/metis&quot;, default-features = false }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="storage"></a>Storage<a class="hash-link" href="#storage" title="Direct link to heading">#</a></h2><p>The storages of timelock controller contains two variables.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Data&lt;E: Env&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// min delay for controller</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub min_delay: Lazy&lt;E::Timestamp&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub timestamps: StorageHashMap&lt;[u8; 32], E::Timestamp&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[import(timelock_controller, access_control)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct TimelockController {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timelock_controller: timelock_controller::Data&lt;TimelockController&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    access_control: access_control::Data&lt;TimelockController&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mutable-messages"></a>Mutable Messages<a class="hash-link" href="#mutable-messages" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="schedule"></a>schedule<a class="hash-link" href="#schedule" title="Direct link to heading">#</a></h3><p>Schedule an operation containing a single transaction.</p><p>Emits a <code>CallScheduled</code> event.</p><p>Requirements:</p><ul><li>the caller must have the &#x27;proposer&#x27; role.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn schedule(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target: E::AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value: E::Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        salt: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        delay: E::Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        access_control::Impl::ensure_caller_role(self, PROPOSER_ROLE);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let id = self.hash_operation(&amp;target, &amp;value, &amp;data, &amp;predecessor, &amp;salt);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self._schedule(id, delay);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.emit_event_call_scheduled(id, target, value, data, predecessor, delay);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cancel"></a>cancel<a class="hash-link" href="#cancel" title="Direct link to heading">#</a></h3><p>Cancel an operation.</p><p>Requirements:</p><ul><li>the caller must have the &#x27;proposer&#x27; role.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn cancel(&amp;mut self, id: [u8; 32]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        access_control::Impl::ensure_caller_role(self, PROPOSER_ROLE);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        assert!(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self.is_operation_pending(&amp;id),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;TimelockController: operation cannot be cancelled&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Storage::&lt;E, Data&lt;E&gt;&gt;::get_mut(self).timestamps.take(&amp;id);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.emit_event_cancelled(id);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="execute"></a>execute<a class="hash-link" href="#execute" title="Direct link to heading">#</a></h3><p>Execute an (ready) operation containing a single transaction.</p><p>Emits a <code>CallExecuted</code> event.</p><p>Requirements:</p><ul><li>the caller must have the &#x27;executor&#x27; role.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn execute(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target: E::AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value: E::Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        salt: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.ensure_only_role_or_open_role(EXECUTOR_ROLE);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let id = self.hash_operation(&amp;target, &amp;value, &amp;data, &amp;predecessor, &amp;salt);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self._before_call(predecessor);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self._call(id, target, value, data);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self._after_call(id);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="immutable-messages"></a>Immutable Messages<a class="hash-link" href="#immutable-messages" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="is_operation"></a>is_operation<a class="hash-link" href="#is_operation" title="Direct link to heading">#</a></h3><p>Returns whether an id correspond to a registered operation. This includes both Pending, Ready and Done operations.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn is_operation(&amp;self, id: &amp;[u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_timestamp(id) &gt; E::Timestamp::from(0_u8)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="is_operation_pending"></a>is_operation_pending<a class="hash-link" href="#is_operation_pending" title="Direct link to heading">#</a></h3><p>Returns whether an operation is pending or not.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn is_operation_pending(&amp;self, id: &amp;[u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_timestamp(id) &gt; E::Timestamp::from(_DONE_TIMESTAMP)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="is_operation_ready"></a>is_operation_ready<a class="hash-link" href="#is_operation_ready" title="Direct link to heading">#</a></h3><p>Returns whether an operation is ready or not.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn is_operation_ready(&amp;self, id: &amp;[u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let timestamp = self.get_timestamp(id);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        timestamp &gt; E::Timestamp::from(_DONE_TIMESTAMP)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;&amp; timestamp &lt;= Self::block_timestamp()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="is_operation_done"></a>is_operation_done<a class="hash-link" href="#is_operation_done" title="Direct link to heading">#</a></h3><p>Returns whether an operation is done or not.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn is_operation_done(&amp;self, id: &amp;[u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.get_timestamp(id) == E::Timestamp::from(_DONE_TIMESTAMP)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="get_timestamp"></a>get_timestamp<a class="hash-link" href="#get_timestamp" title="Direct link to heading">#</a></h3><p>Returns the timestamp at with an operation becomes ready (0 for unset operations, 1 for done operations).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn get_timestamp(&amp;self, id: &amp;[u8; 32]) -&gt; E::Timestamp {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        *Storage::&lt;E, Data&lt;E&gt;&gt;::get(self)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .timestamps</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .get(id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .unwrap_or(&amp;E::Timestamp::from(0_u8))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="get_min_delay"></a>get_min_delay<a class="hash-link" href="#get_min_delay" title="Direct link to heading">#</a></h3><p>Returns the minimum delay for an operation to become valid.</p><p>This value can be changed by executing an operation that calls <code>update_delay</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn get_min_delay(&amp;self) -&gt; E::Timestamp {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        *Storage::&lt;E, Data&lt;E&gt;&gt;::get(self).min_delay</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="hash_operation"></a>hash_operation<a class="hash-link" href="#hash_operation" title="Direct link to heading">#</a></h3><p>Returns the identifier of an operation containing a single transaction.</p><blockquote><p>NOTE: This <code>hash = Blake2x256(target + value + data + predecessor + salt)</code></p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn hash_operation(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target: &amp;E::AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value: &amp;E::Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        data: &amp;Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        predecessor: &amp;Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        salt: &amp;[u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ) -&gt; [u8; 32] {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // for target + value + data + predecessor + salt</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let mut hash_data: Vec&lt;u8&gt; = Vec::with_capacity(128 + data.len());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hash_data.append(&amp;mut target.encode());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hash_data.append(&amp;mut value.encode());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hash_data.append(&amp;mut data.clone());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hash_data.append(&amp;mut predecessor.encode());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for s in salt.into_iter() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            hash_data.push(s.clone());</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Self::hash_bytes::&lt;Blake2x256&gt;(&amp;hash_data)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="internal-functions"></a>Internal Functions<a class="hash-link" href="#internal-functions" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ensure_only_role_or_open_role"></a>ensure_only_role_or_open_role<a class="hash-link" href="#ensure_only_role_or_open_role" title="Direct link to heading">#</a></h3><p>To make a function callable only by a certain role. In
addition to checking the sender&#x27;s role, <code>AccountId::default()</code> &#x27;s role is also
considered. Granting a role to <code>AccountId::default()</code> is equivalent to enabling
this role for everyone.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn ensure_only_role_or_open_role(&amp;self, role: RoleId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if !access_control::Impl::has_role(self, role, E::AccountId::default()) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access_control::Impl::ensure_caller_role(self, role);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="events"></a>Events<a class="hash-link" href="#events" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="callscheduled"></a>CallScheduled<a class="hash-link" href="#callscheduled" title="Direct link to heading">#</a></h3><p>Emitted when a call is scheduled as part of operation <code>id</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct CallScheduled {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub id: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub delay: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="callexecuted"></a>CallExecuted<a class="hash-link" href="#callexecuted" title="Direct link to heading">#</a></h3><p>Emitted when a call is performed as part of operation <code>id</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct CallExecuted {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub id: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cancelled"></a>Cancelled<a class="hash-link" href="#cancelled" title="Direct link to heading">#</a></h3><p>Emitted when operation <code>id</code> is cancelled.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Cancelled {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub id: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mindelaychange"></a>MinDelayChange<a class="hash-link" href="#mindelaychange" title="Direct link to heading">#</a></h3><p>Emitted when the minimum delay for future operations is modified.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct MinDelayChange {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub old_duration: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub new_duration: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="usage-example"></a>Usage Example<a class="hash-link" href="#usage-example" title="Direct link to heading">#</a></h2><p>To make a timelock controller contract, we should import timelock_controller at first.</p><p>Note the <code>timelock_controller</code> component is based on <code>access_control</code> component:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[metis_lang::contract]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub mod contract {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use access_control::RoleId;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use ink_prelude::vec::Vec;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use metis_access_control as access_control;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use metis_lang::{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        import,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        metis,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use metis_timelock_controller as timelock_controller;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub use metis_timelock_controller::{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Error,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Result,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[import(timelock_controller, access_control)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct TimelockController {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        timelock_controller: timelock_controller::Data&lt;TimelockController&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        access_control: access_control::Data&lt;TimelockController&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // other logic for</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then implement the component:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[cfg(not(feature = &quot;ink-as-dependency&quot;))]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl timelock_controller::Impl&lt;TimelockController&gt; for TimelockController {}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then add the event for timelock_controller, we add the events for the <code>access_control</code> component also:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when a call is scheduled as part of operation `id`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct CallScheduled {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub id: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub delay: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when a call is performed as part of operation `id`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct CallExecuted {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub id: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when operation `id` is cancelled.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Cancelled {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub id: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when the minimum delay for future operations is modified.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(timelock_controller)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct MinDelayChange {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub old_duration: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub new_duration: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when `new_admin_role` is set as ``role``&#x27;s</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// admin role, replacing `previous_admin_role`</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(access_control)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct RoleAdminChanged {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub role: RoleId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub previous_admin_role: Option&lt;RoleId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub new_admin_role: RoleId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when `account` is granted `role`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// `sender` is the account that originated the contract call,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// an admin role bearer except when using {_setupRole}.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(access_control)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct RoleGranted {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub role: RoleId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub account: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub sender: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emitted when `account` is revoked `role`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// `sender` is the account that originated the contract call:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///   - if using `revoke_role`, it is the admin role bearer</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ///   - if using `renounce_role`, it is the role bearer (i.e. `account`)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(access_control)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct RoleRevoked {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub role: RoleId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub account: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub sender: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>impl the constructor for contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl TimelockController {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn new(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            min_delay: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            proposers: Vec&lt;AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            executors: Vec&lt;AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            let mut instance = Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                timelock_controller: timelock_controller::Data::new(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                access_control: access_control::Data::new(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::init(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &amp;mut instance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                min_delay,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                proposers,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                executors,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            );</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            instance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then implement the messages for contract.</p><blockquote><p>NOTE: the <code>execute</code> message should be <code>payable</code></p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl TimelockController{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns `true` if `account` has been granted `role`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn has_role(&amp;self, role: RoleId, account: AccountId) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access_control::Impl::has_role(self, role, account)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// @dev Returns the admin role that controls `role`. See {grant_role} and</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// {revoke_role}.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// To change a role&#x27;s admin, use {_setRoleAdmin}.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn get_role_admin(&amp;self, role: RoleId) -&gt; Option&lt;RoleId&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access_control::Impl::get_role_admin(self, role)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// @dev Grants `role` to `account`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// If `account` had not been already granted `role`, emits a {RoleGranted}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// event.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Requirements:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// - the caller must have ``role``&#x27;s admin role.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn grant_role(&amp;mut self, role: RoleId, account: AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access_control::Impl::grant_role(self, role, account)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// @dev Revokes `role` from `account`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// If `account` had been granted `role`, emits a {RoleRevoked} event.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Requirements:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// - the caller must have ``role``&#x27;s admin role.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn revoke_role(&amp;mut self, role: RoleId, account: AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access_control::Impl::revoke_role(self, role, account)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// @dev Revokes `role` from the calling account.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Roles are often managed via {grant_role} and {revoke_role}: this function&#x27;s</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// purpose is to provide a mechanism for accounts to lose their privileges</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// if they are compromised (such as when a trusted device is misplaced).</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// If the calling account had been granted `role`, emits a {RoleRevoked}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// event.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Requirements:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// - the caller must be `account`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn renounce_role(&amp;mut self, role: RoleId, account: AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            access_control::Impl::renounce_role(self, role, account)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns whether an id correspond to a registered operation. This</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// includes both Pending, Ready and Done operations.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn is_operation(&amp;self, id: [u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::is_operation(self, &amp;id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns whether an operation is pending or not.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn is_operation_pending(&amp;self, id: [u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::is_operation_pending(self, &amp;id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns whether an operation is ready or not.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn is_operation_ready(&amp;self, id: [u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::is_operation_ready(self, &amp;id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns whether an operation is done or not.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn is_operation_done(&amp;self, id: [u8; 32]) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::is_operation_done(self, &amp;id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the timestamp at with an operation becomes ready (0 for</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// unset operations, 1 for done operations).</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn get_timestamp(&amp;self, id: [u8; 32]) -&gt; Timestamp {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::get_timestamp(self, &amp;id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the minimum delay for an operation to become valid.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// This value can be changed by executing an operation that calls `updateDelay`.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn get_min_delay(&amp;self) -&gt; Timestamp {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::get_min_delay(self)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Returns the identifier of an operation containing a single</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// transaction.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn hash_operation(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            salt: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; [u8; 32] {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::hash_operation(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &amp;target,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &amp;value,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &amp;data,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &amp;predecessor,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &amp;salt,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Schedule an operation containing a single transaction.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Emits a `CallScheduled` event.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Requirements:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// - the caller must have the &#x27;proposer&#x27; role.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn schedule(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            salt: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            delay: Timestamp,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::schedule(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                target,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                value,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                data,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                predecessor,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                salt,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                delay,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Cancel an operation.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Requirements:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// - the caller must have the &#x27;proposer&#x27; role.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn cancel(&amp;mut self, id: [u8; 32]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::cancel(self, id)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Execute an (ready) operation containing a single transaction.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Emits a `CallExecuted` event.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Requirements:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ///</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// - the caller must have the &#x27;executor&#x27; role.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, payable)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn execute(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            target: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            value: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            predecessor: Option&lt;[u8; 32]&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            salt: [u8; 32],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timelock_controller::Impl::execute(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                target,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                value,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                data,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                predecessor,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                salt,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the end, we can add some other messages.</p><p>the caller to call need impl the <code>on_call</code> message:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl Receiver {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, payable)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn on_call(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _operator: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            _data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            unimplemented!()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>like this, NOTE the <code>on_call</code> should be payable:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, payable)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn on_call(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            operator: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            data: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // value to transferred_balance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            let value = Self::env().transferred_balance();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // emit events</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Self::env().emit_event(CallReceived {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                operator,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                value,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                data,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // if return false should be error.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            true</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/metis/guides/governance/timelock-controller.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-contracts-book/metis/guides/access-control/access-control-enumerable"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Access Control Enumerable</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-contracts-book/metis/guides/security/pausable"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pausable »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dependency" class="table-of-contents__link">Dependency</a></li><li><a href="#storage" class="table-of-contents__link">Storage</a></li><li><a href="#mutable-messages" class="table-of-contents__link">Mutable Messages</a><ul><li><a href="#schedule" class="table-of-contents__link">schedule</a></li><li><a href="#cancel" class="table-of-contents__link">cancel</a></li><li><a href="#execute" class="table-of-contents__link">execute</a></li></ul></li><li><a href="#immutable-messages" class="table-of-contents__link">Immutable Messages</a><ul><li><a href="#is_operation" class="table-of-contents__link">is_operation</a></li><li><a href="#is_operation_pending" class="table-of-contents__link">is_operation_pending</a></li><li><a href="#is_operation_ready" class="table-of-contents__link">is_operation_ready</a></li><li><a href="#is_operation_done" class="table-of-contents__link">is_operation_done</a></li><li><a href="#get_timestamp" class="table-of-contents__link">get_timestamp</a></li><li><a href="#get_min_delay" class="table-of-contents__link">get_min_delay</a></li><li><a href="#hash_operation" class="table-of-contents__link">hash_operation</a></li></ul></li><li><a href="#internal-functions" class="table-of-contents__link">Internal Functions</a><ul><li><a href="#ensure_only_role_or_open_role" class="table-of-contents__link">ensure_only_role_or_open_role</a></li></ul></li><li><a href="#events" class="table-of-contents__link">Events</a><ul><li><a href="#callscheduled" class="table-of-contents__link">CallScheduled</a></li><li><a href="#callexecuted" class="table-of-contents__link">CallExecuted</a></li><li><a href="#cancelled" class="table-of-contents__link">Cancelled</a></li><li><a href="#mindelaychange" class="table-of-contents__link">MinDelayChange</a></li></ul></li><li><a href="#usage-example" class="table-of-contents__link">Usage Example</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/substrate-contracts-book/assets/js/runtime~main.8e90fe49.js"></script>
<script src="/substrate-contracts-book/assets/js/main.0dec8028.js"></script>
</body>
</html>