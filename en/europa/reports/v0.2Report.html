<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Report for Europa v0.2</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/substrate-contracts-book/favicon.ico">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta content="https://www.patract.io/social-preview.png" property="og:image">
    
    <link rel="preload" href="/substrate-contracts-book/assets/css/0.styles.7869a774.css" as="style"><link rel="preload" href="/substrate-contracts-book/assets/js/app.c73dd8d7.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/3.7c35afa4.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/1.293685b3.js" as="script"><link rel="preload" href="/substrate-contracts-book/assets/js/78.6bde6f3a.js" as="script"><link rel="prefetch" href="/substrate-contracts-book/assets/js/10.f560e2ba.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/100.0153f1c5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/101.1fdd1f03.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/102.3cfa4f1e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/103.76f65bdf.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/104.f0d72cbc.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/105.112a1cd8.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/106.1587302e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/107.658c4109.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/108.e3aee840.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/109.7d1d01d0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/11.ff45929c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/110.cc5d0673.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/111.5230de15.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/112.be290b70.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/113.e6e0ad48.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/114.c37ff266.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/115.8552a903.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/116.cb73d6de.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/117.e0e60626.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/118.a14d9fe0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/119.1bc63761.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/12.7661745e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/120.41587792.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/121.44b6595d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/122.8e30372c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/123.53813b86.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/124.02a91f13.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/125.e61300d0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/126.770ccb60.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/127.3bbbb6e4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/128.7ed5505f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/129.a1e4dc04.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/13.77735261.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/130.efdb9c18.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/131.6fa605e5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/132.4f126424.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/133.4ff0e1e5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/134.d09e2953.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/135.208b9d82.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/136.74896a93.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/137.1ba491ec.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/138.6f84c02f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/139.8eeb2c61.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/14.0d64657c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/140.af10fbaf.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/141.aa458f1f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/142.6aff3f2e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/143.d40b2522.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/144.b6e24051.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/145.4b26eadc.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/146.d8b0a1a1.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/147.8d418273.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/148.2b50e5ac.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/149.114ebd09.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/15.77cb4796.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/150.ce1798e7.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/151.e1b0a0ff.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/152.01b09bfa.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/153.7f7de779.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/154.01b7c122.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/155.90eeccf8.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/156.efdc4919.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/157.0bd69c6c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/158.9936a0e3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/159.e6f438ff.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/16.90cda06c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/160.9107cb77.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/161.bf98d120.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/162.033c7342.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/163.c2e5c6b8.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/164.e66750fb.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/165.168d0f1b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/166.584abbda.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/167.48dadc66.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/168.307ba30d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/169.1409e56d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/17.58bc9af7.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/170.098dbd51.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/171.7c988fba.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/172.d6d25555.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/173.6354c341.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/174.bf0cdad4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/175.158a0cfd.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/176.93d22670.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/177.1ee20509.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/178.6132e925.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/179.54fe2151.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/18.176e469c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/180.606e3aed.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/181.b334594f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/182.e6382439.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/183.871a2d48.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/184.a505e7c5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/185.ce07f4cd.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/186.32bf87d1.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/187.bd2a0658.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/188.3cd9d8bd.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/189.8faf945d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/19.0a0963f9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/190.9a9f6e09.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/191.f4b8d995.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/192.7e9e33a7.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/193.065975f6.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/194.5a2221a5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/195.68da7f10.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/196.85e6d2db.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/197.c58c7769.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/20.b3aa261b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/21.6dcc6bd9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/22.23beffe4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/23.bcf6fd6b.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/24.82bd5bb7.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/25.d7485964.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/26.d6ba03d4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/27.59b07548.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/28.1c175f18.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/29.ed7481c9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/30.548c38ca.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/31.868ea504.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/32.3b2de66a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/33.9f45019d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/34.ab7d0792.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/35.f698ffd2.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/36.cbced007.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/37.27161b4f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/38.fb186cce.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/39.cfed4e29.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/4.e9bde0d3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/40.808c28db.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/41.3403c3a3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/42.73c3b656.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/43.4c43aac1.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/44.3584f9fc.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/45.cdebf294.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/46.654ba434.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/47.95c2825d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/48.a400ea64.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/49.ac93bc37.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/5.271970b3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/50.47b55d1a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/51.06054c5e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/52.0f9a6a91.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/53.a73076f6.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/54.e0eeacb3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/55.793777c2.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/56.7905359e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/57.006b682e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/58.b72084bb.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/59.e66054a1.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/6.1380e490.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/60.86ebaf5a.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/61.f4f61013.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/62.59762ee0.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/63.5ae468f9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/64.232b4447.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/65.e77ea092.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/66.6c7580d3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/67.0886e149.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/68.9d055d69.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/69.d8da1686.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/7.14678977.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/70.75e3ce43.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/71.5be06d5f.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/72.c4d23bfc.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/73.5e924bea.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/74.3c7635ac.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/75.280dd380.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/76.80c841c4.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/77.40b985cc.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/79.ecc021f3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/8.599425f6.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/80.fbbb0add.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/81.ee0758d6.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/82.eba646ec.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/83.c5dcad7d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/84.b9a61f11.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/85.8227c486.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/86.2e717c4e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/87.d48572e3.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/88.14b3ad70.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/89.777a3bb2.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/9.2035d6c9.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/90.24b6a32d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/91.ed9e9e96.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/92.0320c66d.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/93.2800c95e.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/94.65591368.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/95.16c6aac6.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/96.3d21803c.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/97.bcc392bb.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/98.f0db5ce5.js"><link rel="prefetch" href="/substrate-contracts-book/assets/js/99.a1283621.js">
    <link rel="stylesheet" href="/substrate-contracts-book/assets/css/0.styles.7869a774.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc></h3> <p class="description" data-v-4e82dffc data-v-4e82dffc></p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>patractlabs</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/substrate-contracts-book/en/" class="home-link router-link-active"><img src="/substrate-contracts-book/logo.svg" alt="" class="logo"> <!----></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://patract.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-home"></i>
  Official Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-blog"></i>
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/substrate-contracts-book/en/" class="nav-link"><i class="undefined"></i>
  Doc
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/substrate-contracts-book/europa/reports/v0.2Report.html" class="nav-link"><i class="undefined"></i>
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="undefined"></i>
  English
</a></li></ul></div></div> <a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><!----> <h3 class="name" data-v-828910c6>
    patractlabs
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>188</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>0</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="https://patract.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-home"></i>
  Official Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-blog"></i>
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/substrate-contracts-book/en/" class="nav-link"><i class="undefined"></i>
  Doc
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/substrate-contracts-book/europa/reports/v0.2Report.html" class="nav-link"><i class="undefined"></i>
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="undefined"></i>
  English
</a></li></ul></div></div> <a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><a href="/substrate-contracts-book/en/" aria-current="page" class="sidebar-link">Summary</a></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/introduction" class="sidebar-heading clickable"><span>Introduction</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/contracts/overview.html" class="sidebar-link">Contract overview</a></li><li><a href="/substrate-contracts-book/en/contracts/model.html" class="sidebar-link">Contract model</a></li><li><a href="/substrate-contracts-book/en/contracts/language.html" class="sidebar-link">Contract language</a></li><li><a href="/substrate-contracts-book/en/contracts/wasm_first_step.html" class="sidebar-link">Brief introduction of Wasm</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/ink/introduction" class="sidebar-heading clickable"><span>ink!</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/ink/tutorial.html" class="sidebar-link">ink! tutorial</a></li><li><a href="/substrate-contracts-book/en/ink/framework.html" class="sidebar-link">ink! Framework</a></li><li><a href="/substrate-contracts-book/en/ink/edsl-basic.html" class="sidebar-link">ink! eDSL basic elements</a></li><li><a href="/substrate-contracts-book/en/ink/call-contracts.html" class="sidebar-link">Cross-call for ink!</a></li><li><a href="/substrate-contracts-book/en/ink/ink-solidity.html" class="sidebar-link">Compare ink! and solidity</a></li><li><a href="/substrate-contracts-book/en/ink/cargo-contract.html" class="sidebar-link">cargo-contract</a></li><li><a href="/substrate-contracts-book/en/ink/trap.html" class="sidebar-link">Current problem for ink!</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/ask/introduction" class="sidebar-heading clickable"><span>ask!</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/ask/tutorial.html" class="sidebar-link">Getting Started</a></li><li><a href="/substrate-contracts-book/en/ask/design.html" class="sidebar-link">Design</a></li><li><a href="/substrate-contracts-book/en/ask/basics.html" class="sidebar-link">Basics</a></li><li><a href="/substrate-contracts-book/en/ask/decorators.html" class="sidebar-link">Ask! decorator</a></li><li><a href="/substrate-contracts-book/en/ask/storage-data-structure.html" class="sidebar-link">Storage</a></li><li><a href="/substrate-contracts-book/en/ask/ask-cli.html" class="sidebar-link">Ask-cli</a></li><li><a href="/substrate-contracts-book/en/ask/ask-vs-ink.html" class="sidebar-link">Ask! and ink! Comparison of characteristics</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/ask/reports" class="sidebar-heading clickable"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/ask/reports/v0.1Report.html" class="sidebar-link">Report for Ask! v0.1</a></li><li><a href="/substrate-contracts-book/en/ask/reports/v0.2Report.html" class="sidebar-link">Report for Ask! v0.2</a></li></ul></section></li></ul></section></li><li><a href="/substrate-contracts-book/en/solang/introduction.html" class="sidebar-link">Solang</a></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/redspot/introduction" class="sidebar-heading clickable"><span>Redspot</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/redspot/tutorial.html" class="sidebar-link">Redspot tutorial</a></li><li><a href="/substrate-contracts-book/en/redspot/overview.html" class="sidebar-link">Introduction</a></li><li><a href="/substrate-contracts-book/en/redspot/configuration.html" class="sidebar-link">Configuration information</a></li><li><a href="/substrate-contracts-book/en/redspot/tasks.html" class="sidebar-link">Tasks</a></li><li><a href="/substrate-contracts-book/en/redspot/runtime-environment.html" class="sidebar-link">Runtime Environment</a></li><li><a href="/substrate-contracts-book/en/redspot/console.html" class="sidebar-link">Console</a></li><li><a href="/substrate-contracts-book/en/redspot/q-and-a.html" class="sidebar-link">Common problem</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/redspot/plugin" class="sidebar-heading clickable"><span>Plugin</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-decimals.html" class="sidebar-link">@redspot_decimals plug-in</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-known-types.html" class="sidebar-link">@redspot_known-types plug-in</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-chai.html" class="sidebar-link">@redspot_chai  plug-in</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-gas-reporter.html" class="sidebar-link">@redspot_gas-reporter plug-in</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-patract.html" class="sidebar-link">@redspot_patract plug-in</a></li><li><a href="/substrate-contracts-book/en/redspot/plugin/redspot-explorer.html" class="sidebar-link">@redspot_explorer plug-in</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/redspot/reports" class="sidebar-heading clickable"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/redspot/reports/v0.1Report.html" class="sidebar-link">Report for Redspot v0.1</a></li><li><a href="/substrate-contracts-book/en/redspot/reports/v0.2Report.html" class="sidebar-link">Report for Redspot v0.2</a></li><li><a href="/substrate-contracts-book/en/redspot/reports/v0.3Report.html" class="sidebar-link">Report for Redspot v0.3</a></li><li><a href="/substrate-contracts-book/en/redspot/reports/v0.4Report.html" class="sidebar-link">Report for Redspot v0.4</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/europa/introduction" class="sidebar-heading clickable"><span>Europa</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/europa/tutorial.html" class="sidebar-link">Europa tutorial</a></li><li><a href="/substrate-contracts-book/en/europa/execution_info.html" class="sidebar-link">Europa contract execution log analysis</a></li><li><a href="/substrate-contracts-book/en/europa/sample.html" class="sidebar-link">Europa debugging example</a></li><li><a href="/substrate-contracts-book/en/europa/wasm_executor.html" class="sidebar-link">Europa Wasm executor</a></li><li><a href="/substrate-contracts-book/en/europa/wasm_backtrace.html" class="sidebar-link">Europa's Wasm Backtrace</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/europa/reports" class="sidebar-heading clickable router-link-active open"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/europa/reports/v0.1Report.html" class="sidebar-link">Report for Europa v0.1</a></li><li><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html" aria-current="page" class="active sidebar-link">Report for Europa v0.2</a></li><li><a href="/substrate-contracts-book/en/europa/reports/v0.3Report.html" class="sidebar-link">Report for Europa v0.3</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/zkmega/introduction" class="sidebar-heading clickable"><span>zkMega</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/zkmega/tutorial.html" class="sidebar-link">tutorial</a></li><li><a href="/substrate-contracts-book/en/zkmega/contract.html" class="sidebar-link">Contract</a></li><li><a href="/substrate-contracts-book/en/zkmega/example.html" class="sidebar-link">Example</a></li><li><a href="/substrate-contracts-book/en/zkmega/benchmark.html" class="sidebar-link">Benchmark</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/zkmega/reports" class="sidebar-heading clickable"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/zkmega/reports/v0.1Report.html" class="sidebar-link">Report for zkMega v0.1（original Megaclite v0.1 )</a></li><li><a href="/substrate-contracts-book/en/zkmega/reports/v0.2Report.html" class="sidebar-link">Report for zkMega v0.2（original Megaclite v0.2 )</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/himalia/introduction" class="sidebar-heading clickable"><span>Himalia</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/himalia/tutorial.html" class="sidebar-link">tutorial</a></li><li><a href="/substrate-contracts-book/en/himalia/go-patract.html" class="sidebar-link">go-patract</a></li><li><a href="/substrate-contracts-book/en/himalia/py-patract.html" class="sidebar-link">py-patract</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/himalia/reports" class="sidebar-heading clickable"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/himalia/reports/v0.1Report.html" class="sidebar-link">Report for  Himalia v0.1 &amp; v0.2</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/metis/introduction" class="sidebar-heading clickable"><span>Metis</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/metis/tokens.html" class="sidebar-link">ERC20</a></li><li><a href="/substrate-contracts-book/en/metis/access-control.html" class="sidebar-link">Access Control</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/metis/reports" class="sidebar-heading clickable"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/metis/reports/M1Report.html" class="sidebar-link">Patract's proposal about Metis (ink! and Ask! Standard Library)</a></li></ul></section></li></ul></section></li><li><a href="/substrate-contracts-book/en/carpo/introduction.html" class="sidebar-link">Carpo</a></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/elara/introduction" class="sidebar-heading clickable"><span>Elara</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/elara/tutorial.html" class="sidebar-link">Tutorial</a></li><li><a href="/substrate-contracts-book/en/elara/design.html" class="sidebar-link">Design Brief</a></li><li><a href="/substrate-contracts-book/en/elara/API.html" class="sidebar-link">API access</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/substrate-contracts-book/en/elara/reports" class="sidebar-heading clickable"><span>Report</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/elara/reports/v0.1Report.html" class="sidebar-link">Report for Elara v0.1</a></li><li><a href="/substrate-contracts-book/en/elara/reports/v0.2Report.html" class="sidebar-link">Report for Elara v0.2</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/jupiter/introduction" class="sidebar-heading clickable"><span>Jupiter</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/jupiter/quickstart.html" class="sidebar-link">编译</a></li><li><a href="/substrate-contracts-book/jupiter/network.html" class="sidebar-link">Jupiter 网络</a></li><li><a href="/substrate-contracts-book/jupiter/contract.html" class="sidebar-link">合约</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/substrate-contracts-book/en/patra-store/introduction" class="sidebar-heading clickable"><span>PatraStore</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/substrate-contracts-book/en/patra-store/overview.html" class="sidebar-link">Overview</a></li><li><a href="/substrate-contracts-book/en/patra-store/getting-starter.html" class="sidebar-link">Getting started</a></li><li><a href="/substrate-contracts-book/en/patra-store/publish-dapps.html" class="sidebar-link">Publish DApp</a></li></ul></section></li><li><a href="/substrate-contracts-book/en/patract/introduction.html" class="sidebar-link">Patract</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc></h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>patractlabs</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Report for Europa v0.2</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>patractlabs</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="report-for-europa-v0-2"><a href="#report-for-europa-v0-2" class="header-anchor">#</a> Report for Europa v0.2</h2> <p>Six weeks ago, Patract Hub (https://patract.io) applied a <a href="https://polkadot.polkassembly.io/treasury/27" target="_blank" rel="noopener noreferrer">Treasury Proposal #27<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for Europa v0.2 , and now we have finished all the development work in (https://github.com/patractlabs/Europa). Europa is kind of another implementation for <a href="https://github.com/paritytech/substrate/tree/master/client" target="_blank" rel="noopener noreferrer">Substrate client<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in our design. We know that the runtime of a blockchain is the business logic that defines its behavior, and the Substrate runtime need to run by an executor and environment. So that we design the executor and environment more like a &quot;sandbox&quot; to run a Substrate runtime.</p> <p>In v0.2, the primary target is to modify <code>Pallet Contracts</code> in runtime to provide more detailed debugging information, including contract execution process information (in <code>Pallet Contracts</code> layer) and WASM execution information (in WASMI execution layer).</p> <h3 id="recap-of-europa-s-future-plan"><a href="#recap-of-europa-s-future-plan" class="header-anchor">#</a> Recap of Europa's future plan</h3> <ul><li><s>v0.1: Have an independent runtime environment to facilitate more subsequent expansion directions.</s></li> <li><s>v0.2: Modify at FRAME Contracts pallet level to provide more information</s></li> <li>v0.3: Improve the development experience, strengthen collaboration with other tools, and extend the sandbox to be compatible with other runtime modules。</li></ul> <h3 id="recap-of-verification-for-europa-v0-2"><a href="#recap-of-verification-for-europa-v0-2" class="header-anchor">#</a> Recap of verification for Europa v0.2:</h3> <blockquote><ul><li>Construct incorrect contracts and execute logs printing to determine whether it meets expectations</li> <li>Display the call statistics of the <code>define_env!</code> interface during contract execution</li> <li>Execute the log printing function, provide formatted printing examples of different data, and judge whether it meets expectations</li> <li>Construct a contract that crashes under different conditions and record the log after execution. Then judge whether the backtrace information of the contract execution is completely printed, and check whether it matches the actual execution of the collapsed contract.</li></ul></blockquote> <h2 id="_1-design"><a href="#_1-design" class="header-anchor">#</a> 1.Design</h2> <p>In 0.2, the debugging information function of the upgrade contract module is divided into three parts of modification:</p> <ul><li>Modification on the <code>Pallet Contracts</code> layer: By adding trace during the execution of the contract by <code>Pallet Contracts</code>, the information in the contract layer is recorded, and the calling level of the contract is recorded. On the other hand, the error message of calling WASM execution is improved.</li> <li>Modification on the <code>wasmi</code> layer: We have provided the backtrace function of recording wasm execution for <code>wasmi</code>, and provided support for <code>parity-wasm</code>, <code>pwasm-utils</code>, and <code>cargo-contract</code> during wasm processing of the contract contains the function of the name section.</li> <li>Contract logging function: Use the function of <code>ChainExtensions</code> to realize the library for printing the <code>log</code> in the contract.</li></ul> <p>In the current <code>Pallet Contracts</code>, when an error occurs in the execution of <code>wasmi</code>, and in the <a href="https://webassembly.github.io/spec/core/exec/runtime.html#function-instances" target="_blank" rel="noopener noreferrer">host_function<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> call of <code>Pallet Contracts</code> during the execution of wasmi, it will be displayed as a <code>ContractTrap</code> error externally. In this situation, it is difficult for developers to locate the cause of the error. Only from this information, it is impossible to tell whether the problem is the contract itself, <code>ink!</code>, or <code>Pallet Contracts</code>. Therefore, the rich information that Europa v0.2 can provide allows developers to directly locate the cause of the problem.</p> <h3 id="_1-1-on-pallet-contracts-layer"><a href="#_1-1-on-pallet-contracts-layer" class="header-anchor">#</a> 1.1 on <code>Pallet Contracts</code> layer</h3> <p>During the contract debugging process, Europa believes that developers need:</p> <ol><li>Rich error information: WASM records the error information during the entire execution process, including WASM executor errors and host_function errors. The backtrace information of wasmi will be unified with the error information here.</li> <li>Execution in the debugging process: The main modification information of <code>Pallet Contracts</code>, the &quot;contract stack&quot; is used to record the process of contract calling contract, and any information that can assist debugging during the execution of this layer of contract, such as the situation of calling the host_function, selector, and calling contract parameters, etc.</li></ol> <p>Therefore, in response to such needs, Europa made the following designs and modifications:</p> <h4 id="_1-1-1-rich-error-information"><a href="#_1-1-1-rich-error-information" class="header-anchor">#</a> 1.1.1 rich error information</h4> <p><strong>1.error on the wasm executor layer：</strong></p> <p>Europa designed our own <code>ep-sandbox</code> to replace the original <code>sp-sandbox</code> used by <code>Pallet Contracts</code>, and modified <code>ep_sandbox::Error</code></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">patract_wasmi<span class="token punctuation">::</span></span><span class="token class-name">Error</span> <span class="token keyword">as</span> <span class="token class-name">WasmiError</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Error</span> <span class="token punctuation">{</span>
<span class="token class-name">Module</span><span class="token punctuation">(</span><span class="token class-name">WasmiError</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token class-name">OutOfBounds</span><span class="token punctuation">,</span>
<span class="token class-name">Execution</span><span class="token punctuation">,</span>
<span class="token class-name">WasmiExecution</span><span class="token punctuation">(</span><span class="token class-name">WasmiError</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Module(WasmiError)</code> carries the original error information of the WASM layer, and the <code>to_execution_result</code> in <code>frame/contracts/src/wasm/runtime.rs</code> is converted to <code>String</code> to throw an error message.</p> <p>Europa's own <code>ep-sandbox</code> only has the <code>std</code> version (because Europa has removed all WASM parts, there is no need for <code>ep-sandbox</code> to support <code>no-std</code>), so in the future, **<code>ep-sandbox</code> can be replaced with different wasm executors to support running tests of different wasm executors, and replaced with wasm executors that support debugging and other features. **</p> <p>Currently <code>ep-sandbox</code> uses a forked version of <code>wasmi</code> as the executor, so the error it throws is <code>WasmiError</code>. See the next chapter for errors in<code>wasmi</code>.</p> <p><strong>2.error of host_functions:</strong></p> <p>The host function execution error will cause Trap, and will record <code>TrapReason</code>. No modification to the data structure, just record.</p> <h4 id="_1-1-2-execution-during-debugging"><a href="#_1-1-2-execution-during-debugging" class="header-anchor">#</a> 1.1.2 Execution during debugging</h4> <p>The Europa forked version of <code>Pallet Contracts</code> has designed an object to record any information that can help debugging during contract execution:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">/// Record the contract execution context.</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">NestedRuntime</span> <span class="token punctuation">{</span>
	<span class="token comment">/// Current depth</span>
    depth<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
	<span class="token comment">/// The current contract execute result</span>
	ext_result<span class="token punctuation">:</span> <span class="token class-name">ExecResult</span><span class="token punctuation">,</span>
	<span class="token comment">/// The value in sandbox successful result</span>
	sandbox_result_ok<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">ReturnValue</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token comment">/// Who call the current contract</span>
    caller<span class="token punctuation">:</span> <span class="token class-name">AccountId32</span><span class="token punctuation">,</span>
	<span class="token comment">/// The account of the current contract</span>
    self_account<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">AccountId32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token comment">/// The input selector</span>
    selector<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">HexVec</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token comment">/// The input arguments</span>
    args<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">HexVec</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token comment">/// The value in call or the endowment in instantiate</span>
    value<span class="token punctuation">:</span> <span class="token keyword">u128</span><span class="token punctuation">,</span>
	<span class="token comment">/// The gas limit when this contract is called</span>
    gas_limit<span class="token punctuation">:</span> <span class="token class-name">Gas</span><span class="token punctuation">,</span>
	<span class="token comment">/// The gas left when this contract return</span>
    gas_left<span class="token punctuation">:</span> <span class="token class-name">Gas</span><span class="token punctuation">,</span>
	<span class="token comment">/// The host function call stack</span>
    env_trace<span class="token punctuation">:</span> <span class="token class-name">EnvTraceList</span><span class="token punctuation">,</span>
	<span class="token comment">/// The error in wasm</span>
    wasm_error<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">WasmErrorWrapper</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token comment">/// The trap in host function execution</span>
    trap_reason<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">TrapReason</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token comment">/// Nested contract execution context</span>
    nest<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">NestedRuntime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the model of <code>Pallet Contracts</code>, a contract calling another contract is in the &quot;contract stack&quot; model, so <code>NestedRuntime</code> will track the execution process of the entire contract stack, and use the property of <code>nest</code> to store a list of <code>NestedRuntime</code> to represent other contracts the the contract called.</p> <p>In the process of executing a contract by <code>Pallet Contracts</code>, Europa records the relevant information in the execution process in the structure of <code>NestedRuntime</code> in the form of a bypass, and will print the <code>NestedRuntime</code> to the log (show the case later) in a certain format after the contract call ends. Contract developers can analyze the information printed by <code>NestedRuntime</code> to obtain various detailed information during the execution of the contract, which can be used in various situations:</p> <ol><li>help to locate where the error occurs, including the following situations:
<ol><li><code>Pallet Contracts</code> layer</li> <li><code>ink!</code> layer</li> <li>The specific position in the contract layer</li> <li>Locate which level of the contract is when a contract calling another contract</li></ol></li> <li>Analyze the information during the execution of the contract at this timing:
<ol><li>Analyze the consumption of gas execution</li> <li>Analyze the call of <code>get_storage</code> and <code>set_storage</code>, help reconstruct the contract code and analyze the demand of <code>rent</code></li> <li>According to <code>selector</code>, <code>args</code> and <code>value</code>, analyze and locate whether the transaction parameters of the third-party SDK are legal.</li> <li>Analyze the execution path of the contract and adjust the contract based on the <code>nest</code> information and combined with the <code>seal_call</code> information.</li> <li>etc.</li></ol></li></ol> <p>The process of recording <code>Pallet Contracts</code> executing contract to <code>NestEdRuntime</code> is relatively fine-grained.
The process of logging the information of the execution contract of <code>Pallet Contracts</code> to <code>NestEdRuntime</code> is relatively fine-grained. Take <code>seal_call</code> in <code>define_env!</code> as an example:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">SealCall</span> <span class="token punctuation">{</span>
    callee<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">HexVec</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    gas<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">u128</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    input<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">HexVec</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">HexVec</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The attributes are basically <code>Option&lt;&gt;</code>. For example, before calling the contract, the <code>input</code> will be set to <code>Some</code>, and the return value will be set after the calling contract is normal. If there is an error in the calling contract, then <code>output</code> will remain <code>None</code>. Therefore, if <code>input</code> is <code>Some</code> and <code>output</code> is <code>None</code>, it means that there is a problem with the called contract during the process of calling the contract.</p> <p>The current information of <code>NestedRuntime</code> is only printed in the log. <strong>In the future, <code>NestedRuntime</code> will be stored locally and provide corresponding RPC for external access</strong>. Therefore, in the future, third-party applications can obtain <code>NestedRuntime</code> for further processing. For example, in our <code>Redspot</code>, a plug-in can be designed to generate a contract call another contract topology based on the information of <code>NestedRuntime</code>, and a visual contract call path can be generated on the web wallet interface, etc.</p> <h3 id="_1-2-on-wasmi-layer"><a href="#_1-2-on-wasmi-layer" class="header-anchor">#</a> 1.2 on <code>wasmi</code> layer</h3> <p>We forked wasmi and integrated it into <code>ep-sandbox</code>. Forked <code>Pallet Contracts</code> can obtain the error information of forked <code>wasmi</code> through <code>ep-sandbox</code>, including the backtrace information of <code>wasmi</code>.</p> <p>If you need to make <code>wasmi</code> can retain the backtrace information during execution, you need to have the following functions:</p> <ol><li>The &quot;name section&quot; section is required in the WASM source file (see <a href="https://webassembly.github.io/spec/core/appendix/custom.html#name-section" target="_blank" rel="noopener noreferrer">the specification of name section)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</li> <li>Keep the &quot;name section&quot; information in the process of checking the contract by <code>Pallet Contracts</code> and still have a corresponding relationship with the wasm source file after the process.</li> <li>During the execution of <code>wasmi</code>, the execution stack needs to be preserved with the key information of the functions. At the same time, the &quot;name section&quot; needs to be parsed and correspond to the function information reserved by the <code>wasmi</code> execution stack.</li></ol> <p>The changes to 2 involve <code>cargo-build</code> and <code>parity-wasm</code>, while the changes to 1 and 3 are mainly in the forked <code>wasmi</code>, and a small part involves <code>pwasm-utils</code>.</p> <h4 id="_1-2-1-submitted-wasm-files-contains-debug-info-from-name-section"><a href="#_1-2-1-submitted-wasm-files-contains-debug-info-from-name-section" class="header-anchor">#</a> 1.2.1 Submitted WASM files contains debug info from &quot;name section&quot;</h4> <ul><li>PR: <a href="https://github.com/paritytech/cargo-contract/pull/131" target="_blank" rel="noopener noreferrer">paritytech/cargo-contract#131<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Source: <a href="https://github.com/patractlabs/cargo-contract" target="_blank" rel="noopener noreferrer">patractlabs/cargo-contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Frist of all, we have to submit <strong>wasm files which contain the debug info</strong> that the on-chain side can parse and get the panic errors.</p> <p>Currently, <a href="https://github.com/patractlabs/cargo-contract" target="_blank" rel="noopener noreferrer">parity/cargo-contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> trims debug info while building contracts, we can get them back with the following steps.</p> <h5 id="_1-keep-name-section-from-striping"><a href="#_1-keep-name-section-from-striping" class="header-anchor">#</a> 1. Keep name section from striping</h5> <p>The name section has been striped at <a href="https://github.com/paritytech/cargo-contract/blob/71525f9ec5f21e6113a614c2fb4d1eb5e62ebf8b/src/cmd/build.rs#L247" target="_blank" rel="noopener noreferrer">cargo-contract/cmd/build.rs#L247<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h5 id="_2-keep-debug-info-from-wasm-opt"><a href="#_2-keep-debug-info-from-wasm-opt" class="header-anchor">#</a> 2. Keep debug info from <code>wasm-opt</code></h5> <p><code>cargo-contract</code> passes <code>debug_info: false</code> to <code>wasm-opt</code>, so the debug-info will be always optimized when we run <code>wasm-opt</code>, the code is here: <a href="https://github.com/paritytech/cargo-contract/blob/71525f9ec5f21e6113a614c2fb4d1eb5e62ebf8b/src/cmd/build.rs#L267" target="_blank" rel="noopener noreferrer">cargo-contract/cmd/build.rs#L267<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h5 id="_3-keep-debug-info-from-rustc"><a href="#_3-keep-debug-info-from-rustc" class="header-anchor">#</a> 3. Keep debug info from <code>rustc</code></h5> <p><code>cargo-contract</code> executes realease build by default, here we can enable debug build or modify the opt-level flag of <code>rustc</code> to keep debug infos at <a href="https://github.com/paritytech/cargo-contract/blob/71525f9ec5f21e6113a614c2fb4d1eb5e62ebf8b/src/cmd/build.rs#L137" target="_blank" rel="noopener noreferrer">cargo-contract/cmd/build.rs#L137<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h4 id="_1-2-2-save-debug-info-from-the-scraper-of-pallet-contracts"><a href="#_1-2-2-save-debug-info-from-the-scraper-of-pallet-contracts" class="header-anchor">#</a> 1.2.2 Save debug info from the scraper of <code>Pallet Contracts</code></h4> <p>What happends to the <code>Pallet Contracts</code> while we calling a contract?</p> <ul><li><strong>Get the WASM binary from storage</strong></li> <li><strong>Inject gas meter to the contract</strong></li> <li>Inject stack height to the contract</li> <li>Put the contract into <code>sp-sandbox</code> and execute it</li> <li>Get the result from <code>sp-sandbox</code> and return the result to us</li></ul> <h5 id="_1-store-name-section-while-building-wasm-module"><a href="#_1-store-name-section-while-building-wasm-module" class="header-anchor">#</a> 1. Store name section while building WASM module</h5> <ul><li>PR: https://github.com/paritytech/parity-wasm/pull/300</li></ul> <p><code>Pallet Contracts</code> builds WASM modules from storage and drops custom sections by default, here we should get them back.</p> <h5 id="_2-update-function-indices-in-name-section-while-injecting-gas-meter"><a href="#_2-update-function-indices-in-name-section-while-injecting-gas-meter" class="header-anchor">#</a> 2. Update function indices in name section while injecting gas meter</h5> <ul><li>PR: <a href="https://github.com/paritytech/wasm-utils/pull/146" target="_blank" rel="noopener noreferrer">paritytech/wasm-utils#146<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Source: <a href="https://github.com/patractlabs/wasm-utils" target="_blank" rel="noopener noreferrer">patractlabs/wasm-utils#146<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><code>Pallet Contracts</code> reorders the indcies of functions in our WASM contracts after injecting gas memter to the WASM contracts at <a href="https://github.com/paritytech/wasm-utils/blob/d9432bafa9321f8e0e5b8a143f1ed858dbbbe272/src/gas/mod.rs#L467" target="_blank" rel="noopener noreferrer">paritytech/wasm-utils/gas/mod.rs#L467<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, this will mess up the function indecies in name section that we can not get the correct backtraces.</p> <h4 id="_3-impelment-wasm-backtrace-to-wasmi"><a href="#_3-impelment-wasm-backtrace-to-wasmi" class="header-anchor">#</a> 3. Impelment WASM backtrace to WASMI</h4> <ul><li>Source: <a href="https://github.com/patractlabs/wasmi" target="_blank" rel="noopener noreferrer">patractlabs/wasmi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>Remember the last two steps in chapter 2, the core part of enabling WASM backtrace to <code>Pallet Contract</code> is making <code>wasmi</code> support backtrace.</p> <p>The process of executing a function in the interpreter of wasmi is like:</p> <ul><li>Invoke the target function</li> <li>call and call and call over again
<ul><li>Panic if the process breaks.</li></ul></li></ul> <h5 id="add-function-info-field-to-funcref"><a href="#add-function-info-field-to-funcref" class="header-anchor">#</a> Add function info field to <code>FuncRef</code></h5> <p><code>FuncRef</code> is the 'function' wasmi interpreter calling directly, so we need to embed the debug info into the <code>FuncRef</code> as the first time, source at <a href="https://github.com/patractlabs/wasmi/blob/v0.6.2/src/func.rs#L26" target="_blank" rel="noopener noreferrer">wasmi/func.rs#L26<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language- extra-class"><pre class="language-text"><code>//! patractlabs/wasmi/src/func.rs#L26
/// ...
pub struct FuncRef {
    /// ...
    /// Function name and index for debug
    info: Option&lt;(usize, String)&gt;,
}
</code></pre></div><h5 id="set-function-info-using-name-section-while-parsing-wasm-modules"><a href="#set-function-info-using-name-section-while-parsing-wasm-modules" class="header-anchor">#</a> Set function info using name section while parsing WASM modules</h5> <p>We alread have the <code>info</code> field in <code>FuncRef</code>, now we need to fill this field using name section while parsing WASM modules, source at <a href="https://github.com/patractlabs/wasmi/blob/7a6feaea70f47aa6e62f097fb0d9a4ea0ce7d1fc/src/runner.rs#L1491" target="_blank" rel="noopener noreferrer">wasmi/module#L343<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language- extra-class"><pre class="language-text"><code>//! wasmi/src/module.rs#L343
// ...
if has_name_section {
     if let Some(name) = function_names.get((index + import_count) as u32) {
         func_instance = func_instance.set_info(index, name.to_string());
     } else {
         func_instance = func_instance.set_info(index, &quot;&lt;unknown&gt;&quot;.to_string());
     }
}
// ...
</code></pre></div><h5 id="make-the-interpreter-support-trace"><a href="#make-the-interpreter-support-trace" class="header-anchor">#</a> Make the interpreter support <code>trace</code></h5> <p>However, we don't need to get infos of every functions but the panicked series in the stack of the interpreter, source at <a href="https://github.com/patractlabs/wasmi/blob/7a6feaea70f47aa6e62f097fb0d9a4ea0ce7d1fc/src/runner.rs#L1491" target="_blank" rel="noopener noreferrer">wasmi/runner.rs#L1491<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language- extra-class"><pre class="language-text"><code>//! wasmi/src/runner.rs#L1491
/// Get the functions of current the stack
pub fn trace(&amp;self) -&gt; Vec&lt;Option&lt;&amp;(usize, String)&gt;&gt; {
    self.buf.iter().map(|f| f.info()).collect::&lt;Vec&lt;_&gt;&gt;()
}
</code></pre></div><h5 id="gather-debug-infos-when-program-breaks"><a href="#gather-debug-infos-when-program-breaks" class="header-anchor">#</a> Gather debug infos when program breaks</h5> <p>Just gather backtraces when we invoke function failed, source at <a href="https://github.com/patractlabs/wasmi/blob/7a6feaea70f47aa6e62f097fb0d9a4ea0ce7d1fc/src/func.rs#L170" target="_blank" rel="noopener noreferrer">wasmi/func.rs#L170<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language- extra-class"><pre class="language-text"><code>//! wasmi/src/func.rs#L170
// ...

let res = interpreter.start_execution(externals);
if let Err(trap) = res {
let mut stack = interpreter
    .trace()
    .iter()
    .map(|n| {
        if let Some(info) = n {
            format!(&quot;{:#}[{}]&quot;, rustc_demangle::demangle(&amp;info.1), info.0)
        } else {
            &quot;&lt;unknown&gt;&quot;.to_string()
        }
    })
    .collect::&lt;Vec&lt;_&gt;&gt;();

// Append the panicing trap
stack.append(&amp;mut trap.wasm_trace().clone());
stack.reverse();

// Embed this info into the trap
Err(trap.set_wasm_trace(stack))

// ...
</code></pre></div><h3 id="_1-3-contract-log-functions"><a href="#_1-3-contract-log-functions" class="header-anchor">#</a> 1.3 Contract Log functions</h3> <p>In the process of contract debugging, you need to know the internal execution of the contract and the intermediate data. In the current lack of debugging conditions (such as using gdb for debugging), log printing is the most convenient way. As mentioned in the Europa v0.2 proposal, the current <code>Pallet Contracts</code> and <code>ink!</code> already support <code>format!</code>+<code>seal_println</code> to format and print strings, but this mode has two defects :</p> <ol><li>All the logs of <code>seal_println</code> printed on the node side are <code>target: runtime</code> and level <code>DEBUG</code>, but when developing complex contracts, a lot of logs will be printed. If you cannot filter by <code>target</code> and log level, then the development process will be full of interference from irrelevant information.</li> <li>The contract developer wrote <code>seal_println</code> when needed during the development process, but all <code>seal_println</code> must be deleted when the contract is released. Although the contract developer can encapsulate a conditionally compiled function to control it, it is more convenient if a tool library already provides such a function.</li></ol> <p>Therefore, Europa provides a log library <a href="https://github.com/patractlabs/ink-log" target="_blank" rel="noopener noreferrer">patractlabs/ink-log<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that mimics Rust's <code>log</code> crete to solve the above problems. Its usage is the same as that of Rust. <code>log</code> is completely consistent, which reduces the learning cost of developers.</p> <p>The <code>ink-log</code> is generally implemented by the <code>ChainExtension</code> of <code>Pallet Contracts</code>, the agreed <code>function_id</code> is <code>0xfeffff00</code>, and the message is transmitted in the wasm memory through the structure <code>LoggerExt</code>. Therefore this library is divided into the following two parts:</p> <ol><li><p><code>ink_log</code>: In the <code>ink-log/contracts</code> directory, provide <code>info!</code>, <code>debug!</code>, <code>warn!</code>, <code>error!</code>, <code>trace!</code>, same as Rust's <code>log</code> library in the same macro, and the call method of the macro is also the same. These macros are packaged implementations of <code>seal_chain_extensions</code> on the ink! side, and are <strong>tool library for contract developers</strong>. For example, after this library is introduced in the contract <code>Cargo.toml</code>, the log can be printed as follows:</p> <p>In <code>Cargo.toml</code>:</p> <div class="language-cargo extra-class"><pre class="language-text"><code>[dependencies]
ink_log = { version = &quot;0.1&quot;, git = &quot;https://github.com/patractlabs/ink-log&quot;, default-features = false, features = [&quot;ink-log-chain-extensions&quot;] }

[features]
default = [&quot;std&quot;]
std = [
	# ...
	&quot;ink_log/std&quot;
]
</code></pre></div><p>In the contract, you can use the following methods to print logs in the node:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token namespace">ink_log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token string">&quot;flipper-contract&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;latest value is: {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <p><code>runtime_log</code>: In the <code>ink-log/runtime</code> directory, this library is based on the contents of the <code>function_id</code> and <code>LoggerExt</code> structures passed from <code>ChainExtensions</code> to call the corresponding logs under <code>debug</code> in <code>frame_support</code> to print. It is an implementation library of <code>ink_log</code> prepared for developers of the chain. **For example, chain developers can use it in their own <code>ChainExtensions</code>:</p> <p>In <code>Cargo.toml</code>：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">[</span>dependencies<span class="token punctuation">]</span>
runtime_log <span class="token operator">=</span> <span class="token punctuation">{</span> version <span class="token operator">=</span> <span class="token string">&quot;0.1&quot;</span><span class="token punctuation">,</span> git <span class="token operator">=</span> <span class="token string">&quot;https://github.com/patractlabs/ink-log&quot;</span><span class="token punctuation">,</span> default<span class="token operator">-</span>features <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>

<span class="token punctuation">[</span>features<span class="token punctuation">]</span>
default <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;std&quot;</span><span class="token punctuation">]</span>
std <span class="token operator">=</span> <span class="token punctuation">[</span>
	# <span class="token punctuation">...</span>
	<span class="token string">&quot;runtime_log/std&quot;</span>
<span class="token punctuation">]</span>
</code></pre></div><p>In <code>ChainExtensions</code>'s implementation：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">CustomExt</span><span class="token punctuation">;</span>
<span class="token keyword">impl</span> <span class="token class-name">ChainExtension</span> <span class="token keyword">for</span> <span class="token class-name">CustomExt</span> <span class="token punctuation">{</span>
	<span class="token keyword">fn</span> <span class="token function-definition function">call</span><span class="token operator">&lt;</span><span class="token class-name">E</span><span class="token punctuation">:</span> <span class="token class-name">Ext</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>func_id<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> env<span class="token punctuation">:</span> <span class="token class-name">Environment</span><span class="token operator">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span> <span class="token class-name">InitState</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">RetVal</span><span class="token punctuation">,</span> <span class="token class-name">DispatchError</span><span class="token operator">&gt;</span>
	<span class="token keyword">where</span>
		<span class="token operator">&lt;</span><span class="token class-name">E</span><span class="token punctuation">::</span><span class="token class-name">T</span> <span class="token keyword">as</span> <span class="token class-name">SysConfig</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">AccountId</span><span class="token punctuation">:</span> <span class="token class-name">UncheckedFrom</span><span class="token operator">&lt;&lt;</span><span class="token class-name">E</span><span class="token punctuation">::</span><span class="token class-name">T</span> <span class="token keyword">as</span> <span class="token class-name">SysConfig</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">Hash</span><span class="token operator">&gt;</span> <span class="token operator">+</span> <span class="token class-name">AsRef</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span>
        <span class="token keyword">match</span> func_id <span class="token punctuation">{</span>
            <span class="token punctuation">...</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">/* other ChainExtension */</span> <span class="token punctuation">}</span>
            <span class="token number">0xfeffff00</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// TODO add other libs</span>
        		<span class="token namespace">runtime_log<span class="token punctuation">::</span></span><span class="token macro property">logger_ext!</span><span class="token punctuation">(</span>func_id<span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token comment">// or use</span>
                <span class="token comment">// LoggerExt::call::&lt;E&gt;(func_id, env)</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">RetVal</span><span class="token punctuation">::</span><span class="token class-name">Converging</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>**<code>ink_log</code> corresponds to <code>runtime_log</code>, so if contract developers need to use <code>ink_log</code>, they need to pay attention to the chain corresponding to the debugging contract that needs to implement <code>runtime_log</code>. **</p> <p>On the other hand, after contract developers introduce <code>ink_log</code>, they need to pay attention to <code>features = [&quot;ink-log-chain-extensions&quot;]</code>, <code>ink_log</code> will call <code>seal_chain_extensions</code> to interact with the chain only when this feature is enabled. Without this feature, <code>noop</code> will be used to skip the process of contract printing.</p> <p>Therefore, contract developers can control the contract to print logs in the debugging environment and the production environment through features. The contract compiled in the debugging environment opens the <code>&quot;ink-log-chain-extensions&quot;</code> feature, and the contract compiled in the production environment removes this feature.</p> <h2 id="_2-what-europa-can-do-in-v0-2"><a href="#_2-what-europa-can-do-in-v0-2" class="header-anchor">#</a> 2. What Europa can do in v0.2</h2> <h3 id="_2-1-build"><a href="#_2-1-build" class="header-anchor">#</a> 2.1 Build</h3> <p>For contract developers, it is necessary to prepare <code>Europa</code> and <code>cargo-contract</code> tools.</p> <h4 id="_2-1-1-europa"><a href="#_2-1-1-europa" class="header-anchor">#</a> 2.1.1 Europa</h4> <p>The building process for this project is as same as <a href="https://github.com/paritytech/substrate/" target="_blank" rel="noopener noreferrer">Substrate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>When building finished, current executable file in <code>target</code> directory is named <code>Europa</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone --recurse-submodules https://github.com/patractlabs/Europa.git
</code></pre></div><h4 id="_2-1-2-cargo-contract"><a href="#_2-1-2-cargo-contract" class="header-anchor">#</a> 2.1.2 cargo-contract</h4> <p>If you want to see the backtrace executed by WASM during the operation of Europa, you must use the <code>cargo-contract</code> version we provide. Because the current paritytech repo <a href="https://github.com/paritytech/cargo-contract" target="_blank" rel="noopener noreferrer">cargo-contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> uses the highest optimization level when compiling the contract, and discards the &quot;name section&quot; part in WASM. As mentioned above, if you need to print the call stack information in the wasmi execution contract, the contract file must have the &quot;name section&quot; part, so the use of the <code>cargo-contract</code> provided by paritytech cannot meet the requirements. We completed this function in our forked repo. On the other hand, we think that the function of &quot;name section&quot; in WASM may not only be needed by Europa, so we submitted <a href="https://github.com/paritytech/cargo-contract/pull/131" target="_blank" rel="noopener noreferrer">pr#131[Enable debug info to the source warehouse with flag in command build]<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> provides this feature.</p> <p>Before this PR is merged, currently only the <code>cargo-contract</code> version provided by us (Patract Labs) can be used:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cargo <span class="token function">install</span> --git https://github.com/patractlabs/cargo-contract --branch cmd/debug --force
</code></pre></div><p>If you do not want this version of <code>cargo-contract</code> to override the version released by paritytech, then it is recommended to compile locally and use the compiled <code>cargo-contract</code> directly:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/patractlabs/cargo-contract --branch cmd/debug
<span class="token builtin class-name">cd</span> cargo-contract
cargo build --release
</code></pre></div><blockquote><p>Note: Executing the <code>cargo-contract build</code> command requires the <code>default toolchain</code> of the rust tool-chain to be <code>nightly</code>, otherwise you can only use <code>cargo +nightly contract build</code>, but using <code>cargo</code> to call <code>cargo-contract</code> needs to be executed <code>cargo install</code> installs or overwrites the compiled product in the <code>~/.cargo/bin</code> directory, and cannot co-exist with paritytech's <code>cargo-contract</code></p></blockquote> <p>Execute:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cargo-contract build --help
<span class="token comment"># or</span>
cargo +nightly contract build --help
</code></pre></div><p>If you can see:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>FLAGS:
    -d, --debug      
            Emits debug info into wasm <span class="token function">file</span>
</code></pre></div><p>It means that you are using the <code>cargo-contract</code> provided by Patract Labs. If you want to see the backtrace of the WASM contract execution crash while using Europa, you need to add the <code>--debug</code> command when compiling the contract.</p> <p>Using the <code>--debug</code> command will generate another file besides the normal file in the <code>target/ink</code> directory of the originally compiled contract, ending with <code>*.src.wasm</code>. This <code>*.src.wasm</code> file is the WASM contract file containing the &quot;name section&quot; part.</p> <p>**If you need to use Europa for testing, the contract deployed to Europa needs to use this <code>*.src.wasm</code> file instead of the originally generated <code>*.wasm</code> file. **</p> <h3 id="example"><a href="#example" class="header-anchor">#</a> example</h3> <p>We can use one simple case and other cases we have encountered to verify the reliability of Europa's positioning problems.</p> <p>In the following context, the methods of starting Europa are all used by:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ Europa --tmp -lruntime<span class="token operator">=</span>debug
</code></pre></div><p>Every time Europa is started in this way, new data is created. If you want to keep Europa's execution data, please refer to Europa's <a href="https://github.com/patractlabs/europa" target="_blank" rel="noopener noreferrer">README<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or Europa v0.1's [Report](https://polkadot.polkassembly.io/post/ 166), you can get more command introduction.</p> <h4 id="case-1-simple-case"><a href="#case-1-simple-case" class="header-anchor">#</a> Case 1：Simple case</h4> <p>For example, we modify the example contract <code>ink/example/erc20</code> in the <a href="https://github.com/paritytech/ink" target="_blank" rel="noopener noreferrer">ink!<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> project as follows:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[ink(message)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">transfer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> to<span class="token punctuation">:</span> <span class="token class-name">AccountId</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">Balance</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> from <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">env</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">transfer_from_to</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>WASM, it corresponds to the code after the macro expansion of the original file, so if you want to compare the errors of the call stack, you need to expand the macro of the original contract:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>cargo <span class="token function">install</span> <span class="token function">expand</span>
<span class="token builtin class-name">cd</span> ink/example/erc20
cargo <span class="token function">expand</span> <span class="token operator">&gt;</span> tmp.rs
</code></pre></div><p>After reading the <code>tmp.rs</code> file, we can know that WASM needs to go through when it executes the <code>transfer</code> function:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>fn call<span class="token punctuation">(</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> u32 
-<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>Erc20 as ::ink_lang::DispatchUsingMode<span class="token operator">&gt;</span>::dispatch_using_mode<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span>
-<span class="token operator">&gt;</span> <span class="token operator">&lt;&lt;</span>Erc20 as ::ink_lang::ConstructorDispatcher<span class="token operator">&gt;</span>::Type as ::ink_lang::Execute<span class="token operator">&gt;</span>::execute<span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span>  <span class="token comment"># compile selector at here</span>
-<span class="token operator">&gt;</span> ::ink_lang::execute_message_mut
-<span class="token operator">&gt;</span> move <span class="token operator">|</span>state: <span class="token operator">&amp;</span>mut Erc20<span class="token operator">|</span> <span class="token punctuation">{</span> <span class="token punctuation">..</span>. <span class="token punctuation">}</span> <span class="token comment"># a closure</span>
-<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>__ink_Msg<span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 2644567034usize<span class="token punctuation">]</span><span class="token operator">&gt;</span> as ::ink_lang::MessageMut<span class="token operator">&gt;</span>::CALLABLE
-<span class="token operator">&gt;</span> transfer
</code></pre></div><p>Therefore, if the <code>panic</code> in <code>transfer</code> is encountered during the contract call, the backtrace of WASM should be similar to this.</p> <p>First we start Europa:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ Europa --tmp -lruntime<span class="token operator">=</span>debug
</code></pre></div><p>Then we deploy this erc20 and call transfer to execute.</p> <p>We can use <a href="https://polkadot.js.org/apps" target="_blank" rel="noopener noreferrer"><code>Polkadot/Substrate Portal</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or use <a href="https://redspot.patract.io/en/tutorial/" target="_blank" rel="noopener noreferrer">RedSpot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to verify this process. Suppose we use <code>RedSpot</code> to execute a <code>transfer</code> call of this wrong ERC20 contract. Please note that the <code>--debug</code> subcommand must be added in the process of compiling the contract:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ npx redspot-new erc20
$ <span class="token builtin class-name">cd</span> erc20/contracts
<span class="token comment"># add panic in `transfer` function as abrove</span>
$ <span class="token function">vim</span> lib.rs 
<span class="token comment"># notice must add --debug when compile contract</span>
<span class="token comment"># due current cargo-contract is not paritytech, we need to copy compile product into `artifacts` directory. RedSpot would support Europa and PatractLabs's cargo-contract in next version.</span>
$ cargo +nightly contract build --debug 
$ <span class="token function">mkdir</span> <span class="token punctuation">..</span>/artifacts
<span class="token comment"># notice must cp erc20.src.wasm, not erc20.wasm</span>
$ <span class="token function">cp</span> ./target/ink/erc20.src.wasm <span class="token punctuation">..</span>/artifacts  
<span class="token comment"># notice must rename metadata.json to erc20.json</span>
$ <span class="token function">cp</span> ./target/ink/metadata.json <span class="token punctuation">..</span>/artifacts/erc20.json 
$ <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/
<span class="token comment"># enter redspot console, use `--no-compile` to deny recompile contract</span>
$ npx redspot console --no-compile  
<span class="token comment"># in redspot console</span>
Welcome to Node.js v12.16.1.Type <span class="token string">&quot;.help&quot;</span> <span class="token keyword">for</span> <span class="token function">more</span> information.
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> var factory <span class="token operator">=</span> await patract.getContractFactory<span class="token punctuation">(</span><span class="token string">'erc20'</span><span class="token punctuation">)</span>
<span class="token comment"># do following command could deploy the erc20 contract</span>
<span class="token operator">&gt;</span> var contract <span class="token operator">=</span> await factory.deployed<span class="token punctuation">(</span><span class="token string">'new'</span>, <span class="token string">'1000000'</span>, <span class="token punctuation">{</span>value: <span class="token number">20000000000</span>, salt:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># do a transfer call directly</span>
<span class="token operator">&gt;</span> await contract.transfer<span class="token punctuation">(</span><span class="token string">&quot;5GcTYx4dPTQfi4udKPvE4VKmbooV7zY6hNYVF9JXHJL4knNF&quot;</span>, <span class="token number">100</span><span class="token punctuation">)</span>
</code></pre></div><p>Then in Europa's log, you can see:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
	ext_result: <span class="token punctuation">[</span>failed<span class="token punctuation">]</span> ExecError <span class="token punctuation">{</span> error: DispatchError::Module <span class="token punctuation">{</span>index:5, error:17, message: Some<span class="token punctuation">(</span><span class="token string">&quot;ContractTrapped&quot;</span><span class="token punctuation">)</span>, orign: ErrorOrigin::Caller <span class="token punctuation">}</span><span class="token punctuation">}</span>
    caller: d43593c715fdd31c61141abd04a99fd6822<span class="token punctuation">..</span>.<span class="token punctuation">(</span>5GrwvaEF<span class="token punctuation">..</span>.<span class="token punctuation">)</span>,
    self_account: b6484f58b7b939e93fff7dc10a654af7e<span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token punctuation">(</span>5GBi41bY<span class="token punctuation">..</span>.<span class="token punctuation">)</span>,
    selector: 0xfae3a09d,
    args: 0x1cbd2d43530a44705ad088af313e18f80b5<span class="token punctuation">..</span><span class="token punctuation">..</span>,
    value: <span class="token number">0</span>,
    gas_limit: <span class="token number">409568000000</span>,
    gas_left: <span class="token number">369902872067</span>,
    env_trace: <span class="token punctuation">[</span>
        seal_value_transferred<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0x00000000000000000000000000000000<span class="token punctuation">))</span>,
        seal_input<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0xfae3a09d1cbd<span class="token punctuation">..</span><span class="token punctuation">..</span>.<span class="token punctuation">))</span>,
        seal_get_storage<span class="token variable"><span class="token punctuation">((</span>Some<span class="token punctuation">(</span><span class="token number">0x0100000000000</span>....<span class="token punctuation">)</span><span class="token punctuation">,</span> Some<span class="token punctuation">(</span><span class="token number">0x010000000100000001000000</span><span class="token punctuation">))</span></span><span class="token punctuation">)</span>,
        <span class="token comment"># ...</span>
        seal_caller<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0xd43593c715fdd31c61141abd<span class="token punctuation">..</span>.<span class="token punctuation">))</span>,
        seal_hash_blake256<span class="token variable"><span class="token punctuation">((</span>Some<span class="token punctuation">(</span><span class="token number">0x696e6b20686173</span>....<span class="token punctuation">)</span><span class="token punctuation">,</span> Some<span class="token punctuation">(</span><span class="token number">0x0873b31b7a3cf</span>....<span class="token punctuation">))</span></span><span class="token punctuation">)</span>,
      	<span class="token comment"># ...  </span>
        seal_deposit_event<span class="token variable"><span class="token punctuation">((</span>Some<span class="token punctuation">(</span>[<span class="token number">0x45726332303a</span>...<span class="token number">.00000000000</span>]<span class="token punctuation">)</span><span class="token punctuation">,</span> Some<span class="token punctuation">(</span><span class="token number">0x000</span>..<span class="token punctuation">))</span></span><span class="token punctuation">)</span>,
    <span class="token punctuation">]</span>,
	trap_reason: TrapReason::SupervisorError<span class="token punctuation">(</span>DispatchError::Module <span class="token punctuation">{</span> index: <span class="token number">5</span>, error: <span class="token number">17</span>, message: Some<span class="token punctuation">(</span><span class="token string">&quot;ContractTrapped&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>,
    wasm_error: Error::WasmiExecution<span class="token punctuation">(</span>Trap<span class="token punctuation">(</span>Trap <span class="token punctuation">{</span> kind: Unreachable <span class="token punctuation">}</span><span class="token punctuation">))</span>
        wasm backtrace: 
        <span class="token operator">|</span>  core::panicking::panic<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  erc20::erc20::_::<span class="token operator">&lt;</span>impl erc20::erc20::Erc2<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>::transfer<span class="token punctuation">[</span><span class="token number">1697</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  <span class="token operator">&lt;</span>erc20::erc20::_::__ink_Msg<span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">2644567034</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> as ink_lang::traits::MessageMut<span class="token operator">&gt;</span>::CALLABLE::<span class="token punctuation">{</span><span class="token punctuation">{</span>closure<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">611</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  core::ops::function::FnOnce::call_once<span class="token punctuation">[</span><span class="token number">610</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  <span class="token operator">&lt;</span>erc20::erc20::_::_::__ink_MessageDispatchEnum as ink_lang::dispatcher::Execute<span class="token operator">&gt;</span>::execute::<span class="token punctuation">{</span><span class="token punctuation">{</span>closure<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">1675</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  ink_lang::dispatcher::execute_message_mut<span class="token punctuation">[</span><span class="token number">1674</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  <span class="token operator">&lt;</span>erc20::erc20::_::_::__ink_MessageDispatchEnum as ink_lang::dispatcher::Execute<span class="token operator">&gt;</span>::execute<span class="token punctuation">[</span><span class="token number">1692</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  erc20::erc20::_::<span class="token operator">&lt;</span>impl ink_lang::contract::DispatchUsingMode <span class="token keyword">for</span> erc20::erc20::Erc2<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>::dispatch_using_mode<span class="token punctuation">[</span><span class="token number">1690</span><span class="token punctuation">]</span>
        <span class="token operator">|</span>  call<span class="token punctuation">[</span><span class="token number">1691</span><span class="token punctuation">]</span>
        ╰─<span class="token operator">&gt;</span><span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">2387</span><span class="token punctuation">]</span>
    ,
    nest: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
<span class="token punctuation">}</span>
</code></pre></div><p>Let us explain the information printed above:</p> <ol><li><p><code>ext_result</code>: indicates that this contract call is displayed as successful or failed:</p> <ol><li><code>[success]</code>: indicates the successful execution of this contract (Note: the successful execution of the contract does not mean the successful execution of the business logic of the contract itself. There may be an error return in <code>ink!</code> or the business logic of the contract itself, as in case 3 in the following text.) And the <code>ExecResultValue {flag:0, data: 0x...}</code> followed by <code>[success]</code> indicates the return value after this contract is executed.</li> <li><code>[failed]</code>: indicates that the execution of this contract failed, and the <code>ExecError {.. }</code> followed by <code>[failed]</code> indicates the cause of this error. The reason for this is the value recorded in <code>event</code> on the chain, which is the value defined in <code>decl_error!</code> of <code>Pallet Contracts</code>.</li></ol></li> <li><p><code>1: NestedRuntime</code>&amp;<code>nest</code>: The contract information that represents the current print information is located in the first layer of the contract call stack. If the current contract calls another contract, it will appear in the array of the <code>nest</code> field. <code>2: NestedRuntime</code> and <code>1: NestedRuntime</code> has the same structure. Among them, <code>2</code> indicates that the called contract is in the second layer of the contract call stack. If several contracts are called across contracts in the current contract, there will be several <code>NestedRuntime</code> in the array of <code>nest</code>. If there are other contract calls in the second-level contract, the same goes for.</p> <p>For example, if there are contracts A, B, C, if it is the following situation:</p> <ol><li><p>After A calls B, it returns to A to continue execution, and then calls contract C</p> <div class="language-text extra-class"><pre class="language-text"><code>|A|
| |-&gt;|B|
| |&lt;-
| |-&gt;|C|
| |&lt;-
</code></pre></div><p>Then it will produce a log print similar to the following:</p> <div class="language-text extra-class"><pre class="language-text"><code>1: NestedRuntime {
 self_account: A,
 nest:[
     2: NestedRuntime {
         self_account: B,
         nest:[],
     },
     2: NestedRuntime {
         self_account: C,
         nest:[],
     }
 ]
}
</code></pre></div></li> <li><p>After A calls B, B calls contract C again, and finally returns to A</p> <div class="language-text extra-class"><pre class="language-text"><code>|A|
| |-&gt;|B|
| |  | |-&gt;|C|
| |  | |&lt;-
| |&lt;-
</code></pre></div><p>Then it will produce a log print similar to the following:</p> <div class="language-text extra-class"><pre class="language-text"><code>1: NestedRuntime {
 self_account: A,
 nest:[
     2: NestedRuntime {
         self_account: B,
         nest:[
         	3: NestedRuntime {
                self_account: C,
                nest:[],
            }
         ],
     }  
 ]
}
</code></pre></div></li></ol></li> <li><p><code>caller</code>: who is the caller of the current contract. If the contract calls the contract, the value of the called contract is the address of the upper-level contract.</p></li> <li><p><code>self_account</code>: represents the address of the current contract itself.</p></li> <li><p><code>selector</code> &amp; <code>args</code>&amp;<code>value</code>: Represents the <code>selector</code> and parameters passed in when calling the current contract. <strong>These information can quickly locate whether the calling contract method is correct</strong>.</p></li> <li><p><code>gas_limit</code> &amp; <code>gas_left</code>: Represents the <code>gas_limit</code> passed in when the contract is currently called and the remaining gas after <strong>executing this layer</strong>. Note here that <code>gas_left</code> refers to the remaining gas after the execution of this layer of contract, so In the contract call contract, the gas consumed by each layer of contract can be determined through <code>gas_left</code>, not only get the consumption after the execution of the entire contract.</p></li> <li><p><code>env_trace</code>: Indicates that during the execution of the current layer of the contract, each time host_function is called in the contract WASM execution, a record will be added to the list here. Because all host_functions and the definitions in <a href="https://github.com/paritytech/substrate/blob/master/frame/contracts/src/wasm/runtime.rs#L610" target="_blank" rel="noopener noreferrer"><code>define_env!</code> in the <code>Pallet Contracts</code> module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are related, so tracing <code>env_trace</code> can trace the process of interacting with <code>Pallet Contracts</code> during the execution of the current WASM contract.</p> <p>For example, if following thing appears in <code>env_trace</code>:</p> <ul><li><code>seal_call</code>: It means that there is a contract call contract situation in the current contract. According to the order in which <code>seal_call</code> appears in <code>env_trace</code>, it can correspond to <code>nest</code> to calculate the state before and after the contract calls the contract.</li> <li><code>seal_get_storage</code>&amp;<code>seal_set_storage</code>: It means that data read and write occurred in the contract. Through these two interfaces, it is possible to intercept and count the data read and write during the execution of the current contract, and the data size calculated by **<code>seal_set_storage</code> can also be used to infer the storage size required by <code>rent</code>. **</li> <li><code>seal_deposit_event</code>: indicates that the event is printed in the contract. Here you can intercept the content of each event separately, instead of getting a unified event at the end. And the following text will use an example to surface that Europa can quickly locate the bug in the <code>host_function</code>.</li></ul> <p>On the other hand, the statistics of <code>env_trace</code> are relatively <strong>fine-grained</strong>. For example, if there are multiple possible errors in <code>host_function</code>, when an error occurs, all the information before the error will be retained, so it can be located to the place where the problem occurred during the execution of <code>host_function</code>.</p> <p>And if there is an error in <code>host_function</code> that causes the contract to end execution, <code>env_trace</code> records the last error <code>host_function</code> call, so you can directly locate which <code>host_function</code> caused the contract execution exception.</p></li> <li><p><code>trap_reason</code>: According to the definition of <code>TrapReason</code> in <code>Pallet Contracts</code>, <code>trap_reason</code> can be divided into 2 categories:</p> <ol><li><code>Return</code> &amp; <code>Termination</code> &amp; <code>Restoration</code>: indicates that the contract exit is the design of <code>Pallet Contracts</code>, not an internal error. This type of trap indicates that the contract is executed normally and is not an error.</li> <li><code>SupervisorError</code>: Indicates that an error occurred during the execution of the contract calling host_function.</li></ol> <p>Therefore, the current Europa log printing design is designed to record whenever <code>trap_reason</code> appears. On the other hand, <code>trap_reason</code> may not always appear during the execution of the contract. Combining the design of <code>Pallet Contracts</code> and <code>ink!</code>, there is a case where the successful execution of the contract or the execution failure in the <code>ink!</code> layer does not generate <code>trap_reason</code>. Therefore, in addition to recording <code>trap_reason</code>, Europa also **records the results returned by the WASM executor after execution, which is recorded with <code>sandbox_result_ok</code>. **</p></li> <li><p><code>sandbox_result_ok</code>: The value of <code>sandbox_result_ok</code> represents the result of the contract after the WASM executor is executed. This value could have been recorded as <code>sandbox_result</code>, including correct and incorrect conditions. However, due to the limitations of Rust and combined with the business logic of <code>Pallet Contracts</code>, only the result of <code>sandbox_result</code> is kept as <code>Ok</code> here. **For log printing, Europa is designed to print <code>sandbox_result_ok</code> only when trap_reason is the first case, as information to assist in judging contract execution. **</p> <p><code>sandbox_result_ok</code> is the WASM executor <a href="https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f/frame/contracts/src/wasm/mod.rs#L155-L156" target="_blank" rel="noopener noreferrer">result after calling <code>invoke</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> After the processing of <code>to_execution_result</code>, if there is no <code>trap_reason</code>, the result of <code>Ok(..)</code> is [discarded](https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f /frame/contracts/src/wasm/runtime.rs#L366-L368). But in fact there are two situations here:</p> <ol><li>An error occurred in <code>ink!</code>: According to the implementation of <code>ink!</code>, before calling the functions wrapped by the contract <code>#[ink(message)]</code> and <code>#[ink(constructor)]</code>, the input The process of decoding and matching <code>selector</code>. If an error occurs during this process, the contract will return <a href="https://github.com/paritytech/ink/blob/abd5cf14c0883cb2d5acf81f2277aeec330aa843/crates/lang/src/error.rs#L22" target="_blank" rel="noopener noreferrer">error code <code>DispatchError</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. But for the WASM executor, the WASM code is executed normally, so the result will be returned, including this error code. **This contract execution process is an error situation. **</li> <li>The return value of <code>#[ink(message)]</code> is defined as <code>()</code>: According to the implementation of <code>ink!</code>, if the return value type is <code>()</code>, <code>seal_reason</code> will not be called, so it will not Contains <code>trap_reason</code>. **This contract execution process is an correct situation. **</li></ol> <p>Since <code>ink!</code> is only a contract implementation that runs on <code>Pallet Contracts</code>, other implementations may have different rules, so currently <code>sandbox_result_ok</code> is only used to assist in determining the execution of the <code>ink!</code> contract, the value is <a href="https://github.com/paritytech/substrate/blob/712085115cdef4a79a66747338c920d6ba4e479f/primitives/wasm-interface/src/lib.rs#L462-L467" target="_blank" rel="noopener noreferrer"><code>ReturnValue</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Among them, if the <code>&lt;num&gt;</code> part of <code>ReturnValue::Value(&lt;num&gt;)</code> of the log is not 0, it means that there may be an error in the execution of <code>ink!</code>. You can use <code>ink!</code> for <a href="https://github.com/paritytech/ink/blob/abd5cf14c0883cb2d5acf81f2277aeec330aa843/crates/lang/src/error.rs#L66-L80" target="_blank" rel="noopener noreferrer"><code>DispatchError</code> The error code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> determines the error.</p></li> <li><p><code>wasm_error</code>: indicates the backtrace when WASM executes an error. This part will be printed only when <code>ext_result</code> is <code>failed</code>.</p> <p>In the above example, because the execution of <code>transfer</code> will trigger <code>panic</code>, you can see that the cause of the error here is <code>WasmiExecution(Trap(Trap {kind: Unreachable }))</code>, indicating that this time the failure is due to execution The situation of <code>Unreacble</code> in the contract process is caused, and the backtrace information below also <strong>very accurately describes</strong> the function execution call stack when an error is encountered after the expansion of the contract macro discussed above. The following calling process can be clearly found from the backtrace.</p></li></ol> <div class="language-text extra-class"><pre class="language-text"><code>call -&gt; dispatch_using_mode -&gt; ... -&gt; transfer -&gt; panic 
</code></pre></div><p>This process is consistent with the original information of the contract.</p> <h4 id="case-2-contracttrap-caused-by-locating-duplicate-topics"><a href="#case-2-contracttrap-caused-by-locating-duplicate-topics" class="header-anchor">#</a> Case 2：<code>ContractTrap</code> caused by locating duplicate topics</h4> <p>Some time ago, we (Patract Labs) reported a bug to <code>ink!</code>, see issue:<a href="https://github.com/paritytech/ink/issues/589" target="_blank" rel="noopener noreferrer">&quot;When set '0' value in contracts event, may cause <code>Error::ContractTrapped</code> and panic in contract #589&quot; <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It is very difficult to locate this error before Europa has developed the relevant function. Thank you @athei <a href="https://github.com/paritytech/ink/issues/589#issuecomment-731571918" target="_blank" rel="noopener noreferrer">located the error<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Here we reproduce this error and use Europa's log to quickly analyze and locate the place where the bug appears:</p> <ol><li><p>checkout <code>ink!</code> to commit <code>8e8fe09565ca6d2fad7701d68ff13f12deda7eed</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ink
<span class="token function">git</span> checkout 8e8fe09565ca6d2fad7701d68ff13f12deda7eed -b tmp
</code></pre></div></li> <li><p>Go in <code>ink/examples/erc20/lib.rs:L90</code> to change <code>value</code> to <code>0_u128</code> in <code>Transfer</code></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[ink(constructor)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>initial_supply<span class="token punctuation">:</span> <span class="token class-name">Balance</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
	<span class="token comment">//...</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">env</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit_event</span><span class="token punctuation">(</span><span class="token class-name">Transfer</span> <span class="token punctuation">{</span>
        from<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        to<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// change this from `initial_supply` to `0_u128`</span>
        value<span class="token punctuation">:</span> 0_u128<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// initial_supply,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    instance
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>Execute <code>cargo +nightly contract build --debug</code> to compile the contract</p></li> <li><p>Use <a href="https://redspot.patract.io/en/tutorial/" target="_blank" rel="noopener noreferrer">RedSpot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://polkadot.js.org/apps" target="_blank" rel="noopener noreferrer"><code>Polkadot/Substrate Portal</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to deploy this contract ( Note that you must use the erc20.src.wasm file)</p></li></ol> <p>You should encounter <code>DuplicateTopics</code> in the deployment phase (before this <a href="https://github.com/paritytech/substrate/pull/7762" target="_blank" rel="noopener noreferrer">bug<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is corrected, the reported error is <code>ContractTrap</code>), and in the Europa log Will show:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
    <span class="token comment">#...</span>
    env_trace: <span class="token punctuation">[</span>
        seal_input<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0xd183512b0<span class="token punctuation">))</span>,
		<span class="token comment">#...    </span>
		seal_deposit_event<span class="token variable"><span class="token punctuation">((</span>Some<span class="token punctuation">(</span>[<span class="token number">0x45726332303a3a5472616e736</span>....]<span class="token punctuation">)</span><span class="token punctuation">,</span> None<span class="token punctuation">))</span></span>,
    <span class="token punctuation">]</span>,
    trap_reason: TrapReason::SupervisorError<span class="token punctuation">(</span>DispatchError::Module <span class="token punctuation">{</span> index: <span class="token number">5</span>, error: <span class="token number">23</span>, message: Some<span class="token punctuation">(</span><span class="token string">&quot;DuplicateTopics&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>,
    wasm_error: Error::WasmiExecution<span class="token punctuation">(</span>Trap<span class="token punctuation">(</span>Trap <span class="token punctuation">{</span> kind: Host<span class="token punctuation">(</span>DummyHostError<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">))</span>
    	wasm backtrace: 
    	<span class="token operator">|</span>  ink_env::engine::on_chain::ext::deposit_event<span class="token punctuation">[</span><span class="token number">1623</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  ink_env::engine::on_chain::impls::<span class="token operator">&lt;</span>impl ink_env::backend::TypedEnvBackend <span class="token keyword">for</span> ink_env::engine::on_chain::EnvInstance<span class="token operator">&gt;</span>::emit_event<span class="token punctuation">[</span><span class="token number">1564</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  ink_env::api::emit_event::<span class="token punctuation">{</span><span class="token punctuation">{</span>closure<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token number">1563</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  <span class="token operator">&lt;</span>ink_env::engine::on_chain::EnvInstance as ink_env::engine::OnInstance<span class="token operator">&gt;</span>::on_instance<span class="token punctuation">[</span><span class="token number">1562</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  ink_env::api::emit_event<span class="token punctuation">[</span><span class="token number">1561</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  erc20::erc20::_::<span class="token operator">&lt;</span>impl ink_lang::events::EmitEvent<span class="token operator">&lt;</span>erc20::erc20::Erc2<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token keyword">for</span> ink_lang::env_access::EnvAccess<span class="token operator">&lt;&lt;</span>erc20::erc20::Erc20 as ink_lang::env_access::ContractEnv<span class="token operator">&gt;</span>::Env<span class="token operator">&gt;&gt;</span>::emit_event<span class="token punctuation">[</span><span class="token number">1685</span><span class="token punctuation">]</span>
<span class="token comment"># ...</span>
<span class="token comment"># ...</span>
    	<span class="token operator">|</span>  deploy<span class="token punctuation">[</span><span class="token number">1691</span><span class="token punctuation">]</span>
    	╰─<span class="token operator">&gt;</span><span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">2385</span><span class="token punctuation">]</span>
    ,
    nest: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
<span class="token punctuation">}</span>
</code></pre></div><p>You can see from the above log:</p> <ol><li>The last record of <code>env_trace</code> is <code>seal_deposit_event</code> instead of <code>seal_return</code> (when the contract is executed correctly, the last record must be <code>seal_return</code>)</li> <li>The second parameter of <code>seal_deposit_event</code> is <code>None</code> instead of an existing value, which indicates that the host_function of <code>seal_deposit_event</code> has not been executed, but an error occurred during the execution (see the forked dependency of Europa) See the [corresponding implementation] (https://github.com/patractlabs/substrate/blob/3624deb47cabe6f6cd44ec2c49c6ae5a29fd2198/frame/contracts/src/wasm/runtime.rs#L1399) for the source code of the version of <code>Pallet Contracts</code>.</li> <li>Combined with the error stack of wasm backtrace, we can intuitively see that the top call stack of backtrace is <code>deposit_event</code>.</li></ol> <p>Therefore, combining the above information, we can directly infer that the host_function of <code>seal_deposit_event</code> has an exception during the execution. (Before the submission of <code>Pallet Contracts</code><a href="https://github.com/paritytech/substrate/pull/7762" target="_blank" rel="noopener noreferrer">pull#7762<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, we recorded the error message in host_function. After the merge, we used <code>trap_reason</code> unified error message.)</p> <h4 id="case-3-when-error-is-caused-by-the-chain-using-type-balance-u64-instead-of-type-balance-u128"><a href="#case-3-when-error-is-caused-by-the-chain-using-type-balance-u64-instead-of-type-balance-u128" class="header-anchor">#</a> Case 3: When error is caused by the chain using <code>type Balance=u64</code> instead of <code>type Balance=u128</code></h4> <p>If the chain uses the definition of <code>Balance=u64</code>, and the definition of <code>Balance</code> in the chain is unknown to <code>ink!</code> (the default definition of Balance is <code>u128</code>). Therefore, when using <code>u128</code> to define <code>Balance</code>'s <code>ink!</code> as a dependency compiled contract, when running on a chain where <code>Balance</code> is defined as <code>u64</code>, it will cause the <code>Pallet Contracts</code> module to transfer values to the contract , The contract internally regards the <code>value</code> of <code>u64</code> as a decoding error of <code>u128</code>.</p> <p>Take the example contract of erc20 as an example, after expanding the macro of the contract, you can see:</p> <ul><li>When there is an error in the <code>dispatch_using_mode</code> stage of decoding <code>input</code>, the contract returns with <code>::ink_lang::DispatchError::CouldNotReadInput</code>, but the model design of <code>Pallet Contracts</code> believes that the WASM contract execution is not abnormal.</li> <li>In the call of <code>call</code>, since <code>deny_payment</code> is checked before calling <code>dispatch_using_mode</code>, and if an Error is returned when checking <code>deny_payment</code>, it will be directly <code>panic</code>.</li></ul> <p>Therefore, in this case, the contract for deploying (<code>Instantiate</code>) ERC20 will execute normally, and any method of ERC20 such as <code>transfer</code> will be called with <code>ContractTrap</code>.</p> <p>Let's look at these two situations separately:</p> <ol><li><p><code>instantiate</code> stage：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
	ext_result: <span class="token punctuation">[</span>success<span class="token punctuation">]</span> ExecError <span class="token punctuation">{</span> error: DispatchError::Module <span class="token punctuation">{</span>index:5, error:17, message: Some<span class="token punctuation">(</span><span class="token string">&quot;ContractTrapped&quot;</span><span class="token punctuation">)</span>, orign: ErrorOrigin::Caller <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment">#...</span>
    env_trace: <span class="token punctuation">[</span>
        seal_input<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0xd183512b008cb6611e0100000000000000000000<span class="token punctuation">))</span>,
        seal_caller<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0xd43593c715fdd31c61141abd04a99fd682<span class="token punctuation">))</span>,
        //<span class="token punctuation">..</span>.
        seal_set_storage<span class="token variable"><span class="token punctuation">((</span>Some<span class="token punctuation">(</span><span class="token number">0x030000000100000</span>...<span class="token punctuation">)</span><span class="token punctuation">,</span> Some<span class="token punctuation">(</span><span class="token number">0x000000000000000</span>...<span class="token punctuation">))</span></span><span class="token punctuation">)</span>,
    <span class="token punctuation">]</span>,
    sandbox_result_ok: RuntimeValue::Value<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>,
    nest: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
<span class="token punctuation">}</span>
</code></pre></div><p>From the above log, we can see:</p> <ol><li><p>The end of <code>env_trace</code> does not end with <code>seal_return</code>, it means that the contract has not been executed normally. Because it can be seen from the design of <code>ink!</code> that if you enter <code>#[ink(constructor)]</code> normally or enter <code>#[ink(message)]</code>, then must be executed to <code>::ink_lang::execute_message</code> (<code>::ink_lang::execute_message</code> will call <code>seal_return</code>), and the absence of <code>seal_return</code> means that the execution has not reached the stage of <code>execute</code>.</p></li> <li><p><code>sandbox_result_ok</code> indicates that the return value of the execution is <code>7</code>. By querying <code>ink!</code> for the implementation of <code>DispatchError</code>, you can see that this error code represents <code>CouldNotReadInput</code></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token class-name">DispatchError</span><span class="token punctuation">::</span><span class="token class-name">CouldNotReadInput</span> <span class="token operator">=&gt;</span> <span class="token keyword">Self</span><span class="token punctuation">(</span><span class="token number">0x07</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>According to the expanded code of the contract macro, you can see that in the <code>dispatch_using_mode</code> function, <code>::ink_env::decode_input</code> is called before calling <code>execute</code>, and this function has a <code>return Error</code> situation. Therefore, it is reasonable to guess that an exception occurred when parsing <code>input</code>. The input parameter <code>args:0x008cb6611e0100000000000000000000</code> is recorded in the log. Observing this parameter, it can be found that its length is significantly smaller than the <code>u128</code> code. Therefore, it can be inferred from <code>args</code> and <code>env_trace</code> that an error occurred when decoding <code>input</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// this part code is expanded by erc20 example.</span>
<span class="token punctuation">::</span><span class="token namespace">ink_env<span class="token punctuation">::</span></span><span class="token function">decode_input</span><span class="token punctuation">::</span><span class="token operator">&lt;&lt;</span><span class="token class-name">Erc20</span> <span class="token keyword">as</span> <span class="token punctuation">::</span><span class="token namespace">ink_lang<span class="token punctuation">::</span></span><span class="token class-name">ConstructorDispatcher</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">Type</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">::</span><span class="token namespace">ink_lang<span class="token punctuation">::</span></span><span class="token class-name">DispatchError</span><span class="token punctuation">::</span><span class="token class-name">CouldNotReadInput</span><span class="token punctuation">)</span><span class="token operator">?</span>
</code></pre></div></li></ol></li></ol> <p>At this point, the contract instantiation is successful, but the constructor to execute the instantiation exists. Therefore, the contract exists on the chain but the process of <code>#[ink(constructor)]</code> is not executed normally.</p> <ol start="2"><li><p>The <code>call</code> stage, such as calling <code>transfer</code>:</p> <p>Calling <code>transfer</code> to the above successfully instantiated function, <code>ContractTrap</code> will appear, Europa's log shows as follows:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
	ext_result: <span class="token punctuation">[</span>failed<span class="token punctuation">]</span> ExecError <span class="token punctuation">{</span> error: DispatchError::Module <span class="token punctuation">{</span>index:5, error:17, message: Some<span class="token punctuation">(</span><span class="token string">&quot;ContractTrapped&quot;</span><span class="token punctuation">)</span>, orign: ErrorOrigin::Caller <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token comment"># ...</span>
    env_trace: <span class="token punctuation">[</span>
        seal_value_transferred<span class="token punctuation">(</span>Some<span class="token punctuation">(</span>0x0000000000000000<span class="token punctuation">))</span>,
    <span class="token punctuation">]</span>,
    wasm_error: Error::WasmiExecution<span class="token punctuation">(</span>Trap<span class="token punctuation">(</span>Trap <span class="token punctuation">{</span> kind: Unreachable <span class="token punctuation">}</span><span class="token punctuation">))</span>
    	wasm backtrace: 
    	<span class="token operator">|</span>  core::panicking::panic_fmt.60<span class="token punctuation">[</span><span class="token number">1743</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  core::result::unwrap_failed<span class="token punctuation">[</span><span class="token number">914</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  core::result::Result<span class="token operator">&lt;</span>T,E<span class="token operator">&gt;</span>::expect<span class="token punctuation">[</span><span class="token number">915</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  ink_lang::dispatcher::deny_payment<span class="token punctuation">[</span><span class="token number">1664</span><span class="token punctuation">]</span>
    	<span class="token operator">|</span>  call<span class="token punctuation">[</span><span class="token number">1691</span><span class="token punctuation">]</span>
    	╰─<span class="token operator">&gt;</span><span class="token operator">&lt;</span>unknown<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token number">2387</span><span class="token punctuation">]</span>
    ,
    nest: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
<span class="token punctuation">}</span>
</code></pre></div><p>First notice that the last record of <code>env_trace</code> is still not <code>seal_return</code>, and the error cause of <code>wasm_error</code> is <code>WasmiExecution::Unreachable</code>. Therefore, it can be determined that <code>panic</code> or <code>expect</code> was encountered during the execution of the contract.</p> <p>From the wasm backtrace, it is very obvious that the execution process is</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>   call -<span class="token operator">&gt;</span> deny_payment -<span class="token operator">&gt;</span> <span class="token function">expect</span>
</code></pre></div><p>According to the code expanded macro (<code>cd ink/examples/erc20; cargo expand&gt; tmp.rs</code>), we can see:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#[no_mangle]</span>
fn call<span class="token punctuation">(</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> u32 <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token boolean">true</span> <span class="token punctuation">{</span>
     ::ink_lang::deny_payment::<span class="token operator">&lt;&lt;</span>Erc20 as ::ink_lang::ContractEnv<span class="token operator">&gt;</span>::Env<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    		.expect<span class="token punctuation">(</span><span class="token string">&quot;caller transferred value even though all ink! message deny payments&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    ::ink_lang::DispatchRetCode::from<span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Erc20 as ::ink_lang::DispatchUsingMode<span class="token operator">&gt;</span>::dispatch_using_mode<span class="token punctuation">(</span>
            ::ink_lang::DispatchMode::Call,
        <span class="token punctuation">)</span>,
    <span class="token punctuation">)</span>
    .to_u32<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Therefore, it can be judged that an error was returned in <code>deny_payment</code> during the execution of the contract in the process of <code>transfer</code>, and the direct processing of the error as <code>expect</code> resulted in the execution result of <code>wasmi</code> being <code>Unreachable</code> Tracking the code of <code>deny_payment</code> can find that the function returns <code>expect</code> caused by <code>Error</code></p> <blockquote><p>Note，The relevant code is as follows:</p> <p>In <code>ink_lang</code> https://github.com/paritytech/ink/blob/master/crates/lang/src/dispatcher.rs#L140-L150</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">deny_payment</span><span class="token operator">&lt;</span><span class="token class-name">E</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token class-name">E</span><span class="token punctuation">:</span> <span class="token class-name">Environment</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> transferred <span class="token operator">=</span> <span class="token namespace">ink_env<span class="token punctuation">::</span></span><span class="token function">transferred_balance</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">E</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;encountered error while querying transferred balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> transferred <span class="token operator">!=</span> <span class="token operator">&lt;</span><span class="token class-name">E</span> <span class="token keyword">as</span> <span class="token class-name">Environment</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">Balance</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">0u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">DispatchError</span><span class="token punctuation">::</span><span class="token class-name">PaidUnpayableMessage</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>There will be a difference between the <code>off_chain</code> part and the <code>on_chain</code> part in the ink</strong>, <code>off_chain</code> will think that an error is returned at the stage of <code>ink_env::transferred_balance::&lt;E&gt;()</code>, so it is executing<code>After transferred_balance</code>, you will encounter <code>expect</code> which leads to <code>panic</code>, and part of <code>on_chain</code> is taken from the memory of wasm, it will normally get the characters corresponding to u128 length and decode to get <code>transferred</code>, which is just decoded The result will not meet expectations, causing <code>transferred!=0</code> to make <code>deny_payment</code> return an Error, and the part where <code>deny_payment</code> is called in the macro expansion of the contract triggers <code>expect</code></p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">if</span> <span class="token boolean">true</span> <span class="token punctuation">{</span>
    <span class="token punctuation">::</span><span class="token namespace">ink_lang<span class="token punctuation">::</span></span><span class="token function">deny_payment</span><span class="token punctuation">::</span><span class="token operator">&lt;&lt;</span><span class="token class-name">Erc20</span> <span class="token keyword">as</span> <span class="token punctuation">::</span><span class="token namespace">ink_lang<span class="token punctuation">::</span></span><span class="token class-name">ContractEnv</span><span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token class-name">Env</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;caller transferred value even though all ink! message deny payments&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Therefore, for wasm backtrace, <code>expect</code> appears when <code>deny_payment</code> is called in <code>call</code>, not when <code>transferred_balance</code> is called in <code>deny_payment</code>.</p> <p><strong>This example side shows that <code>ink!</code> currently does not completely correspond to the processing of <code>off_chain</code> and <code>on_chain</code>, and may cause difficult-to-check errors for contract users in some cases</strong></p></blockquote> <h2 id="verify-v0-2"><a href="#verify-v0-2" class="header-anchor">#</a> Verify v0.2</h2> <ul><li><p><s>Construct incorrect contracts and execute logs printing to determine whether it meets expectations</s></p></li> <li><p><s>Display the call statistics of the <code>define_env!</code> interface during contract execution</s></p> <ul><li><p>run test case <code>instantiate_return_code</code> in <a href="https://github.com/patractlabs/substrate/blob/europa-contracts/frame/contracts/src/tests.rs" target="_blank" rel="noopener noreferrer">patractlabs/substrate branch:europa-contracts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> europa/vendor/substrate/frame/contracts
$ cargo <span class="token builtin class-name">test</span> --package pallet-contracts --lib tests::instantiate_return_code -- --exact
<span class="token comment"># then you could see</span>
<span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
    caller: 0101010101010101010101010101010101010101010101010101010101010101 <span class="token punctuation">(</span>5C62Ck4U<span class="token punctuation">..</span>.<span class="token punctuation">)</span>,
<span class="token comment"># ...</span>
<span class="token punctuation">}</span>

<span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
<span class="token comment"># ...</span>
<span class="token punctuation">}</span>

<span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
<span class="token comment"># ...</span>
<span class="token punctuation">}</span>
<span class="token comment"># ...</span>
</code></pre></div></li> <li><p>run test case <code>run_out_of_gas</code> in <a href="https://github.com/patractlabs/substrate/blob/europa-contracts/frame/contracts/src/tests.rs" target="_blank" rel="noopener noreferrer">patractlabs/substrate branch:europa-contracts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> europa/vendor/substrate/frame/contracts
$ cargo <span class="token builtin class-name">test</span> --package pallet-contracts --lib tests::run_out_of_gas -- --exact
<span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
<span class="token comment"># ...</span>
<span class="token punctuation">}</span>

<span class="token number">1</span>: NestedRuntime <span class="token punctuation">{</span>
<span class="token comment">#...</span>
        gas<span class="token punctuation">(</span>None<span class="token punctuation">)</span>,
    <span class="token punctuation">]</span>,
    trap_reason: TrapReason::SupervisorError<span class="token punctuation">(</span>DispatchError::Module <span class="token punctuation">{</span> index: <span class="token number">0</span>, error: <span class="token number">6</span>, message: Some<span class="token punctuation">(</span><span class="token string">&quot;OutOfGas&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>,
    nest: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <p>Anyone can check whether the printed log matching with the test case.</p></li> <li><p><s>Execute the log printing function, provide formatted printing examples of different data, and judge whether it meets expectations</s></p> <p>Using <a href="https://github.com/patractlabs/ink-log" target="_blank" rel="noopener noreferrer"><code>ink-log</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in <code>ink!</code> example could test this part.</p></li> <li><p><s>Construct a contract that crashes under different conditions and record the log after execution. Then judge whether the backtrace information of the contract execution is completely printed, and check whether it matches the actual execution of the collapsed contract.</s></p> <p>We provide a test case repo <a href="https://github.com/patractlabs/europa_contracts_test_templates" target="_blank" rel="noopener noreferrer">europa_contracts_test_templates<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Any one could using Polkadot/Substrate Portal or RedSpot to deploy and call this test contract to verify this.</p></li></ul></div></section> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/patractlabs/substrate-contracts-book/edit/master/en/europa/reports/v0.2Report.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">8/2/2021, 10:29:17 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/substrate-contracts-book/en/europa/reports/v0.1Report.html" class="prev">
            Report for Europa v0.1
          </a></span> <span class="next"><a href="/substrate-contracts-book/en/europa/reports/v0.3Report.html">
            Report for Europa v0.3
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#report-for-europa-v0-2" class="sidebar-link reco-side-report-for-europa-v0-2" data-v-70334359>Report for Europa v0.2</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#recap-of-europa-s-future-plan" class="sidebar-link reco-side-recap-of-europa-s-future-plan" data-v-70334359>Recap of Europa's future plan</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#recap-of-verification-for-europa-v0-2" class="sidebar-link reco-side-recap-of-verification-for-europa-v0-2" data-v-70334359>Recap of verification for Europa v0.2:</a></li><li class="level-2" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#_1-design" class="sidebar-link reco-side-_1-design" data-v-70334359>1.Design</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#_1-1-on-pallet-contracts-layer" class="sidebar-link reco-side-_1-1-on-pallet-contracts-layer" data-v-70334359>1.1 on Pallet Contracts layer</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#_1-2-on-wasmi-layer" class="sidebar-link reco-side-_1-2-on-wasmi-layer" data-v-70334359>1.2 on wasmi layer</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#_1-3-contract-log-functions" class="sidebar-link reco-side-_1-3-contract-log-functions" data-v-70334359>1.3 Contract Log functions</a></li><li class="level-2" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#_2-what-europa-can-do-in-v0-2" class="sidebar-link reco-side-_2-what-europa-can-do-in-v0-2" data-v-70334359>2. What Europa can do in v0.2</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#_2-1-build" class="sidebar-link reco-side-_2-1-build" data-v-70334359>2.1 Build</a></li><li class="level-3" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#example" class="sidebar-link reco-side-example" data-v-70334359>example</a></li><li class="level-2" data-v-70334359><a href="/substrate-contracts-book/en/europa/reports/v0.2Report.html#verify-v0-2" class="sidebar-link reco-side-verify-v0-2" data-v-70334359>Verify v0.2</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/substrate-contracts-book/assets/js/app.c73dd8d7.js" defer></script><script src="/substrate-contracts-book/assets/js/3.7c35afa4.js" defer></script><script src="/substrate-contracts-book/assets/js/1.293685b3.js" defer></script><script src="/substrate-contracts-book/assets/js/78.6bde6f3a.js" defer></script>
  </body>
</html>
