(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{527:function(t,a,s){t.exports=s.p+"assets/img/call_other_1.5616f10c.png"},528:function(t,a,s){t.exports=s.p+"assets/img/call_other_2.647505f1.png"},641:function(t,a,s){"use strict";s.r(a);var n=s(6),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"europa-contract-execution-log-analysis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#europa-contract-execution-log-analysis"}},[t._v("#")]),t._v(" Europa contract execution log analysis")]),t._v(" "),n("p",[t._v("The structure for recording contract execution information in the current Europa "),n("code",[t._v("pallet-contract")]),t._v(" is as follows.")]),t._v(" "),n("div",{staticClass:"language-rust extra-class"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Record the contract execution context.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("pub")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token type-definition class-name"}},[t._v("NestedRuntime")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Current depth")]),t._v("\n    depth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("usize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The current contract execute result")]),t._v("\n        ext_result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecResultTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The value in sandbox successful result")]),t._v("\n        sandbox_result_ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Option")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReturnValue")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Who call the current contract")]),t._v("\n    caller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AccountId32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The account of the current contract")]),t._v("\n    self_account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Option")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AccountId32")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The input selector")]),t._v("\n    selector"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Option")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HexVec")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The input arguments")]),t._v("\n    args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Option")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HexVec")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The value in call or the endowment in instantiate")]),t._v("\n    value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("u128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The gas limit when this contract is called")]),t._v("\n    gas_limit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The gas left when this contract return")]),t._v("\n    gas_left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The host function call stack")]),t._v("\n    env_trace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnvTraceList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The error in wasm")]),t._v("\n    wasm_error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Option")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WasmErrorWrapper")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// The trap in host function execution")]),t._v("\n    trap_reason"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Option")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TrapReason")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// Nested contract execution context")]),t._v("\n    nest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vec")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NestedRuntime")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("The log example corresponding to this structure is as follows.")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ext_result: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("success"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ExecReturnValue "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" flags: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(", data:  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n    caller: d43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("5GrwvaEF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n    self_account: 0144d6fc570d7bddda6f8e36141f179cd172324599b556ef514193f3105865f6 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("5C6NMXaS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n    selector: 0x9bae9d5e,\n    args: 0x40420f00000000000000000000000000,\n    value: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000000000000000")]),t._v(",\n    gas_limit: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200000000000")]),t._v(",\n    gas_left: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("190018947968")]),t._v(",\n    env_trace: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        seal_input"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Some"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x9bae9d5e40420f00000000000000000000000000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(",\n        seal_caller"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Some"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n       seal_set_storage"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v("Some"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0300000001000000000000000000000000000000000000000000000000000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Some"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x000000000000000000000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n    sandbox_result_ok: Value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        I32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(",\n    nest: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"log-field-description"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#log-field-description"}},[t._v("#")]),t._v(" Log field description")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("Field")]),t._v(" "),n("th",[t._v("Description")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("1: NestedRuntime")]),t._v(" "),n("td",[t._v("Call the contract execution log with a depth of 1.")])]),t._v(" "),n("tr",[n("td",[t._v("ext_result")]),t._v(" "),n("td",[t._v("The execution result of the contract at the "),n("code",[t._v("pallet-contract")]),t._v(" level, there are two  cases: "),n("code",[t._v("[success]")]),t._v(" and "),n("code",[t._v("[failed]")]),t._v(". "),n("code",[t._v("[success]")]),t._v(" can only indicate that the execution was successful at the "),n("code",[t._v("pallet-contract")]),t._v(" level, but the business logic of the contract itself may throw an Error. The data value in "),n("code",[t._v("ExecResultValue {flag:0, data: 0x...}")]),t._v(" may be the return value of the contract, or the enumeration value of Error defined in the contract. "),n("code",[t._v("[failed]")]),t._v(" will be followed by an "),n("code",[t._v("ExecError {.. }")]),t._v(", the error message is defined in "),n("code",[t._v("pallet-contracts")]),t._v(".")])]),t._v(" "),n("tr",[n("td",[t._v("caller")]),t._v(" "),n("td",[t._v("The caller of this contract may be the user or another contract account. When the value is "),n("code",[t._v("0x000...")]),t._v(", it is called by RPC.")])]),t._v(" "),n("tr",[n("td",[t._v("self_account")]),t._v(" "),n("td",[t._v("Current contract account.")])]),t._v(" "),n("tr",[n("td",[t._v("selector")]),t._v(" "),n("td",[t._v("The function identifier passed to the contract, and the corresponding relationship can be queried in the metadata.json of the contract.")])]),t._v(" "),n("tr",[n("td",[t._v("args")]),t._v(" "),n("td",[t._v("The parameters passed to the contract calling function.")])]),t._v(" "),n("tr",[n("td",[t._v("value")]),t._v(" "),n("td",[t._v("Transfer amount to the current contract.")])]),t._v(" "),n("tr",[n("td",[t._v("gas_limit")]),t._v(" "),n("td",[t._v("The maximum amount of gas that can be used by the current contract.")])]),t._v(" "),n("tr",[n("td",[t._v("gas_left")]),t._v(" "),n("td",[t._v("The amount of gas remaining when exiting the current contract.")])]),t._v(" "),n("tr",[n("td",[t._v("env_trace")]),t._v(" "),n("td",[t._v("During the execution of the current contract, the call stack of host_function gives the parameters of each function in detail. Take seal_call as an example. If the input is Some(xxx) and the output is empty, then there may be an error in the process of calling each other between the contracts.")])]),t._v(" "),n("tr",[n("td",[t._v("trap_reason")]),t._v(" "),n("td",[t._v("The reason for trap encountered during host_function execution."),n("br"),t._v(" Return & Termination & Restoration: It is the normal exit strategy executed by the contract, not Error. "),n("br"),t._v("SupervisorError: DispatchError defined in "),n("code",[t._v("pallet_contracts")]),t._v(".")])]),t._v(" "),n("tr",[n("td",[t._v("wasm_error")]),t._v(" "),n("td",[t._v("If a Wasm execution error occurs in the contract, the Wasm call stack will be printed in this field. If and only if "),n("code",[t._v("ext_result")]),t._v(" is "),n("code",[t._v("[failed]")]),t._v(".")])]),t._v(" "),n("tr",[n("td",[t._v("sandbox_result_ok")]),t._v(" "),n("td",[t._v("If there is no "),n("code",[t._v("trap")]),t._v(" and no "),n("code",[t._v("wasm_error")]),t._v(" during the execution of host_function, then the contract is considered to be executed successfully and this field is printed. This field carries a "),n("code",[t._v("ReturnValue")]),t._v(" information. In "),n("code",[t._v("ink!")]),t._v(", if the value returned is not 0, then an Error defined in "),n("code",[t._v("ink!")]),t._v(" may have occurred, and the corresponding  "),n("a",{attrs:{href:"https://github.com/paritytech/ink/blob/abd5cf14c0883cb2d5acf81f2277aeec330aa843/crates/lang/src/error.rs#L66-L80",target:"_blank",rel:"noopener noreferrer"}},[t._v("DispatchError"),n("OutboundLink")],1),t._v(" needs to be queried.")])]),t._v(" "),n("tr",[n("td",[t._v("nest")]),t._v(" "),n("td",[t._v("Contract log of nested calls. If the current contract calls other contracts, the execution log of the called contract will be nested in this field.")])])])]),t._v(" "),n("h2",{attrs:{id:"contract-nested-call"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#contract-nested-call"}},[t._v("#")]),t._v(" Contract nested call")]),t._v(" "),n("p",[t._v("Examples of mutual calls between contracts are as follows.")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("In contract A, call contract C after calling contract B.")]),t._v(" "),n("p",[n("img",{attrs:{src:s(527),alt:""}})])])]),t._v(" "),n("p",[t._v("The log is as follows.")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tself_account: A,\n\tnest:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tself_account: B,\n\t\t\tnest:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tself_account: C,\n\t\t\tnest:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ul",[n("li",[n("p",[t._v("In contract A, call contract B, in contract B, call contract C")]),t._v(" "),n("p",[n("img",{attrs:{src:s(528),alt:""}})])])]),t._v(" "),n("p",[t._v("The log is as follows.")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        self_account: A,\n        nest:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        self_account: B,\n                        nest:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                                "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(": NestedRuntime "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                self_account: C,\n                                nest:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);