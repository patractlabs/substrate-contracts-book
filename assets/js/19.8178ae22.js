(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{512:function(e,t,o){e.exports=o.p+"assets/img/model.e59678d4.jpg"},559:function(e,t,o){"use strict";o.r(t);var a=o(6),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"contract-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#contract-model"}},[e._v("#")]),e._v(" Contract model")]),e._v(" "),a("p",[e._v("After we have the concept of contracts and contract sandboxes, we can begin to discuss the concept of contract models.")]),e._v(" "),a("p",[e._v("The contract sandbox only represents the environment in which the contract is run, and how the contract is run, how the contract interacts with the contract, and how the contract interacts with the data of the chain. These problems belong to the contract model problem.")]),e._v(" "),a("p",[e._v("In other words, the "),a("strong",[e._v("contract model is the model in which the contract runs in the contract sandbox/virtual machine")]),e._v(".")]),e._v(" "),a("p",[a("img",{attrs:{src:o(512),alt:""}})]),e._v(" "),a("p",[e._v("As shown in the figure, the contract model and the contract virtual machine can be decoupled in nature. The only relationship is whether the contract virtual machine can support the contract model required by the upper layer, for example:")]),e._v(" "),a("ul",[a("li",[e._v("Bitcoin's virtual machine is the stack executor of Bitcoin scripts. Since the executor design is a non-Turing complete OP_CODE, the upper-level contract model can only support Bitcoin scripts.")]),e._v(" "),a("li",[e._v("Ethereum follows the inspiration of Bitcoin and designed OP_CODE with Turing completeness, namely EVM Virtual Machine (Ethereum Virtual Machine). But the OP_CODE of EVM is relatively simple, and only has a stack design, without the concept of a heap. But EVM introduces the OP_CODE of read and write state, so the contract model can support the state model from the virtual machine mechanism. Therefore, the EVM is also regarded as a state transition machine that performs state transitions (as described in the Ethereum Yellow Paper written by Gavin Wood). The state model is actually a relatively general abstract model. Most models can be simulated with the state model (such as building a UTXO model in the state model). Therefore, theoretically, as long as you continue to improve the OP_CODE of the EVM, the upper layer of the EVM can also be used. Construct other contract models.")]),e._v(" "),a("li",[e._v("libra believes that the core of the blockchain lies in the processing of assets, so it proposes the Move Virtual Machine (MVM) model to limit the contract model from the virtual machine, which can be understood as a specialized logic OP_CODE collection. Therefore, the upper layer of MVM can only run the Move model.")])]),e._v(" "),a("p",[e._v("Through the above discussion, we can recognize the concept of the contract model and understand the limitations of the virtual machine on the upper-level contract model. Therefore, we can discuss the contract model that the Wasm virtual machine can run and the contract model composition of "),a("code",[e._v("pallet-contracts")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"wasm-virtual-machine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wasm-virtual-machine"}},[e._v("#")]),e._v(" Wasm Virtual Machine")]),e._v(" "),a("p",[e._v("Wasm is a binary instruction format that runs on a stack-based virtual machine. (WebAssembly (abbreviated Wasm) is a binary instruction format for a stack-based virtual machine, from "),a("a",{attrs:{href:"https://webassembly.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://webassembly.org/"),a("OutboundLink")],1),e._v(") So Wasmâ€™s model and mainstream computer program The model structure is relatively similar. On the other hand, Wasm is designed to be a more general form, and WASI is designed and supports the free definition of "),a("code",[e._v("host function")]),e._v(" in the operating environment. Therefore, although Wasm is developed from the browser, the current usage scenarios are not limited to browsing. It is beginning to take effect on edge computing, hot updates, and serverless platforms.")]),e._v(" "),a("p",[e._v("If the ability of a virtual machine is measured by the completeness of instructions, the EVM is at the level of a semi-finished product, which has many restrictions and is not flexible enough; while the JVM and Wasm virtual machines are relatively complete with few restrictions and strong functionality. On the other hand, the rationality of the instruction design will also affect the execution efficiency of the virtual machine to a certain extent, and the implementation scheme adopted by the virtual machine will also have a relatively large impact on the execution efficiency.")]),e._v(" "),a("p",[e._v("For example, EVM currently can only run in the form of an interpreter, and there is no optimization for the interpreter in the current implementation process body (go, c++, etc.), and the execution efficiency is relatively low, while virtual machines such as JVM and Wasm There are implementations using JIT mode, and the execution efficiency is quite high and even close to the performance of local execution.")]),e._v(" "),a("blockquote",[a("p",[e._v("Note: "),a("code",[e._v("pallet-contracts")]),e._v(" currently can only use "),a("code",[e._v("wasmi")]),e._v(" (interpreter) to execute Wasm code, so the execution performance of the contract is not as good as that of Runtime using "),a("code",[e._v("wasmtime")]),e._v(".")])]),e._v(" "),a("p",[e._v("At the same time, compared to virtual machines such as JVM, the Wasm virtual machine is very lightweight (lightweight), fast, and highly customizable. ** And the function of "),a("code",[e._v("host function")]),e._v(" gives the Wasm virtual machine a channel for interaction with the host** Therefore, compared with other virtual machines, it is easier to combine the Wasm virtual machine as a blockchain contract sandbox with the functions of the chain.")]),e._v(" "),a("p",[e._v("On the other hand, in the author's opinion, Wasm is a better abstraction layer between the bottom code and the upper code, and its complexity and completeness are far beyond EVM, so it is more suitable for the needs of the blockchain contract field.")]),e._v(" "),a("p",[e._v("Therefore, the sandbox environment provided by the Wasm virtual machine meets the following two requirements on the premise that the contract sandbox is satisfied:")]),e._v(" "),a("ul",[a("li",[e._v("Complete instructions, rich functionality, and high execution efficiency")]),e._v(" "),a("li",[e._v("There is a suitable interface that can interact with the host (here refers to the environment in which Wasm is running, that is, the chain), so that the host can provide the required functions.")])]),e._v(" "),a("h2",{attrs:{id:"evm-contract-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#evm-contract-model"}},[e._v("#")]),e._v(" EVM contract model")]),e._v(" "),a("p",[e._v("Since Ethereum is a blockchain that stores state, the contract model of EVM needs basic read and write state functions as it should. If the process of each contract operation is regarded as a process from the start of the program to the end of its execution, then the changes in the state data correspond to the changes in the data that the program needs to persist.")]),e._v(" "),a("p",[e._v("Therefore, for the read and write status, Ethereum's EVM provides two instructions, "),a("code",[e._v("SLOAD")]),e._v(" and "),a("code",[e._v("SSTORE")]),e._v(".")]),e._v(" "),a("p",[e._v('On the other hand, Ethereum describes an account using the "account model", that is, the contract and the user calling the contract are regarded as an account. Under this account, there are concepts such as '),a("code",[e._v("balance")]),e._v(", so EVM provides "),a("code",[e._v("CALLER")]),e._v(", "),a("code",[e._v("ORIGIN")]),e._v(", "),a("code",[e._v("CALLVALUE")]),e._v(" and a series of instructions to describe this model.")]),e._v(" "),a("p",[e._v('At the same time, because in the abstract system of EVM, the contract and the user are considered to be consistent, the model of "contract call contract" appears, namely '),a("code",[e._v("CALL")]),e._v(", "),a("code",[e._v("DELEGATECALL")]),e._v(" and other instructions, which brings the composability of the contract. Created a prosperous Ethereum ecosystem. In EVM, a contract relies on one EVM to run, so the contract calling contract starts another EVM in one EVM and loads instructions for execution.")]),e._v(" "),a("p",[e._v("Of course, the original intention of the EVM virtual machine design is to solve the problem of non-Turing completeness of the Bitcoin script. In order to solve this problem and ensure that the downtime problem does not occur, the instruction Gas billing model is introduced.")]),e._v(" "),a("p",[e._v("Therefore, in summary, the EVM contract model has the following characteristics:")]),e._v(" "),a("ol",[a("li",[e._v("The data processing model is a state machine model, and state changes are triggered by external calls (analogous to the process of calling a state change function);")]),e._v(" "),a("li",[e._v("The contract model requires chain-related features;")]),e._v(" "),a("li",[e._v("Treat the contract as consistent with the user and allow the contract to call the contract;")]),e._v(" "),a("li",[e._v("Introduce an instruction billing model.")])]),e._v(" "),a("h2",{attrs:{id:"the-contract-model-of-pallet-contracts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-contract-model-of-pallet-contracts"}},[e._v("#")]),e._v(" The contract model of "),a("code",[e._v("pallet-contracts")])]),e._v(" "),a("p",[e._v("Here is a direct conclusion: "),a("strong",[a("code",[e._v("pallet-contracts")]),e._v(" uses the Wasm virtual machine to execute code, but its contract model is basically the same as the EVM contract model")]),e._v(".")]),e._v(" "),a("p",[e._v("In other words, the contract model of "),a("code",[e._v("pallet-contracts")]),e._v(" also has the following 4 characteristics:")]),e._v(" "),a("ol",[a("li",[e._v("The data processing model is the state machine model;")]),e._v(" "),a("li",[e._v("The contract model requires chain-related features;")]),e._v(" "),a("li",[e._v("Treat the contract as consistent with the user and allow the contract to call the contract;")]),e._v(" "),a("li",[e._v("Introduce an instruction billing model.")])]),e._v(" "),a("p",[e._v('And, on the basis of the above 4 characteristics, a "storage leasing model" has been added:')]),e._v(" "),a("ul",[a("li",[a("code",[e._v("Rent")]),e._v(" storage lease billing.")])]),e._v(" "),a("p",[e._v("As mentioned above, the contract execution environment and contract model can be decoupled. Since the EVM was designed relatively early, there is no concept of decoupling this level, so the instructions in the instructions are "),a("code",[e._v("SLOAD")]),e._v(", "),a("code",[e._v("SSTORE")]),e._v(" and similar. The instructions are combined with other instructions of the EVM. And Wasm was not originally designed for the blockchain, so there must be no instructions related to the chain environment.")]),e._v(" "),a("p",[e._v("So Wasm's "),a("code",[e._v("host function")]),e._v(" is used to accomplish this. As the host of the host, the chain only needs to provide the methods that he thinks the contract may use to the Wasm virtual machine, and let him import these function objects, which can be used during the execution of the contract. Therefore, through the "),a("code",[e._v("host function")]),e._v(", the "),a("code",[e._v("pallet-contracts")]),e._v(" contract module can have 1, 2, and 4 functions, and will provide some of the functions required by 3, and the fifth feature (rental billing) can also be introduced.")]),e._v(" "),a("p",[e._v("And the implementation of the third function is also consistent with EVM. When there is a part of the contract calling the contract, it returns to the "),a("code",[e._v("pallet-contracts")]),e._v(" module from Wasm through the "),a("code",[e._v("host function")]),e._v(", and starts a new Wasm virtual machine to execute The contract being called. (This part will be described in a future article)")]),e._v(" "),a("p",[e._v("So in summary, the contract model of "),a("code",[e._v("pallet-contracts")]),e._v(" has the following characteristics:")]),e._v(" "),a("ol",[a("li",[e._v("The contract model is consistent with the EVM contract model, and a storage billing model is added on this basis")]),e._v(" "),a("li",[e._v("The interaction with the chain is realized through the "),a("code",[e._v("host function")]),e._v(" feature of Wasm")])]),e._v(" "),a("h2",{attrs:{id:"use-wasm-virtual-machine-to-implement-other-contract-models"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#use-wasm-virtual-machine-to-implement-other-contract-models"}},[e._v("#")]),e._v(" Use Wasm virtual machine to implement other contract models")]),e._v(" "),a("p",[e._v("I just briefly described how "),a("code",[e._v("pallet-contracts")]),e._v(" implements the contract model on the Wasm virtual machine. Since the previous article has explained that the virtual machine and the contract model can be decoupled, in fact, other things can also be implemented on the Wasm virtual machine. Contract model.")]),e._v(" "),a("p",[e._v("For example, we can consider porting the Move virtual machine to the Wasm virtual machine. There are two possible implementations:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Analogous to running the EVM implementation in the Runtime Wasm environment, the MVM implementation can also be compiled into the form of Wasm (for example, named "),a("code",[e._v("pallet-mvm")]),e._v(") and run in the Runtime Wasm.")]),e._v(" "),a("p",[e._v("Based on this implementation, Move can still be compiled in the normal way, and it is consistent with the compilation result of Solidity running on "),a("code",[e._v("pallet-evm")]),e._v(", and the result of Move compilation is run on a platform such as "),a("code",[e._v("pallet-mvm")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("Abstract the MVM, ownership, and chain-related features into a form of "),a("code",[e._v("pallet-contracts")]),e._v(", and design to compile the intermediate code IR compiled by the Move language to Wasm.")]),e._v(" "),a("p",[e._v("Based on this realization, Move can be compiled into Wasm and run in the Wasm virtual machine.")])])]),e._v(" "),a("h2",{attrs:{id:"other-contract-models"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-contract-models"}},[e._v("#")]),e._v(" Other contract models")]),e._v(" "),a("h3",{attrs:{id:"eos-contract-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eos-contract-model"}},[e._v("#")]),e._v(" EOS contract model")]),e._v(" "),a("p",[e._v("EOS's contract model is similar to EVM, while strengthening the concept of account model. Therefore, the way EOS uses Wasm is also based on the execution of Wasm, and introduces chain-related functions through "),a("code",[e._v("host function")]),e._v(".")]),e._v(" "),a("p",[e._v("The main difference between the EOS and EVM models is that the EOS contract calls the contract in the form of a transaction, and the EOS resource model is a mortgage model. At present, it is generally believed that it is the EOS mortgage model that ultimately led to EOS not succeeding.")]),e._v(" "),a("h3",{attrs:{id:"asynchronous-contract-model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#asynchronous-contract-model"}},[e._v("#")]),e._v(" Asynchronous contract model")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("pallet-actor")]),e._v(" is the beginning of Substrate's attempt to implement the asynchronous contract model, and there is currently no progress. The model of "),a("code",[e._v("pallet-actor")]),e._v(" intends to use the Wasm virtual machine as the operating environment, and on this basis add asynchronous functions to improve performance.")]),e._v(" "),a("p",[e._v("There are also a few other studies on asynchronous contract models, but they are all in a relatively preliminary stage.")])])}),[],!1,null,null,null);t.default=n.exports}}]);