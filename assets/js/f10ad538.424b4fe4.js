"use strict";(self.webpackChunksubstrate_contracts_book=self.webpackChunksubstrate_contracts_book||[]).push([[1191],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(n),d=o,h=m["".concat(s,".").concat(d)]||m[d]||c[d]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7479:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return m}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={},s="Custom ChainExtensions",p={unversionedId:"europa/extensions/custom-chain-extensions",id:"europa/extensions/custom-chain-extensions",isDocsHomePage:!1,title:"Custom ChainExtensions",description:"ChainExtensions allow chain authors to be able to augment the seal API with additional functions that provide functionality that goes beyond what is provided by the core API. This allows them to tailor seal to their use case. This customization does not modify the seal pallet.",source:"@site/docs/europa/extensions/custom-chain-extensions.md",sourceDirName:"europa/extensions",slug:"/europa/extensions/custom-chain-extensions",permalink:"/substrate-contracts-book/europa/extensions/custom-chain-extensions",editUrl:"https://github.com/patractlabs/substrate-contracts-book/edit/master/docs/europa/extensions/custom-chain-extensions.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Europa Wasm executor",permalink:"/substrate-contracts-book/europa/guides/wasm-executor"},next:{title:"Report for Europa proposals",permalink:"/substrate-contracts-book/europa/reports"}},u=[{value:"ink-log",id:"ink-log",children:[]},{value:"Usage",id:"usage",children:[{value:"1. Pallet-contracts in Substrate Runtime",id:"1-pallet-contracts-in-substrate-runtime",children:[]},{value:"2. Ink! contract",id:"2-ink-contract",children:[]},{value:"example",id:"example",children:[]},{value:"3. log extension func_id",id:"3-log-extension-func_id",children:[]}]},{value:"ZKP feature",id:"zkp-feature",children:[]}],c={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"custom-chainextensions"},"Custom ChainExtensions"),(0,r.kt)("p",null,"ChainExtensions allow chain authors to be able to augment the seal API with additional functions that provide functionality that goes beyond what is provided by the core API. This allows them to tailor seal to their use case. This customization does not modify the seal pallet. "),(0,r.kt)("h2",{id:"ink-log"},(0,r.kt)("a",{parentName:"h2",href:"https://github.com/patractlabs/ink-log"},"ink-log")),(0,r.kt)("p",null,"Please check  ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/ink-log"},"https://github.com/patractlabs/ink-log")," for more specifications."),(0,r.kt)("p",null,"Ink-log provides pretty log printing for ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/paritytech/ink"},"Ink!")," smart contract\uff0cit's implmented by ",(0,r.kt)("inlineCode",{parentName:"p"},"ChainExtension"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"dependencies")," "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"In newest ",(0,r.kt)("inlineCode",{parentName:"p"},"pallet-contracts")," and ink! version, the log feature has been enhanced. So the ",(0,r.kt)("inlineCode",{parentName:"p"},"ink-log")," is no longer needed."),(0,r.kt)("p",{parentName:"blockquote"},"We advice developer use ",(0,r.kt)("inlineCode",{parentName:"p"},"ink_env::debug_println!(...)")," instead of this ",(0,r.kt)("inlineCode",{parentName:"p"},"ink-log"),".")),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"1-pallet-contracts-in-substrate-runtime"},"1. Pallet-contracts in Substrate Runtime"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"runtime_log"),": In the ",(0,r.kt)("inlineCode",{parentName:"p"},"ink-log/runtime")," directory, this library is based on the contents of the ",(0,r.kt)("inlineCode",{parentName:"p"},"function_id")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"LoggerExt")," structures passed from ",(0,r.kt)("inlineCode",{parentName:"p"},"ChainExtensions")," to call the corresponding logs under debug in ",(0,r.kt)("inlineCode",{parentName:"p"},"frame_support")," to print. It is an implementation library of ",(0,r.kt)("inlineCode",{parentName:"p"},"ink_log")," prepared for developers of the chain. **For example, chain developers can use it in their own ChainExtensions:"),(0,r.kt)("p",null,"Add this to your ",(0,r.kt)("inlineCode",{parentName:"p"},"Cargo.toml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'runtime-log = { version = "0.1", git = "https://github.com/patractlabs/ink-log", default-features = false }\n\n[features]\nstd = [\n    "runtime-log/std",\n]\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"example")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"If you already have one ",(0,r.kt)("inlineCode",{parentName:"li"},"CustomExt"),", use ",(0,r.kt)("inlineCode",{parentName:"li"},"runtime_log::logger_ext!")," to add to your ",(0,r.kt)("inlineCode",{parentName:"li"},"CustomExt"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"pub struct CustomExt;\n\nimpl ChainExtension for CustomExt {\n    fn call<E: Ext>(func_id: u32, env: Environment<E, InitState>) -> Result<RetVal, DispatchError>\n    where\n        <E::T as SysConfig>::AccountId: UncheckedFrom<<E::T as SysConfig>::Hash> + AsRef<[u8]>,\n    {\n        // TODO add other libs\n        runtime_log::logger_ext!(func_id, env);\n\n        Ok(RetVal::Converging(0))\n    }\n\n    fn enabled() -> bool {\n        true\n    }\n}\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"If you don't have any ",(0,r.kt)("inlineCode",{parentName:"li"},"CustomExt"),", use ",(0,r.kt)("inlineCode",{parentName:"li"},"runtime_log::LoggerExt")," to set ",(0,r.kt)("inlineCode",{parentName:"li"},"ChainExtension"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},"impl pallet_contracts::Config for Runtime {\n    // ...... \n    type ChainExtension = runtime_log::LoggerExt;\n}\n")),(0,r.kt)("h3",{id:"2-ink-contract"},"2. Ink! contract"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ink_log"),": In the ",(0,r.kt)("inlineCode",{parentName:"p"},"ink-log/contracts")," directory, provide ",(0,r.kt)("inlineCode",{parentName:"p"},"info!"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"debug!"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"warn!"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"error!"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"trace!"),", same as Rust's log library in the same macro, and the call method of the macro is also the same. These macros are packaged implementations of seal_chain_extensions on the ink! side, and are tool library for contract developers. For example, after this library is introduced in the contract Cargo.toml, the log can be printed as follows:"),(0,r.kt)("p",null,"Add this to your contratc ",(0,r.kt)("inlineCode",{parentName:"p"},"Cargo.toml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'ink_log = { git = "https://github.com/patractlabs/ink-log", branch = "master", default-features = false, features = ["ink-log-chain-extensions"] }\n\n[features]\nstd = [\n    "ink_log/std",\n]\n')),(0,r.kt)("p",null,"Notes: must add feature ",(0,r.kt)("inlineCode",{parentName:"p"},"ink-log-chain-extensions")," feature, only when the feature is available, the ink-log functions is effective."),(0,r.kt)("h3",{id:"example"},"example"),(0,r.kt)("p",null,"Use like rust ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rust-lang/log"},"log")," macro"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#![cfg_attr(not(feature = "std"), no_std)]\n\nuse ink_lang as ink;\n\n#[ink::contract(env = ink_log::CustomEnvironment)]\npub mod flipper {\n    #[ink(storage)]\n    pub struct Flipper {\n        value: bool,\n    }\n\n    impl Flipper {\n        #[ink(constructor)]\n        pub fn new(init_value: bool) -> Self {\n            Self { value: init_value }\n        }\n\n        #[ink(message)]\n        pub fn flip(&mut self) {\n            ink_log::info!(target: "flipper-contract", "latest value is: {}", self.value);\n            \n            self.value = !self.value;\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"2020-12-28 17:44:30.274   INFO tokio-runtime-worker flipper-contract:/paritytech/ink/examples/flipper/lib.rs:42:\u2764\ufe0f  latest value is: false\n")),(0,r.kt)("h3",{id:"3-log-extension-func_id"},"3. log extension func_id"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"0xfeffff00\n")),(0,r.kt)("p",null,"other func_id refer to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/PIPs/blob/main/PIPs/pip-100.md"},"https://github.com/patractlabs/PIPs/blob/main/PIPs/pip-100.md")),(0,r.kt)("h2",{id:"zkp-feature"},"ZKP feature"),(0,r.kt)("p",null,"Check the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/zkmega"},"zkMega"),"\uff0cFor examples of related contracts, see ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/metis/tree/master/groth16"},"metis/groth16"),"\u3002"))}m.isMDXComponent=!0}}]);