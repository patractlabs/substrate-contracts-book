"use strict";(self.webpackChunksubstrate_contracts_book=self.webpackChunksubstrate_contracts_book||[]).push([[5165],{3905:function(t,e,n){n.d(e,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n,r,a={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var c=r.createContext({}),l=function(t){var e=r.useContext(c),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},p=function(t){var e=l(t.components);return r.createElement(c.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},d=r.forwardRef((function(t,e){var n=t.components,a=t.mdxType,i=t.originalType,c=t.parentName,p=s(t,["components","mdxType","originalType","parentName"]),d=l(n),m=a,g=d["".concat(c,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(g,o(o({ref:e},p),{},{components:n})):r.createElement(g,o({ref:e},p))}));function m(t,e){var n=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var c in e)hasOwnProperty.call(e,c)&&(s[c]=e[c]);s.originalType=t,s.mdxType="string"==typeof t?t:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},522:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return p},default:function(){return d}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={},c="Runtime Environment",l={unversionedId:"redspot/guides/runtime-environment",id:"redspot/guides/runtime-environment",isDocsHomePage:!1,title:"Runtime Environment",description:"The RedSpot Runtime Environment (RSE) contains all the publicly available functions of Redspot. When you import Redspot, you get an RSE environment.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/redspot/guides/runtime-environment.md",sourceDirName:"redspot/guides",slug:"/redspot/guides/runtime-environment",permalink:"/substrate-contracts-book/en/redspot/guides/runtime-environment",editUrl:"https://github.com/patractlabs/substrate-contracts-book/edit/master/docs/redspot/guides/runtime-environment.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Configuration",permalink:"/substrate-contracts-book/en/redspot/guides/configuration"},next:{title:"Console",permalink:"/substrate-contracts-book/en/redspot/guides/console"}},p=[{value:"Accessing RSE",id:"accessing-rse",children:[]},{value:"Extending RSE",id:"extending-rse",children:[{value:"config",id:"config",children:[]},{value:"redspotArguments",id:"redspotarguments",children:[]},{value:"run",id:"run",children:[]},{value:"network",id:"network",children:[]},{value:"artifacts",id:"artifacts",children:[]}]}],u={toc:p};function d(t){var e=t.components,n=(0,a.Z)(t,o);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"runtime-environment"},"Runtime Environment"),(0,i.kt)("p",null,"The RedSpot Runtime Environment (RSE) contains all the publicly available functions of Redspot. When you import Redspot, you get an RSE environment."),(0,i.kt)("h2",{id:"accessing-rse"},"Accessing RSE"),(0,i.kt)("p",null,"Env has the following attributes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"RuntimeEnvironment {\n    config; // the user's configuration file \n    redspotArguments; // global arguments to run the command, including network , logLevel, etc.\n    run; // function to run the command\n    network; // Contains attributes such as api , keyring etc.\n    artifacts; // the product of managing contract compilation\n}\n")),(0,i.kt)("p",null,"In the Redspot console, these properties of env will be injected as global variable which you can directly access them."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"> network.name\n'development'\n")),(0,i.kt)("p",null,"In ",(0,i.kt)("inlineCode",{parentName:"p"},".js")," or ",(0,i.kt)("inlineCode",{parentName:"p"},".ts")," files, you can access RSE by ",(0,i.kt)("inlineCode",{parentName:"p"},"import env from 'redspot'"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { config, redspotArguments, run, network, artifacts } from 'redspot';\n")),(0,i.kt)("h2",{id:"extending-rse"},"Extending RSE"),(0,i.kt)("p",null,"You can extend RSE through some plug-ins and add some additional properties or methods to RSE. For example, the ",(0,i.kt)("inlineCode",{parentName:"p"},"@redspot/patract")," plugin extends RSE and provides examples of patract. When a patract plugin is imported, you can access the patract instance in the following way."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { patract } from 'redspot';\nconsole.log(patract);\n")),(0,i.kt)("p",null,"Next, we will introduce each attribute of the built-in RSE in detail."),(0,i.kt)("h3",{id:"config"},"config"),(0,i.kt)("p",null,"config contains all the configuration options in redspot.config.ts\uff0cand contains the default settings, it is a Json object."),(0,i.kt)("p",null,"Get the currently configured default connection network."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { config } from 'redspot';\nconsole.log(config.defaultNetwork);\n")),(0,i.kt)("h3",{id:"redspotarguments"},"redspotArguments"),(0,i.kt)("p",null,"Global parameters of the currently running command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"> redspotArguments\n{\n  network: undefined,\n  showStackTraces: false,\n  version: false,\n  help: false,\n  config: undefined,\n  verbose: false,\n  logLevel: '2',\n  maxMemory: undefined,\n  tsconfig: undefined\n}\n")),(0,i.kt)("h3",{id:"run"},"run"),(0,i.kt)("p",null,"Through the run function, you can call tasks ending ",(0,i.kt)("inlineCode",{parentName:"p"},".js")," or",(0,i.kt)("inlineCode",{parentName:"p"},".ts")," from your script."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { run } from 'redspot';\nrun('test'); // run the test command\nrun('test', { testFiles: './tests/erc20.test.ts' }); // pass in parameters\n")),(0,i.kt)("h3",{id:"network"},"network"),(0,i.kt)("p",null,"Network contains the information about the network you are currently running. API keyring, signer and other information can be obtained through Network. The type of Network is defined as follows."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface Network {\n  name: string;\n  config: NetworkConfig;\n  provider: WsProvider;\n  api: ApiPromise;\n  registry: Registry;\n  keyring: Keyring;\n  getSigners(): Promise<Signer[]>;\n  createSigner(pair: KeyringPair): Signer;\n  gasLimit: BN;\n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"network.name: The name of the network currently in use."),(0,i.kt)("li",{parentName:"ul"},"network.config: The configuration options of the network currently in use, equivalent to",(0,i.kt)("inlineCode",{parentName:"li"},"config.networks[network.name]"),"."),(0,i.kt)("li",{parentName:"ul"},"network.provider: equivalent to an instance of ",(0,i.kt)("a",{parentName:"li",href:"https://polkadot.js.org/docs/api/start/create/#providers"},"wsprovider")," in Polkadot.js. They have the same interface. The endpoint configured in ",(0,i.kt)("inlineCode",{parentName:"li"},"redspot.config.ts")," will be used as the instantiation parameter of network.provider."),(0,i.kt)("li",{parentName:"ul"},"network.registry: equivalent to the instance of Registry in Polkadot.js, used to manage the type of codec. It also contains the type definitions configured by the user in ",(0,i.kt)("inlineCode",{parentName:"li"},"redspot.config.ts")," . For more details, please refer to ",(0,i.kt)("a",{parentName:"li",href:"https://polkadot.js.org/docs/api/start/types.create/"},"Type creation"),"."),(0,i.kt)("li",{parentName:"ul"},"network.keyring: equivalent to an instance of Keyring in Polkadot.js, the default is ss25519 type. After the API initialization is complete, the default value of ss58 will be set. For more information, see ",(0,i.kt)("a",{parentName:"li",href:"https://polkadot.js.org/docs/api/start/keyring"},"keyring"),"."),(0,i.kt)("li",{parentName:"ul"},"network.getSigners: The accounts configured",(0,i.kt)("inlineCode",{parentName:"li"},"in redspot.config.ts"),"will be parsed into signers. Through the getSigners function, all signers can be obtained, and one of the arrays corresponds to the account configured in accounts.")),(0,i.kt)("p",null,"Get all signers."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { network } from 'redspot';\nnetwork.getSigners().then(signers => {\n  console.log(signers[0].address);\n});\n")),(0,i.kt)("p",null,"In fact, the signer is compatible with the signer of Polkadot.js. The type of signer is defined as follows."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface Signer {\n  address: string;\n  api: ApiPromise;\n  pair: KeyringPair;\n  signPayload: (payload: SignerPayloadJSON) => Promise<SignerResult>;\n}\n")),(0,i.kt)("p",null,"You can also use it in Polkadot.js to sign transactions."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { network } from 'redspot';\nconst api = network.api\nasync run() {\n  const signers = await network.getSigners()\n  const from = signers[0]\n  const to = signers[1]\n  api.tx.balances.transfer(signer1.address, 100000000000).signAndSend({\n          signer: from\n  })\n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"network.createSigner\uff1aA signer can be generated through the createSigner function, which receives a keyringpair and converts it into a signer instance.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const pair = keyring.createFromUri(uri);\nconst signer = network.createSigner(pair);\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"network.gasLimit :It comes from gaslimt in config and is parsed into bn type.")),(0,i.kt)("h3",{id:"artifacts"},"artifacts"),(0,i.kt)("p",null,"Through ",(0,i.kt)("inlineCode",{parentName:"p"},"artifacts"),", you can access and manage Abi. Here are the properties of ",(0,i.kt)("inlineCode",{parentName:"p"},"artifacts"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface Artifacts {\n  readArtifact(contractName: string): Promise<AbiMetadata>;\n  readArtifactSync(contractName: string): AbiMetadata;\n  readAllArtifact(): Promise<AbiMetadata[]>;\n  readAllArtifactSync(): AbiMetadata[];\n  getArtifactPath(contractName: string): Promise<string>;\n  getArtifactPathSync(contractName: string): string;\n  artifactExists(contractName: string): Promise<boolean>;\n  getArtifactPaths(): Promise<string[]>;\n  copyToArtifactDir(paths: string[]): Promise<void>;\n}\n")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Field"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.readArtifact"),(0,i.kt)("td",{parentName:"tr",align:"left"},"You can get the metadata of the contract by the contract name, it will return a Json object")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.readArtifactSync"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Synchronized version of artifacts.readArtifact")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.readAllArtifact"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Get the metadata of all contracts")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.readAllArtifactSync"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Synchronized version of artifacts.readAllArtifact")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.getArtifactPath"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Get the file path of the metadata of the specified contract")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.getArtifactPathSync"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Synchronized version of artifacts.getArtifactPath")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.artifactExists"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Judge whether the metadata of a contract exists")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.getArtifactPaths"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Get the file path of the metadata of all contracts")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},"artifacts.copyToArtifactDir"),(0,i.kt)("td",{parentName:"tr",align:"left"},"Copy the file to the artifact directory")))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"artifacts.readArtifact")),(0,i.kt)("p",null,"Get the metadata of the contract through the contract name, and it will return a Json object containing compiled wasm code and abi."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"{\n  metadataVersion: string;\n  source: {\n    hash: string;\n    language: string;\n    compiler: string;\n    wasm: string;\n  };\n  contract: {\n    name: string;\n    version: string;\n    authors: string[];\n  };\n  types: any[];\n  spec: {\n    constructors: any[];\n    docs: any[];\n    events: any[];\n    messages: any[];\n  };\n}\n")))}d.isMDXComponent=!0}}]);