"use strict";(self.webpackChunksubstrate_contracts_book=self.webpackChunksubstrate_contracts_book||[]).push([[8905],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=o,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7190:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={},s="Quick Start",c={unversionedId:"ask/intro/quickstart",id:"ask/intro/quickstart",isDocsHomePage:!1,title:"Quick Start",description:"Setup Local blockchain node",source:"@site/docs/ask/intro/quickstart.md",sourceDirName:"ask/intro",slug:"/ask/intro/quickstart",permalink:"/substrate-contracts-book/ask/intro/quickstart",editUrl:"https://github.com/patractlabs/substrate-contracts-book/edit/master/docs/ask/intro/quickstart.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Overview",permalink:"/substrate-contracts-book/ask/intro/overview"},next:{title:"why-ask",permalink:"/substrate-contracts-book/ask/intro/why-ask"}},p=[{value:"Setup Local blockchain node",id:"setup-local-blockchain-node",children:[]},{value:"Frontend - Polkadot-js/apps",id:"frontend---polkadot-jsapps",children:[]},{value:"First ask! project - Flipper",id:"first-ask-project---flipper",children:[{value:"Setup ask env",id:"setup-ask-env",children:[]},{value:"Create <code>index.ts</code> in <code>flipper/contracts</code>, and copy the following code",id:"create-indexts-in-flippercontracts-and-copy-the-following-code",children:[]},{value:"Compile",id:"compile",children:[]},{value:"Deployment",id:"deployment",children:[]},{value:"Call your contract",id:"call-your-contract",children:[]}]},{value:"ERC20",id:"erc20",children:[{value:"Copy code from examples",id:"copy-code-from-examples",children:[]},{value:"Compile",id:"compile-1",children:[]},{value:"Deployment",id:"deployment-1",children:[]}]},{value:"Tutorial",id:"tutorial",children:[{value:"Inheritence",id:"inheritence",children:[]},{value:"Event",id:"event",children:[]},{value:"Storage",id:"storage",children:[]},{value:"Message",id:"message",children:[]}]}],u={toc:p};function d(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"quick-start"},"Quick Start"),(0,r.kt)("h2",{id:"setup-local-blockchain-node"},"Setup Local blockchain node"),(0,r.kt)("p",null,"We use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/europa"},"Europa")," as our default test node. We ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/europa/releases/tag/substrate-v3.0.0-2"},"v3.0.0-v2")," as our dev env."),(0,r.kt)("p",null,"For setup, please refer ",(0,r.kt)("a",{parentName:"p",href:"https://docs.patract.io/en/europa/intro/europa-cli"},"Europ-CLI")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.patract.io/en/europa/intro/europa-ui"},"Europa-UI"),"."),(0,r.kt)("h2",{id:"frontend---polkadot-jsapps"},"Frontend - Polkadot-js/apps"),(0,r.kt)("p",null,"For blockchain frontend, if you are using Europa-CLI, please install ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/polkadot-js/apps"},"Polkadot-js/apps"),". We use this ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/polkadot-js/apps/commit/11276477a0523348c7b143db566622aa32833296"},"commit")," as our development env."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you are using Europa-UI, you can skip this step, as Europa-UI comes with built-in GUI.")),(0,r.kt)("h2",{id:"first-ask-project---flipper"},"First ask! project - Flipper"),(0,r.kt)("h3",{id:"setup-ask-env"},"Setup ask env"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir flipper\ncd flipper\nnpx pl-ask-cli init\n")),(0,r.kt)("h3",{id:"create-indexts-in-flippercontracts-and-copy-the-following-code"},"Create ",(0,r.kt)("inlineCode",{parentName:"h3"},"index.ts")," in ",(0,r.kt)("inlineCode",{parentName:"h3"},"flipper/contracts"),", and copy the following code"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'@contract\nclass Flipper {\n    @state flag: bool;\n\n    constructor() {\n    }\n\n    @constructor\n    default(initFlag: bool): void {\n        this.flag = initFlag;\n    }\n\n    @message\n    flip(): void {\n        const v = this.flag;\n        this.flag = !v;\n    }\n\n    @message({"mutates": false})\n    get(): bool {\n        return this.flag;\n    }\n}\n')),(0,r.kt)("h3",{id:"compile"},"Compile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx pl-ask-cli compile contracts/index.ts\n")),(0,r.kt)("p",null,"Which creates ",(0,r.kt)("inlineCode",{parentName:"p"},"/build/index.wasm")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"/build/metadata.json"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},".wasm")," is the compiled binary file of your smart contract while ",(0,r.kt)("inlineCode",{parentName:"p"},"metadata.json")," defines ABI of your contract"),(0,r.kt)("h3",{id:"deployment"},"Deployment"),(0,r.kt)("p",null,"Whereas a completely new blob of smart contract source code is deployed each time you push a contract on other platforms, Substrate opts to optimize this behavior. For example, the standard ERC20 token has been deployed to Ethereum thousands of times, sometimes only with changes to the initial configuration (through the Solidity constructor function). Each of these instances take up space on the blockchain equivalent to the contract source code size, even though no code was actually changed."),(0,r.kt)("p",null,"In Substrate, the contract deployment process is split into two halves:"),(0,r.kt)("p",null,"Putting your code on the blockchain\nCreating an instance of your contract\nWith this pattern, contract code like the ERC20 standard can be put on the blockchain a single time, but instantiated any number of times. No need to continually upload the same source code over and waste space on the blockchain."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Start Europa and Polkadot.js/apps repectively"),(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("inlineCode",{parentName:"li"},"polkadot-js/apps")," contract tab, upload ",(0,r.kt)("inlineCode",{parentName:"li"},"build/metadata.json")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"build/index.wasm"),". "),(0,r.kt)("li",{parentName:"ul"},"Instantiate the uploaded contract and call ",(0,r.kt)("inlineCode",{parentName:"li"},"default")," to issue tokens.")),(0,r.kt)("h3",{id:"call-your-contract"},"Call your contract"),(0,r.kt)("p",null,"Flipper only has two functions, flip() and get() so we will show you what it's like to play with both of them. Click the Execute button under the contract after you instantiate the Flipper contract in the previous step."),(0,r.kt)("h2",{id:"erc20"},"ERC20"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir erc20\ncd erc20`\nnpx pl-ask-cli init\n")),(0,r.kt)("h3",{id:"copy-code-from-examples"},"Copy code from ",(0,r.kt)("a",{parentName:"h3",href:"https://github.com/patractlabs/ask/blob/v0.3-dev/examples/erc20"},"examples")),(0,r.kt)("p",null,"copy ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/ask/blob/v0.3-dev/examples/erc20/index.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"index.ts"))," and ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/patractlabs/ask/blob/v0.3-dev/examples/erc20/ERC20.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"ERC20.ts"))," to ",(0,r.kt)("inlineCode",{parentName:"p"},"erc20/contracts/"),"."),(0,r.kt)("h3",{id:"compile-1"},"Compile"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx pl-ask-cli compile contracts/index.ts\n")),(0,r.kt)("p",null,"Which creates ",(0,r.kt)("inlineCode",{parentName:"p"},"/build/index.wasm")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"/build/metadata.json")),(0,r.kt)("h3",{id:"deployment-1"},"Deployment"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Start Europa and Polkadot.js/apps repectively"),(0,r.kt)("li",{parentName:"ul"},"In ",(0,r.kt)("inlineCode",{parentName:"li"},"polkadot-js/apps")," contract tab, upload ",(0,r.kt)("inlineCode",{parentName:"li"},"build/metadata.json")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"build/index.wasm"),". "),(0,r.kt)("li",{parentName:"ul"},"Instantiate the uploaded contract and call ",(0,r.kt)("inlineCode",{parentName:"li"},"default")," to issue tokens."),(0,r.kt)("li",{parentName:"ul"},"Play around with ",(0,r.kt)("inlineCode",{parentName:"li"},"mint"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"transfer"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"approve"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"burn")," to operate this ERC20 contract.\n",(0,r.kt)("img",{parentName:"li",src:"https://user-images.githubusercontent.com/2844215/120952438-9cc61a00-c77d-11eb-9745-454f977184be.gif",alt:null}))),(0,r.kt)("h2",{id:"tutorial"},"Tutorial"),(0,r.kt)("h3",{id:"inheritence"},"Inheritence"),(0,r.kt)("p",null,"In ",(0,r.kt)("inlineCode",{parentName:"p"},"erc20/contracts"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ERC20.ts")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"class MyToken")," <-- ",(0,r.kt)("inlineCode",{parentName:"p"},"class ERC20 "),", ",(0,r.kt)("inlineCode",{parentName:"p"},"MyToken")," is a subclass of ",(0,r.kt)("inlineCode",{parentName:"p"},"ERC20"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"constructor")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," needs to be declared for every subclass(contract)"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'  constructor() {\n    super();\n  }\n\n  @constructor\n  default(name: string = "", symbol: string = ""): void {\n    super.default(name, symbol);\n  }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"expose functions with ",(0,r.kt)("inlineCode",{parentName:"li"}," @message")," decorator")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'  @message\n  @doc({"desc": "Mint a token"})\n  mint(to: AccountId, amount: u128): void {\n    this._mint(to, amount);\n  }\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"all class properties and methods are inherited by default.")),(0,r.kt)("h3",{id:"event"},"Event"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"@event\nclass Transfer extends Event {\n    @topic from: AccountId;\n    @topic to: AccountId;\n\n    amount: u128;\n\n\n    constructor(from: AccountId, to: AccountId, amount: u128) {\n      super();\n      this.from = from;\n      this.to = to;\n      this.amount = amount;\n    }\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Event")," decorator marks this class as an Event to be emitted during the contract execution. "),(0,r.kt)("li",{parentName:"ul"},"To emit an event ",(0,r.kt)("inlineCode",{parentName:"li"},"(new Transfer(sender, recipient, amount)).emit();")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@topic")," is equilvent of ",(0,r.kt)("inlineCode",{parentName:"li"},"indexed")," in solidity that allows to search topic parameters as filters.")),(0,r.kt)("h3",{id:"storage"},"Storage"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'@contract\nexport class ERC20 {\n  @state balances: SpreadStorableMap<AccountId, UInt128> = new SpreadStorableMap<AccountId, UInt128>();\n  @state allowances: SpreadStorableMap<AccountId, SpreadStorableMap<AccountId, UInt128>> = new SpreadStorableMap<AccountId, SpreadStorableMap<AccountId, UInt128>>();\n\n  @state totalSupply: u128 = u128.Zero;\n  @state name_: string = "";\n  @state symbol_: string = ""\n  @state decimal_: u8 = 0;}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@contract"),": the @constructor method is executable when the contract is instantiated. It defines this class as a contract."),(0,r.kt)("li",{parentName:"ul"},"@state: a blockchain state variable, the value will be synced to blockchain when contract is executed"),(0,r.kt)("li",{parentName:"ul"},"class properties without decorators are regular class properties")),(0,r.kt)("h3",{id:"message"},"Message"),(0,r.kt)("p",null,"Methods with ",(0,r.kt)("inlineCode",{parentName:"p"},"@message")," decorator will be exposed to blockchain as contract methods."),(0,r.kt)("h4",{id:"immutable-message"},"Immutable Message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'  @message({ "mutates": false })\n  symbol(): string {\n    return this.symbol_;\n  }\n')),(0,r.kt)("p",null,"If ",(0,r.kt)("inlineCode",{parentName:"p"},'@message({ "mutates": false })'),", it means this message does not needs to mutate the blockchain state. This method can be called with an RPC call without a blockchain transaction(no gas)."),(0,r.kt)("h4",{id:"mutable-message"},"Mutable Message"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"  @message\n  transfer(recipient: AccountId, amount: u128): bool {\n    let from = msg.sender;\n    this._transfer(from, recipient, amount);\n    return true;\n  }\n")),(0,r.kt)("p",null,"When no ",(0,r.kt)("inlineCode",{parentName:"p"},'{ "mutates": false }')," is annotated in ",(0,r.kt)("inlineCode",{parentName:"p"},"@message"),", it means this message will mutate the blockchain state. This method can only be called with a blockchain transaction(requires gas)."),(0,r.kt)("h4",{id:"privateprotected-methods"},"Private/Protected Methods"),(0,r.kt)("p",null,"Methods without ",(0,r.kt)("inlineCode",{parentName:"p"},"@message")," are internal functions. Same as grammer of Typescript, protected methods can be inherited in child classes."))}d.isMDXComponent=!0}}]);