<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Report for zkMega v0.1ï¼ˆoriginal Megaclite v0.1 ) | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/en/zkmega/reports/v0.1Report"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Report for zkMega v0.1ï¼ˆoriginal Megaclite v0.1 ) | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="5 weeks ago, Patract Hub applied a treasury proposal #24 for Megaclite v0.1. Megaclite project will be dedicated to introducing basic zero-knowledge proof underlying support for the Polkadot ecology, so that developers can easily develop applications at the upper level through WASM smart contracts or Runtime."><meta data-react-helmet="true" property="og:description" content="5 weeks ago, Patract Hub applied a treasury proposal #24 for Megaclite v0.1. Megaclite project will be dedicated to introducing basic zero-knowledge proof underlying support for the Polkadot ecology, so that developers can easily develop applications at the upper level through WASM smart contracts or Runtime."><link data-react-helmet="true" rel="shortcut icon" href="/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/en/zkmega/reports/v0.1Report"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/zkmega/reports/v0.1Report" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/en/zkmega/reports/v0.1Report" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/zkmega/reports/v0.1Report" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/en/assets/js/runtime~main.0df25487.js" as="script">
<link rel="preload" href="/en/assets/js/main.9e69ee6e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><img src="/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Site</b></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/zkmega/reports/v0.1Report" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡</a></li><li><a href="/en/zkmega/reports/v0.1Report" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/en/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/introduction">Substrate contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/overview">Contract overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/model">Contract model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/language">Contract language</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/contracts/wasm_first_step">Brief introduction of Wasm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/en/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">zkMega</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/introduction">zkMega</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/tutorial">tutorial</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/contract">Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/example">Example</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/benchmark">Benchmark</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Reports</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/reports">Report for zkMega proposals</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/en/zkmega/reports/v0.1Report">Report for zkMega v0.1ï¼ˆoriginal Megaclite v0.1 )</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/en/zkmega/reports/v0.2Report">Report for zkMega v0.2ï¼ˆoriginal Megaclite v0.2 )</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Metis</a></li><li class="menu__list-item"><a class="menu__link" href="/en/carpo/introduction">Carpo</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PatraStore</a></li><li class="menu__list-item"><a class="menu__link" href="/en/patract/introduction">Patract</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Report for zkMega v0.1ï¼ˆoriginal Megaclite v0.1 )</h1></header><p>5 weeks ago, <a href="https://patract.io" target="_blank" rel="noopener noreferrer">Patract Hub</a> applied a <a href="https://polkadot.polkassembly.io/treasury/24" target="_blank" rel="noopener noreferrer">treasury proposal #24</a> for Megaclite v0.1. Megaclite project will be dedicated to introducing basic zero-knowledge proof underlying support for the Polkadot ecology, so that developers can easily develop applications at the upper level through WASM smart contracts or Runtime. </p><p>Now, we have finished all the works of v0.1 and you can review our source code at those repos. We will introduce more details at the following report.</p><ul><li>ZKP library: <a href="https://github.com/patractlabs/megaclite" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/megaclite</a></li><li>Testnet example: <a href="https://github.com/patractlabs/jupiter" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/jupiter</a></li><li>Contract example: <a href="https://github.com/patractlabs/metis" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/metis</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-recap-of-megaclites-development-plan-v01--v03"></a>1. Recap of Megacliteâ€™s development plan (v0.1 ~ v0.3)<a class="hash-link" href="#1-recap-of-megaclites-development-plan-v01--v03" title="Direct link to heading">#</a></h2><ul><li><del>v0.1: Provide on-chain support for elliptic curve alt_bn128 and bls12_381 and bls12-377, bw6_761</del><ul><li>Integrate addition (ADD), scalar multiplication (MUL) and Pairing functions of the curves in Native layer and Runtime WASM layer.</li><li>Provide these three functions to the upper Runtime Pallets and Contracts to call.</li><li>In the Runtime layer and the Ink! contract layer, provide two zkSNARK Verify upper-layer interfaces ( verification function of groth16, similar to the Verifier library of  <a href="https://github.com/HarryR/ethsnarks" target="_blank" rel="noopener noreferrer">ethsnarks</a> ).</li><li>Start the Metis project and implement EdDSA, MerkleTree, MiMC Hash, etc. contract library on the Ink! contract layer.</li></ul></li><li>v0.2: Provide off-chain toolbox support for Ink! contract </li><li>v0.3: Create a sample payment DApp based on Megaclite</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-support-and-benchmark-basic-units-in-native-layer-and-wasm-layer"></a>2. Support and benchmark basic units in Native layer and WASM layer.<a class="hash-link" href="#2-support-and-benchmark-basic-units-in-native-layer-and-wasm-layer" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="21-encapsulate-crypto-units-of-the-four-curves-from-arkworks"></a>2.1 Encapsulate crypto units of the four curves from arkworks<a class="hash-link" href="#21-encapsulate-crypto-units-of-the-four-curves-from-arkworks" title="Direct link to heading">#</a></h3><ul><li>Arkworks library: <a href="https://github.com/arkworks-rs/curves" target="_blank" rel="noopener noreferrer">https://github.com/arkworks-rs/curves</a>. </li><li>Source: <a href="https://github.com/patractlabs/megaclite/blob/master/crates/curve/arkworks/src/ops.rs" target="_blank" rel="noopener noreferrer">megaclite/blob/master/crates/curve/arkworks/src/ops.rs</a></li><li>Test cases: <a href="https://github.com/patractlabs/megaclite/tree/master/crates/curve/arkworks/src/tests" target="_blank" rel="noopener noreferrer">megaclite/tree/master/crates/curve/arkworks/src/tests</a></li></ul><p>We inherited the <code>PairingEngine</code> trait through the <code>CurveBasicOperations</code> trait and combined the three methods of ADD, MUL, and Pairings:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn add(input: &amp;[u8]) -&gt; Result&lt;Vec&lt;u8&gt;, SerializationError&gt; { \\omit }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn mul(input: &amp;[u8]) -&gt; Result&lt;Vec&lt;u8&gt;, SerializationError&gt; { \\omit }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fn pairings(input: &amp;[u8]) -&gt; Result&lt;bool, SerializationError&gt; { \\omit }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Three of the methods are exposed to the Runtime and ink! layers with byte slice interfaces. ADD and MUL return elliptic curve points in byte vector. Pairings are internally paired and accumulated in batches, and the result is then compared with <code>Fqk::one()</code>. Return true if they are equal, otherwise just return.</p><p>The <code>CurveBasicOperations</code> trait also encapsulates some different elliptic curve parameters needed to write groth16 verification code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// curve basic parameters</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const SCALAR_FIELD: &amp;&#x27;static str;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const MODULUS: &amp;&#x27;static [u8];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// G1 bytes length</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const G1_LEN: usize;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// G2 bytes length</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const G2_LEN: usize;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Scalar bytes length</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const SCALAR_LEN: usize;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Curve ID is used for adaptation chain extension </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const CURVE_ID: u32;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="22-import-megaclite-through-host-calls-in-native-layer"></a>2.2 Import Megaclite through host calls in Native layer.<a class="hash-link" href="#22-import-megaclite-through-host-calls-in-native-layer" title="Direct link to heading">#</a></h3><ul><li>Exampleï¼š<a href="https://github.com/patractlabs/jupiter/blob/features/runtime-interfaces/primitives/io/src/lib.rs" target="_blank" rel="noopener noreferrer">jupiter/blob/features/runtime-interfaces/primitives/io/src/lib.rs</a></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Pairing runtime interface</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[runtime_interface]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub trait Pairing {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// | curve     | add        | mul        | pairing    |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// |-----------|------------|------------|------------|</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// | bls12_377 | 0x01000000 | 0x01000001 | 0x01000002 |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// | bls12_381 | 0x01000010 | 0x01000011 | 0x01000012 |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// | bn254     | 0x01000020 | 0x01000021 | 0x01000022 |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// | bw6_761   | 0x01000030 | 0x01000031 | 0x01000032 |</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn call(func_id: u32, input: &amp;[u8]) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        curve::call(func_id, input).ok()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="23-import-megaclite-as-runtime-library-in-wasm-layer"></a>2.3 Import Megaclite as Runtime library in WASM layer<a class="hash-link" href="#23-import-megaclite-as-runtime-library-in-wasm-layer" title="Direct link to heading">#</a></h3><ul><li>Exampleï¼š<a href="https://github.com/patractlabs/jupiter/blob/features/runtime-interfaces/pallets/template/src/lib.rs" target="_blank" rel="noopener noreferrer">jupiter/blob/features/runtime-interfaces/pallets/template/src/lib.rs</a></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Cargo.toml</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies.curve]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">package = &quot;megaclite-arkworks&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git = &quot;https://github.com/patractlabs/megaclite.git&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">features = [&quot;tests&quot;]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-features = false</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>megaclite-arkworks</code> supports <code>no_std</code>ï¼Œso we can import it directly in Runtime layer.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//! lib.rs</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">decl_module! {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[weight = 10_000 + T::DbWeight::get().writes(1)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn wasm_bls12_377_add(origin) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        curve::tests::add(0x2a);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="24-benchmark-of-basic-units"></a>2.4 Benchmark of basic units<a class="hash-link" href="#24-benchmark-of-basic-units" title="Direct link to heading">#</a></h3><p>You can build the program like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Clone the branch `curve-benchmark` of our fork</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/patractlabs/jupiter.git </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --branch features/runtime-interfaces </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --depth</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Build the template</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> jupiter  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> submodule update --init </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> cargo build -p jupiter-dev --all-features --release</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Check the command benchmark works fine</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./target/release/jupiter-dev benchmark -p pallet_template -e wasm_bls_12_381_add</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, run the benchmark scripts like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 1. Under the jupiter repo</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 2. Has compiled the release version jupiter-dev</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./target/benchmark.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Our benchmark result on ubuntu LTS 20.04. Time is measured in Âµs</strong></p><table><thead><tr><th>memory</th><th>processor</th></tr></thead><tbody><tr><td>64GiB System memory</td><td>AMD Ryzen 9 5900X 12-Core Processor</td></tr></tbody></table><table><thead><tr><th>Curve</th><th>Operation</th><th>Native Time(Âµs)</th><th>WASM Time(Âµs)</th><th>Speed(Native/WASM)</th></tr></thead><tbody><tr><td>bls12_377</td><td>add</td><td>9.588</td><td>29.02</td><td>~3x</td></tr><tr><td>(~9.5x)</td><td>mul</td><td>183.1</td><td>1893</td><td>~10x</td></tr><tr><td></td><td>pairing_two</td><td>1732</td><td>15310</td><td>~7x</td></tr><tr><td>bls12_381</td><td>add</td><td>13.9</td><td>28.31</td><td>~2x</td></tr><tr><td>(~10x)</td><td>mul</td><td>177.1</td><td>1879</td><td>~10x</td></tr><tr><td></td><td>pairing_two</td><td>1438</td><td>14770</td><td>~10x</td></tr><tr><td>bn254</td><td>add</td><td>5.631</td><td>16.05</td><td>~3x</td></tr><tr><td>(~5x)</td><td>mul</td><td>107.7</td><td>534.3</td><td>~5x</td></tr><tr><td></td><td>pairing_two</td><td>1150</td><td>5061</td><td>~5x</td></tr><tr><td>bw6_761</td><td>add</td><td>26.9</td><td>92.94</td><td>~4x</td></tr><tr><td>(~13x)</td><td>mul</td><td>956.8</td><td>14330</td><td>~15x</td></tr><tr><td></td><td>pairing_two</td><td>5715</td><td>60960</td><td>~10x</td></tr></tbody></table><ul><li>ADD: Test the addition of two generators by the test cases from arkworks.</li><li>MUL: Test a random number with the size of a private key and multiply the generator by the test cases from arkworks.</li><li>Pairing:  Test <code>bilinearity: e(s * a, b) = e(s * b, a)</code> by using arkworks to generate test data.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-provide-and-benchmark-groth16-verifier--in-ink-layer"></a>3. Provide and benchmark Groth16 Verifier  in ink! layer<a class="hash-link" href="#3-provide-and-benchmark-groth16-verifier--in-ink-layer" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="31-introduction-of-groth16-verification"></a>3.1 Introduction of Groth16 Verification<a class="hash-link" href="#31-introduction-of-groth16-verification" title="Direct link to heading">#</a></h3><ul><li>Sourceï¼š<a href="https://github.com/patractlabs/megaclite/blob/master/crates/curve/arkworks/src/groth16/verify.rs" target="_blank" rel="noopener noreferrer">megaclite/blob/master/crates/curve/arkworks/src/groth16/verify.rs</a></li><li>Test casesï¼š<a href="https://github.com/patractlabs/megaclite/blob/master/tests/src/arkworks/bench.rs" target="_blank" rel="noopener noreferrer">megaclite/blob/master/tests/src/arkworks/bench.rs</a></li></ul><p><a href="https://eprint.iacr.org/2016/260.pdf" target="_blank" rel="noopener noreferrer">gronth16</a> is currently the zero-knowledge proof algorithm with the highest verification efficiency (only four pairings are required) and the smallest proof size, so we prefer to choose Groth16 proof system, its verification illustration is as follows:</p><p><img src="https://i.imgur.com/MoEKfTK.png"></p><p>In the paper, we can see that the core of verification is an equation:</p><p>  <img src="https://i.imgur.com/GBIEHmE.png"></p><p>For the convenience of use in the project implementation, the underlying pairing algorithm provide batch pairing calculation and accumulation, so we need to make a conversion:</p><p><img src="https://i.imgur.com/r9MZOmr.png"></p><p>It can be seen from the formula that four Pairings, l times ADD and MUL operation (related to the actual circuit) are required, and finally, the result of the four pairings will return true or false.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="32-expose-megaclite-basic-units-for-ink-contract-to-call-through-chain-extension"></a>3.2 Expose Megaclite basic units for ink! contract to call through chain-extension<a class="hash-link" href="#32-expose-megaclite-basic-units-for-ink-contract-to-call-through-chain-extension" title="Direct link to heading">#</a></h3><ul><li>Chain extension example: <a href="https://github.com/patractlabs/jupiter/blob/features/runtime-interfaces/primitives/chain-extension/src/lib.rs" target="_blank" rel="noopener noreferrer">jupiter/blob/features/runtime-interfaces/primitives/chain-extension/src/lib.rs</a></li><li>Test caseï¼š<a href="https://github.com/patractlabs/jupiter/blob/features/runtime-interfaces/pallets/template/src/tests.rs" target="_blank" rel="noopener noreferrer">jupiter/blob/features/runtime-interfaces/pallets/template/src/tests.rs</a></li></ul><p>Our allocation for Megaclite function id in chain extension:</p><table><thead><tr><th>curve</th><th>add</th><th>mul</th><th>pairing</th></tr></thead><tbody><tr><td>bls12_377</td><td>0x01000000</td><td>0x01000001</td><td>0x01000002</td></tr><tr><td>bls12_381</td><td>0x01000010</td><td>0x01000011</td><td>0x01000012</td></tr><tr><td>bn254</td><td>0x01000020</td><td>0x01000021</td><td>0x01000022</td></tr><tr><td>bw6_761</td><td>0x01000030</td><td>0x01000031</td><td>0x01000032</td></tr></tbody></table><p>The corresponding interface of Megaclite supports chain extension (called from ink! contract) through conditional compilation or directly executes related functions.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//! https://github.com/patractlabs/megaclite/blob/master/crates/curve/arkworks/src/lib.rs</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Call curve functions using chain extensions</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg(feature = &quot;ink&quot;)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn call(func_id: u32, input: &amp;[u8]) -&gt; Result&lt;Vec&lt;u8&gt;&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(ink_env::call_chain_extension(func_id, &amp;Vec::from(input))?)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Call curve functions directly</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg(not(feature = &quot;ink&quot;))]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn call(func_id: u32, input: &amp;[u8]) -&gt; Result&lt;Vec&lt;u8&gt;&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(match func_id {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000000 =&gt; &lt;ark_bls12_377::Bls12_377 as CurveBasicOperations&gt;::add(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000010 =&gt; &lt;ark_bls12_381::Bls12_381 as CurveBasicOperations&gt;::add(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000020 =&gt; &lt;ark_bn254::Bn254 as CurveBasicOperations&gt;::add(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000030 =&gt; &lt;ark_bw6_761::BW6_761 as CurveBasicOperations&gt;::add(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000001 =&gt; &lt;ark_bls12_377::Bls12_377 as CurveBasicOperations&gt;::mul(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000011 =&gt; &lt;ark_bls12_381::Bls12_381 as CurveBasicOperations&gt;::mul(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000021 =&gt; &lt;ark_bn254::Bn254 as CurveBasicOperations&gt;::mul(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000031 =&gt; &lt;ark_bw6_761::BW6_761 as CurveBasicOperations&gt;::mul(input),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000002 =&gt; &lt;ark_bls12_377::Bls12_377 as CurveBasicOperations&gt;::pairings(input).map(b2b),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000012 =&gt; &lt;ark_bls12_381::Bls12_381 as CurveBasicOperations&gt;::pairings(input).map(b2b),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000022 =&gt; &lt;ark_bn254::Bn254 as CurveBasicOperations&gt;::pairings(input).map(b2b),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        0x01000032 =&gt; &lt;ark_bw6_761::BW6_761 as CurveBasicOperations&gt;::pairings(input).map(b2b),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _ =&gt; Err(Error::new(ErrorKind::Other, &quot;Invalid function id&quot;).into()),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }?)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="33-call-megaclite-basic-units-in-ink-contract-to-provide-groth16-verifier"></a>3.3 Call Megaclite basic units in ink! contract to provide Groth16 Verifier<a class="hash-link" href="#33-call-megaclite-basic-units-in-ink-contract-to-provide-groth16-verifier" title="Direct link to heading">#</a></h3><ul><li>Source: <a href="https://github.com/patractlabs/metis/tree/master/groth16/lib.rs" target="_blank" rel="noopener noreferrer">metis/tree/master/groth16/lib.rs</a></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly toml"><pre tabindex="0" class="prism-code language-toml codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies.curve]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">package = &quot;megaclite-arkworks&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git = &quot;https://github.com/patractlabs/megaclite&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">features = [ &quot;ink&quot; ]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Enable chain extension interfaces of Megaclite by using <code>ink</code> feautre.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ink! contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn bls12_377_verify(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vk_gamma_abc: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vk: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    proof: Vec&lt;u8&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public_inputs: Vec&lt;Vec&lt;u8&gt;&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; bool {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if let Ok(res) = groth16::verify::&lt;Bls12_377&gt;(&amp;vk_gamma_abc, &amp;vk, &amp;proof, &amp;public_inputs) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        res</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        false</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="34-benchmark-of-groth16-verifier"></a>3.4 Benchmark of Groth16 Verifier<a class="hash-link" href="#34-benchmark-of-groth16-verifier" title="Direct link to heading">#</a></h2><ul><li>Source: <a href="https://github.com/patractlabs/jupiter/blob/19a1fb3a21e04a5e14b33a0f25c6f10e059cc6ea/pallets/template/src/benchmarking.rs#L68" target="_blank" rel="noopener noreferrer">jupiter pallets/template/src/benchmarking.rs#L68</a></li></ul><p>You can build Jupiter by using the same way of aboveï¼Œbut we need to pass  <code>groth16</code>  to  <code>scripts/benchmark.sh</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 1. Under the jupiter repo</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 2. Has compiled the release version jupiter-dev</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./target/benchmark.sh groth16</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Our MiMC-Based Groth16 Verify Benchmark Results:</p><ul><li>mimc rounds : 322</li></ul><table><thead><tr><th>Curve</th><th>Native Time(Âµs)</th><th>WASM Time(Âµs)</th><th>Speed(Native/WASM)</th></tr></thead><tbody><tr><td>bls12_377</td><td>40860</td><td>60550</td><td>~1.5x</td></tr><tr><td>bls12_381</td><td>39120</td><td>58400</td><td>~1.5x</td></tr><tr><td>bn254</td><td>30760</td><td>36800</td><td>~1.2x</td></tr><tr><td>bw6_761</td><td>63798</td><td>172900</td><td>~2.7x</td></tr></tbody></table><blockquote><p>NOTE: The implementation of MiMC-Based Groth16 Verifier here is that when Megaclite is imported into the contract, the verify function of ADD, MUL, Pairing can be run by calling the chain extension.
Test contract: <a href="https://github.com/patractlabs/metis/blob/master/groth16/lib.rs" target="_blank" rel="noopener noreferrer">https://github.com/patractlabs/metis/blob/master/groth16/lib.rs</a></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-conclusion-of-native-version-and-wasm-version"></a>4. Conclusion of Native version and WASM version<a class="hash-link" href="#4-conclusion-of-native-version-and-wasm-version" title="Direct link to heading">#</a></h2><p>According to the test results of the basic units , there is 5-7 times gap between the performance of the WASM version and the Native version. But, <strong>according to the test results of upper-level ink! contract for MiMC Groth16 Verifier, the speed only has little difference, and the time consumption (36-170ms) is acceptable for the block producer.</strong></p><p>The WASM version does not need to modify the Host Calls in Native layer, so Megaclite will continue to develop the future roadmap in WASM layer, and suspend the development direction of the Native layer, leaving the native layer design to ParityTech and W3F Research. In addition, Jupiter will integrate Megaclite in runtime and ink! to provide a public online test environment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-more-library-contracts-built-by-ink"></a>5. More library contracts built by ink!<a class="hash-link" href="#5-more-library-contracts-built-by-ink" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="51-mimc-based-merkle-tree"></a>5.1 MiMC-based Merkle Tree<a class="hash-link" href="#51-mimc-based-merkle-tree" title="Direct link to heading">#</a></h3><ul><li>MiMC ï¼š<a href="https://github.com/patractlabs/megaclite/blob/master/crates/merkle-tree/src/mimc.rs" target="_blank" rel="noopener noreferrer">megaclite/blob/master/crates/merkle-tree/src/mimc.rs</a></li><li>Merkle Tree: <a href="https://github.com/patractlabs/megaclite/blob/master/crates/merkle-tree/src/merkle_tree.rs" target="_blank" rel="noopener noreferrer">megaclite/blob/master/crates/merkle-tree/src/merkle_tree.rs</a></li></ul><p>MiMC implements a hash algorithm based on Field on the elliptic curve of alt_bn128, so its circuit implementation in the prove system of ZKP (based on the alt_bn128 curve) is very friendly.</p><p>The mimc implementation is shown in the figure below, using Sponge mode instantiated by MiMC permutation with a fixed key.</p><p><img src="https://i.imgur.com/Rg2zjPW.png"></p><p>Source code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let mut r = in_k.clone();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for i in 0..in_x.len() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    r = &amp;r + in_x[i] + mimc_pe7(&amp;mut in_x[i], &amp;r, &amp;in_seed, round_count) % &amp;*SCALAR_FIELD;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In snark setting , MiMC-n/n block-cipher usually use Even-Mansour mode</p><p><img src="https://i.imgur.com/aCExnKY.png"></p><p>Our MiMC-p/p  with exponent of 7, so:</p><p><img src="https://i.imgur.com/fqD85VQ.png"></p><p>Source code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let mut keccak = Keccak::v256();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let mut received = [0u8; 32];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">keccak.update(&amp;c.to_bytes_be()[..]);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">keccak.finalize(&amp;mut received);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c = U256::from_bytes_be(&amp;received) % &amp;*SCALAR_FIELD;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// x = (x + c_i + k)^7</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">t = &amp;in_x + &amp;c % &amp;*SCALAR_FIELD + in_k % &amp;*SCALAR_FIELD; // t = x + c_i + k</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a = t.mulmod(&amp;t, &amp;*SCALAR_FIELD); // t^2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a = a.mulmod(&amp;a, &amp;*SCALAR_FIELD).mulmod(&amp;a, &amp;*SCALAR_FIELD);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">in_x = a.mulmod(&amp;t, &amp;*SCALAR_FIELD); // t^7</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="52-eddsa-verifier"></a>5.2 EdDSA verifier<a class="hash-link" href="#52-eddsa-verifier" title="Direct link to heading">#</a></h3><ul><li>Source codeï¼š<a href="https://github.com/patractlabs/megaclite/tree/master/crates/eddsa" target="_blank" rel="noopener noreferrer">megaclite/tree/master/crates/eddsa</a></li></ul><p>It is built on <a href="https://z.cash/technology/jubjub/" target="_blank" rel="noopener noreferrer">JubJub curve</a>. Jubjub is the <a href="https://en.wikipedia.org/wiki/Twisted_Edwards_curve" target="_blank" rel="noopener noreferrer">twisted Edwards curve</a> <code>-u^2 + v^2 = 1 + d.u^2.v^2</code> of rational points over <code>GF(q)</code> with a subgroup of prime order <code>r</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">q = 21888242871839275222246405745257275088548364400416034343698204186575808495617</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r = 21888242871839275222246405745257275088696311157297823662689037894645226208583</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The choice of <code>GF(q)</code> is made to be the scalar field of the Bn254 elliptic curve construction.</p><p>It also implements ETEC (Extened Twisted Edwards coordinate). In the Extended coordinate system, it can provide faster addition operations. In the Projective coordinate system, it can avoid inversion operations and provide faster double operations.</p><p>The core verification algorithm of EdDSA signature is as follows:</p><p><img src="https://i.imgur.com/clDEIqR.png"></p><p>Where (s, R) is the signature, Pk is the public key, and h is the hash value of the message. Because R is generated by the private key and the message hash, EdDSA is also a deterministic signature algorithm.</p><p>Source code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">if let Some(lhs) = scalar_mult(GENERATE[0].clone(), GENERATE[1].clone(), s) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   let t = hash_to_u256(&amp;input);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   if let Some((pk_x, pk_y)) = scalar_mult(public_key[0].clone(), public_key[1].clone(), t) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       let [r_x, r_y] = r;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       let etec_point = etec_add(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           &amp;point_to_etec(r_x, r_y, Q.clone()),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           &amp;point_to_etec(pk_x, pk_y, Q.clone()),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           &amp;*Q,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           &amp;JUBJUB_A.into(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           &amp;JUBJUB_D.into(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       );</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       if let Some(rhs) = etec_to_point(etec_point, Q.clone()) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           return lhs == rhs;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">false</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-recap-of-verification-of-megaclite-v01"></a>5. Recap of verification of Megaclite v0.1<a class="hash-link" href="#5-recap-of-verification-of-megaclite-v01" title="Direct link to heading">#</a></h2><ul><li><del>Provide more on-chain underlying cryptography support than Ethereum. The current stage includes two curves : alt_bn128 and bls12_381</del></li><li><del>Integrate ADD, MUL, Paring units under Runtime layer, and provide them to Runtime applications through Runtime-Interface, and further provide them to WASM contract applications through Contract-Seal</del></li><li><del>Through Pallet and Ink! contract libraries, providing more higher-level verification and crypto tools than Ethereum, improving execution efficiency and reducing development costs</del></li><li><del>Provide off-chain cryptography toolbox through Rust SDK</del></li><li><del>Provide typical sample applications through Ink! sample contracts</del></li></ul><p>We will propose v0.2 and v0.3 later after some time for research.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/docs/zkmega/reports/v0.1Report.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/zkmega/reports"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Report for zkMega proposals</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/en/zkmega/reports/v0.2Report"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Report for zkMega v0.2ï¼ˆoriginal Megaclite v0.2 ) Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-recap-of-megaclites-development-plan-v01--v03" class="table-of-contents__link">1. Recap of Megacliteâ€™s development plan (v0.1 ~ v0.3)</a></li><li><a href="#2-support-and-benchmark-basic-units-in-native-layer-and-wasm-layer" class="table-of-contents__link">2. Support and benchmark basic units in Native layer and WASM layer.</a><ul><li><a href="#21-encapsulate-crypto-units-of-the-four-curves-from-arkworks" class="table-of-contents__link">2.1 Encapsulate crypto units of the four curves from arkworks</a></li><li><a href="#22-import-megaclite-through-host-calls-in-native-layer" class="table-of-contents__link">2.2 Import Megaclite through host calls in Native layer.</a></li><li><a href="#23-import-megaclite-as-runtime-library-in-wasm-layer" class="table-of-contents__link">2.3 Import Megaclite as Runtime library in WASM layer</a></li><li><a href="#24-benchmark-of-basic-units" class="table-of-contents__link">2.4 Benchmark of basic units</a></li></ul></li><li><a href="#3-provide-and-benchmark-groth16-verifier--in-ink-layer" class="table-of-contents__link">3. Provide and benchmark Groth16 Verifier  in ink! layer</a><ul><li><a href="#31-introduction-of-groth16-verification" class="table-of-contents__link">3.1 Introduction of Groth16 Verification</a></li><li><a href="#32-expose-megaclite-basic-units-for-ink-contract-to-call-through-chain-extension" class="table-of-contents__link">3.2 Expose Megaclite basic units for ink! contract to call through chain-extension</a></li><li><a href="#33-call-megaclite-basic-units-in-ink-contract-to-provide-groth16-verifier" class="table-of-contents__link">3.3 Call Megaclite basic units in ink! contract to provide Groth16 Verifier</a></li></ul></li><li><a href="#34-benchmark-of-groth16-verifier" class="table-of-contents__link">3.4 Benchmark of Groth16 Verifier</a></li><li><a href="#4-conclusion-of-native-version-and-wasm-version" class="table-of-contents__link">4. Conclusion of Native version and WASM version</a></li><li><a href="#5-more-library-contracts-built-by-ink" class="table-of-contents__link">5. More library contracts built by ink!</a><ul><li><a href="#51-mimc-based-merkle-tree" class="table-of-contents__link">5.1 MiMC-based Merkle Tree</a></li><li><a href="#52-eddsa-verifier" class="table-of-contents__link">5.2 EdDSA verifier</a></li></ul></li><li><a href="#5-recap-of-verification-of-megaclite-v01" class="table-of-contents__link">5. Recap of verification of Megaclite v0.1</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/en/assets/js/runtime~main.0df25487.js"></script>
<script src="/en/assets/js/main.9e69ee6e.js"></script>
</body>
</html>