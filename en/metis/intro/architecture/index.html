<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Architectures | Substrate Contracts Book</title><meta data-react-helmet="true" property="og:url" content="https://docs.patract.io/substrate-contracts-book/en/metis/intro/architecture"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Architectures | Substrate Contracts Book"><meta data-react-helmet="true" name="description" content="Metis-MCCI architecture"><meta data-react-helmet="true" property="og:description" content="Metis-MCCI architecture"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-contracts-book/en/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://docs.patract.io/substrate-contracts-book/en/metis/intro/architecture"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/metis/intro/architecture" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/en/metis/intro/architecture" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.patract.io/substrate-contracts-book/metis/intro/architecture" hreflang="x-default"><link rel="stylesheet" href="/substrate-contracts-book/en/assets/css/styles.4aa6c65a.css">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/runtime~main.02a667d6.js" as="script">
<link rel="preload" href="/substrate-contracts-book/en/assets/js/main.d7fa9c79.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-contracts-book/en/"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-contracts-book/en/img/logo.svg" alt="Substrate Contracts Book" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">My Site</b></a><a href="https://www.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://blog.patract.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/patractlabs/substrate-contracts-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/substrate-contracts-book/metis/intro/architecture" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡</a></li><li><a href="/substrate-contracts-book/en/metis/intro/architecture" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/">Summary</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Introduction</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/introduction">Substrate contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/overview">Contract overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/model">Contract model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/language">Contract language</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/contracts/wasm_first_step">Brief introduction of Wasm</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ink!</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ask!</a></li><li class="menu__list-item"><a class="menu__link" href="/substrate-contracts-book/en/solang/introduction">Solang</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Redspot</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Europa</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">zkMega</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Himalia</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Metis</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Get Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/intro/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/intro/motivation">Motivation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-contracts-book/en/metis/intro/architecture">Architectures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/intro/differences">Metis vs OpenZeppelin</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/guides/imports">Use Metis components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/guides/macros">Marcos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/guides/extensions">Extending Metis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-contracts-book/en/metis/guides/hook">Hooks</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Access control</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Governance</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Security</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Tokens</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Tools</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Utilities</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Reports</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Elara</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Jupiter</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Architectures</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="metis-mcci-architecture"></a>Metis-MCCI architecture<a class="hash-link" href="#metis-mcci-architecture" title="Direct link to heading">#</a></h2><ul><li><code>M</code> : Data model. Most contracts read and write contract world states. These states map to data models, each associated with only one component.</li><li><code>C</code> : component. A component is a reusable, independent implementation unit that encapsulates data and methods and maintains orthogonality with other components.</li><li><code>C</code> : controller. The controller coordinates the components and implements the contract interface.</li><li><code>I</code> : interface. The interface is the user interface of the contract. The interface defines the behavior of the contract and, to some extent, defines metadata.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><pre tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚ Interface     â”‚ Control                        â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚  Constructor  â”‚  â”‚ Component           â”‚       â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚ User  â”‚  Call    â”‚               â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”    â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Messages     â”‚  â”‚ â”‚ Component            â”‚    â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚               â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚  Events       â”‚  â”‚ â”‚ â”‚ Component            â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€â”€â”€â”€â”€â”€â”¤          â”‚               â”‚  â”‚ â”‚ â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚  Call    â”‚               â”‚  â”‚ â”‚ â”‚ Msgs   â”‚           â”‚ â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚  â”‚ â”‚ â”‚        â”‚ Module    â”‚ â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚               â”‚  â”‚ â”‚ â”‚ Apis   â”‚           â”‚ â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚ Apps  â”‚          â”‚               â”‚  â”‚ â”‚ â”‚        â”‚           â”‚ â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚  Event   â”‚               â”‚  â””â”€â”¤ â”‚ Events â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚    â””â”€â”¤                      â”‚  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚               â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚       â”‚          â”‚               â”‚                                â”‚</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">â””â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As shown in the figure above, under the MCCI architecture, the contract is divided into a series of reusable components. The contract behavior is implent through the collaboration of components, and the contract behavior is clearly defined by interface and controller.</p><p>The contract&#x27;s interface defines the contract&#x27;s behavior, including:</p><ul><li>constructor</li><li>message</li><li>event</li></ul><p>The user of the contract interacts with the contract based on these three elements. In fact, these three elements also constitute ink! The main part of the contract metadata.</p><p>For a contract, these three things are guaranteed to be deterministic, unambiguous, and easy to understand. Therefore, the interface code of the contract code should be as cohesive as possible.</p><p>The contract controller is responsible for integrating the components. We break the main logic of the contract down into a series of reusable components, which can <strong>extend</strong> and <strong>compose</strong> based on other components.</p><p>A data model is the encapsulation of the state of a contract. A component of a contract needs a contract to meet the requirements of its data model. For a contract, its state will be represented as a combination of a series of data models.</p><p>In generally, the data model can also be considered as part of the contract behavior, and thus as part of the contract interface, but in most scenarios, external applications and users can not directly use the state of the chain, so the external encapsulation of the data model is not emphasized here.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="inheritance-vs-composition"></a>Inheritance Vs Composition<a class="hash-link" href="#inheritance-vs-composition" title="Direct link to heading">#</a></h2><p>In contract development, we focus more on auditability of contracts, and the use of inheritance in solidity contract development will increase the difficulty of contract audit: The behavior logic of the contract is spread out in multiple files, even in different projects. Therefore, in Metis, we do not inherit the interface and implementation of the contract. The components and data model are introduced into the contract in a combined way.</p><p>Each component impl a series of functions, include the impl of messages and apis. Components can <strong>extend</strong> and <strong>compose</strong> based on other components.</p><p>For most of components, will like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// The `EventEmit` impl the event emit api for ownable component.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub trait EventEmit&lt;E: Env&gt;: EnvAccess&lt;E&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Emit OwnershipTransferred event</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn emit_event_ownership_transferred(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        previous_owner: Option&lt;E::AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        new_owner: Option&lt;E::AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// The `Impl` define ownable component impl funcs</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub trait Impl&lt;E: Env&gt;: Storage&lt;E, Data&lt;E&gt;&gt; + EventEmit&lt;E&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// init Initializes the contract setting the deployer as the initial owner.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn init(&amp;mut self) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // logic</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Message impl </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn one_message_impl(&amp;mut self) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // msg impl which will call by ```xxx::Impl::one_message_impl(self)```</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // use the hook</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        self.hook(xxx)?</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Ok(())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Message for Query impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn one_query_impl(&amp; self, param_acc: &amp;E::AccountId) -&gt; Data {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Data::default()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// API for other message</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn check_xxx(&amp;self, owner: &amp;E::AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Hook which need impl by contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn hook(&amp;mut self, params: &amp;E::Balance) -&gt; Result&lt;()&gt;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Some component contains a default implementation:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// a default impl, each contract which impl storage and event emitter can be component</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl&lt;E: Env, T: Storage&lt;E, Data&lt;E&gt;&gt; + EventEmit&lt;E&gt;&gt; Impl&lt;E&gt; for T {}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To use this component, we can import this to contract:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><pre tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[metis_lang::contract] // use `metis_lang::contract`</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub mod contract {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // use the component: xxx1 and xxx2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use metis_component_xxx1 as xxx1;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use metis_component_xxx2 as xxx2;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // use `import` and `metis` marco</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    use metis_lang::{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        import,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        metis,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(storage)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[import(xxx1, xxx2)] // import the component</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct Contract {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // add data to storage, which use Contract as Env to Data</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        xxx1: xxx1::Data&lt;Contract&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        xxx2: xxx2::Data&lt;Contract&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// add event for component</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// in emit it will be emit_event_ownership_transferred</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(xxx1)] // event for xxx1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct OwnershipTransferred {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// previous owner account id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        previous_owner: Option&lt;AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// new owner account id</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        new_owner: Option&lt;AccountId&gt;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Event emitted when payee withdraw</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[ink(event)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[metis(xxx2)] // event for xxx1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub struct OtherEvent {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(topic)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub payee: AccountId,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub amount: Balance,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl xxx1::Impl&lt;Contract&gt; for Contract {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fn hook(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &amp;mut self,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            params: &amp;E::Balance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // some logic</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Ok(())</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    impl Contract {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(constructor)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn new() -&gt; Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // impl for default</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            let mut instance = Self {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                xxx1: xxx1::Data::new(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                xxx2: xxx2::Data::new(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // init call</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            xxx1::Impl::init(&amp;mut instance);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            xxx2::Impl::init(&amp;mut instance);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // return instance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            instance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// commits for one_message_impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn one_message_impl(&amp;mut self) -&gt; Result&lt;()&gt; {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // some other check</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            xxx2::Impl::do_some_check(self);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            xxx1::Impl::one_message_impl(self)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// commits for one_query_impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message, payable)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn one_query_impl(&amp;self, payee: AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            xxx1::Impl::one_query_impl(self, payee)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        /// commits for other_message_impl</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        #[ink(message)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn other_message_impl(&amp;mut self, payee: AccountId) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            xxx1::Impl::check_xxx(self)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // other logic</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[cfg(test)]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mod tests {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // test for contract</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/patractlabs/substrate-contracts-book/edit/master/docs/metis/intro/architecture.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-contracts-book/en/metis/intro/motivation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Motivation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-contracts-book/en/metis/intro/differences"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metis vs OpenZeppelin Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#metis-mcci-architecture" class="table-of-contents__link">Metis-MCCI architecture</a></li><li><a href="#inheritance-vs-composition" class="table-of-contents__link">Inheritance Vs Composition</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/substrate-contracts-book/en/assets/js/runtime~main.02a667d6.js"></script>
<script src="/substrate-contracts-book/en/assets/js/main.d7fa9c79.js"></script>
</body>
</html>